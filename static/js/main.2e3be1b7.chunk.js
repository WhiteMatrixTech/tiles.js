(window["webpackJsonpthreejs-tilemap"]=window["webpackJsonpthreejs-tilemap"]||[]).push([[0],{12:function(e,t,i){e.exports=i(19)},17:function(e,t,i){},18:function(e,t,i){},19:function(e,t,i){"use strict";i.r(t);var s=i(3),l=i.n(s),n=i(7),h=i.n(n),r=(i(17),i(1)),o=i(2),a=i(10),c=i(8),u=i(11),d=(i(18),function(){function e(t,i,s,l){Object(r.a)(this,e),this.q=void 0,this.r=void 0,this.s=void 0,this.h=void 0,this.tile=void 0,this.userData=void 0,this.walkable=void 0,this._calcCost=void 0,this._priority=void 0,this._visited=void 0,this._parent=void 0,this.uniqueID=void 0,this.q=t||0,this.r=i||0,this.s=s||0,this.h=l||1,this.tile=null,this.userData={},this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=A.LinkedList.generateID()}return Object(o.a)(e,[{key:"set",value:function(e,t,i){return this.q=e,this.r=t,this.s=i,this}},{key:"copy",value:function(e){return this.q=e.q,this.r=e.r,this.s=e.s,this.h=e.h,this.tile=e.tile||null,this.userData=e.userData||{},this.walkable=e.walkable,this}},{key:"add",value:function(e){return this.q+=e.q,this.r+=e.r,this.s+=e.s,this}},{key:"equals",value:function(e){return this.q===e.q&&this.r===e.r&&this.s===e.s}},{key:"resetPath",value:function(){this._calcCost=0,this._priority=0,this._parent=null,this._visited=!1}}]),e}()),v=i(0),f=function(){function e(t){var i;Object(r.a)(this,e),this.type=void 0,this.size=void 0,this.cellSize=void 0,this.cells=void 0,this.numCells=void 0,this.extrudeSettings=void 0,this.autogenerated=void 0,this.cellShape=void 0,this.cellGeo=void 0,this.cellShapeGeo=void 0,this._cellWidth=void 0,this._cellLength=void 0,this._hashDelimeter=void 0,this._directions=void 0,this._diagonals=void 0,this._list=void 0,this._vec3=void 0,this._cel=void 0,this._geoCache=void 0,this._matCache=void 0,t=t||{},this.type=A.HEX,this.size=5,this.cellSize="undefined"===typeof t.cellSize?10:t.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var s=[];for(i=0;i<6;i++)s.push(this._createVertex(i));for(this.cellShape=new v.t,this.cellShape.moveTo(s[0].x,s[0].y),i=1;i<6;i++)this.cellShape.lineTo(s[i].x,s[i].y);this.cellShape.lineTo(s[0].x,s[0].y),this.cellShape.autoClose=!0,this.cellGeo=new v.b,this.cellGeo.vertices=s,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new v.u(this.cellShape),this._cellWidth=2*this.cellSize,this._cellLength=.5*A.SQRT3*this._cellWidth,this._hashDelimeter=".",this._directions=[new d(1,-1,0),new d(1,0,-1),new d(0,1,-1),new d(-1,1,0),new d(-1,0,1),new d(0,-1,1)],this._diagonals=[new d(2,-1,-1),new d(1,1,-2),new d(-1,2,-1),new d(-2,1,1),new d(-1,-1,2),new d(1,-2,1)],this._list=[],this._vec3=new v.z,this._cel=new d,this._geoCache=[],this._matCache=[]}return Object(o.a)(e,null,[{key:"TWO_THIRDS",get:function(){return 2/3}}]),Object(o.a)(e,[{key:"cellToPixel",value:function(e){return this._vec3.x=e.q*this._cellWidth*.75,this._vec3.y=e.h,this._vec3.z=-(e.s-e.r)*this._cellLength*.5,this._vec3}},{key:"pixelToCell",value:function(t){var i=t.x*(e.TWO_THIRDS/this.cellSize),s=(-t.x/3+A.SQRT3/3*t.z)/this.cellSize;return this._cel.set(i,s,-i-s),this._cubeRound(this._cel)}},{key:"getCellAt",value:function(t){var i=t.x*(e.TWO_THIRDS/this.cellSize),s=(-t.x/3+A.SQRT3/3*t.z)/this.cellSize;return this._cel.set(i,s,-i-s),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]}},{key:"getNeighbors",value:function(e,t,i){var s,l,n=this._directions.length;for(this._list.length=0,s=0;s<n;s++)this._cel.copy(e),this._cel.add(this._directions[s]),!(l=this.cells[this.cellToHash(this._cel)])||i&&!i(e,l)||this._list.push(l);if(t)for(s=0;s<n;s++)this._cel.copy(e),this._cel.add(this._diagonals[s]),!(l=this.cells[this.cellToHash(this._cel)])||i&&!i(e,l)||this._list.push(l);return this._list}},{key:"getRandomCell",value:function(){var e,t=0,i=A.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]}},{key:"cellToHash",value:function(e){return e.q+this._hashDelimeter+e.r+this._hashDelimeter+e.s}},{key:"distance",value:function(e,t){var i=Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(e.s-t.s));return i+=t.h-e.h}},{key:"clearPath",value:function(){var e;for(e in this.cells)this.cells[e].resetPath()}},{key:"traverse",value:function(e){var t;for(t in this.cells)e(this.cells[t])}},{key:"generateTile",value:function(e,t,i){var s=Math.abs(e.h);s<1&&(s=1);var l=this._geoCache[s];l||(this.extrudeSettings.amount=s,l=new v.e(this.cellShape,this.extrudeSettings),this._geoCache[s]=l);var n=new A.Tile({scale:t,cell:e,geometry:l,material:i});return e.tile=n,n}},{key:"generateTiles",value:function(e){e=e||{};var t,i,s,l=[],n={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:10,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in n=A.Tools.merge(n,e),this.cellSize=n.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*A.SQRT3*this._cellWidth,this.autogenerated=!0,this.extrudeSettings=n.extrudeSettings,this.cells)s=this.cells[t],(i=this.generateTile(s,n.tileScale,n.material)).position.copy(this.cellToPixel(s)),i.position.y=0,l.push(i);return l}},{key:"generate",value:function(e){var t,i,s,l;for(e=e||{},this.size="undefined"===typeof e.size?this.size:e.size,t=-this.size;t<this.size+1;t++)for(i=-this.size;i<this.size+1;i++)s=-t-i,Math.abs(t)<=this.size&&Math.abs(i)<=this.size&&Math.abs(s)<=this.size&&(l=new d(t,i,s),this.add(l))}},{key:"generateOverlay",value:function(e,t,i){var s,l,n,h=this.cellShape.createPointsGeometry(6);for(s=-e;s<e+1;s++)for(l=-e;l<e+1;l++)if(n=-s-l,Math.abs(s)<=e&&Math.abs(l)<=e&&Math.abs(n)<=e){this._cel.set(s,l,n);var r=new v.h(h,i);r.position.copy(this.cellToPixel(this._cel)),r.rotation.x=90*A.DEG_TO_RAD,t.add(r)}t.position.y=.5}},{key:"add",value:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e}},{key:"remove",value:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)}},{key:"dispose",value:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._geoCache=null,this._matCache=null}},{key:"load",value:function(e,t,i){var s=this;A.Tools.getJSON({url:e,callback:function(e){s.fromJSON(e),t.call(i||null,e)},cache:!1,scope:s})}},{key:"fromJSON",value:function(e){var t,i,s=e.cells;this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*A.SQRT3*this._cellWidth,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated;var l=Object.keys(e).length;for(t=0;t<l;t++)(i=new d).copy(s[t]),this.add(i)}},{key:"toJSON",value:function(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated,cells:null},s=[];for(t in this.cells)e=this.cells[t],s.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=s,i}},{key:"_createVertex",value:function(e){var t=A.TAU/6*e;return new v.z(this.cellSize*Math.cos(t),this.cellSize*Math.sin(t),0)}},{key:"_cubeRound",value:function(e){var t=Math.round(e.q),i=Math.round(e.r),s=Math.round(e.s),l=Math.abs(t-e.q),n=Math.abs(i-e.r),h=Math.abs(s-e.s);return l>n&&l>h?t=-i-s:n>h?i=-t-s:s=-t-i,this._cel.set(t,i,s)}}]),e}(),p=function(){function e(t){Object(r.a)(this,e),t=t||{},this.type=A.SQR,this.size=5,this.cellSize="undefined"===typeof t.cellSize?10:t.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var i=[];i.push(new v.z),i.push(new v.z(-this.cellSize,this.cellSize)),i.push(new v.z(this.cellSize,this.cellSize)),i.push(new v.z(this.cellSize,-this.cellSize)),this.cellShape=new v.t,this.cellShape.moveTo(-this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,-this.cellSize),this.cellGeo=new v.f,this.cellGeo.vertices=i,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new v.u(this.cellShape),this._fullCellSize=2*this.cellSize,this._hashDelimeter=".",this._directions=[new A.Cell(1,0,0),new A.Cell(0,-1,0),new A.Cell(-1,0,0),new A.Cell(0,1,0)],this._diagonals=[new A.Cell(-1,-1,0),new A.Cell(-1,1,0),new A.Cell(1,1,0),new A.Cell(1,-1,0)],this._list=[],this._vec3=new v.z,this._cel=new A.Cell,this._conversionVec=new v.z,this._geoCache=[],this._matCache=[]}return Object(o.a)(e,[{key:"cellToPixel",value:function(e){return this._vec3.x=e.q*this._fullCellSize,this._vec3.y=e.h,this._vec3.z=e.r*this._fullCellSize,this._vec3}},{key:"pixelToCell",value:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i,0)}},{key:"getCellAt",value:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i),this.cells[this.cellToHash(this._cel)]}},{key:"getNeighbors",value:function(e,t,i){var s,l,n=this._directions.length;for(this._list.length=0,s=0;s<n;s++)this._cel.copy(e),this._cel.add(this._directions[s]),!(l=this.cells[this.cellToHash(this._cel)])||i&&!i(e,l)||this._list.push(l);if(t)for(s=0;s<n;s++)this._cel.copy(e),this._cel.add(this._diagonals[s]),!(l=this.cells[this.cellToHash(this._cel)])||i&&!i(e,l)||this._list.push(l);return this._list}},{key:"getRandomCell",value:function(){var e,t=0,i=A.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]}},{key:"cellToHash",value:function(e){return e.q+this._hashDelimeter+e.r}},{key:"distance",value:function(e,t){var i=Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r));return i+=t.h-e.h}},{key:"clearPath",value:function(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1}},{key:"traverse",value:function(e){var t;for(t in this.cells)e(this.cells[t])}},{key:"generateTile",value:function(e,t,i){var s=Math.abs(e.h);s<1&&(s=1);var l=this._geoCache[s];l||(this.extrudeSettings.amount=s,l=new v.e(this.cellShape,this.extrudeSettings),this._geoCache[s]=l);var n=new A.Tile({size:this.cellSize,scale:t,cell:e,geometry:l,material:i});return e.tile=n,n}},{key:"generateTiles",value:function(e){e=e||{};var t,i,s,l=[],n={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in n=A.Tools.merge(n,e),this.cellSize=n.cellSize,this._fullCellSize=2*this.cellSize,this.autogenerated=!0,this.extrudeSettings=n.extrudeSettings,this.cells)s=this.cells[t],(i=this.generateTile(s,n.tileScale,n.material)).position.copy(this.cellToPixel(s)),i.position.y=0,l.push(i);return l}},{key:"generate",value:function(e){var t,i,s;e=e||{},this.size="undefined"===typeof e.size?this.size:e.size;var l=Math.ceil(this.size/2);for(t=-l;t<l;t++)for(i=-l;i<l;i++)s=new A.Cell(t,i+1),this.add(s)}},{key:"generateOverlay",value:function(e,t,i){var s,l,n=Math.ceil(e/2);for(s=-n;s<n;s++)for(l=-n;l<n;l++){this._cel.set(s,l);var h=new v.h(this.cellGeo,i);h.position.copy(this.cellToPixel(this._cel)),h.rotation.x=90*A.DEG_TO_RAD,t.add(h)}}},{key:"add",value:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e}},{key:"remove",value:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)}},{key:"dispose",value:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._conversionVec=null,this._geoCache=null,this._matCache=null}},{key:"load",value:function(e,t,i){A.Tools.getJSON({url:e,callback:function(e){this.fromJSON(e),t.call(i||null,e)},cache:!1,scope:this})}},{key:"fromJSON",value:function(e){var t,i,s=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._fullCellSize=2*this.cellSize,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<s.length;t++)(i=new A.Cell).copy(s[t]),this.add(i)}},{key:"toJSON",value:function(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},s=[];for(t in this.cells)e=this.cells[t],s.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=s,i}}]),e}(),g=function(){function e(t){Object(r.a)(this,e),this.cell=void 0,this.uniqueID=void 0,this.geometry=void 0,this.material=void 0,this.objectType=void 0,this.entity=void 0,this.userData=void 0,this.selected=void 0,this.highlight=void 0,this.mesh=void 0,this.position=void 0,this.rotation=void 0,this._emissive=void 0,t=t||{};var i={cell:null,geometry:null,material:null};if(!(i=A.Tools.merge(i,t)).cell||!i.geometry)throw new Error("Missing TM.Tile configuration");this.cell=i.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),this.cell.tile=this,this.uniqueID=A.Tools.generateID(),this.geometry=i.geometry,this.material=i.material,this.material||(this.material=new v.m({color:A.Tools.randomizeRGB("0, 105, 148",13)})),this.objectType=A.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight=33996,this.mesh=new v.l(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=-90*A.DEG_TO_RAD,this.mesh.scale.set(i.scale,i.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null}return Object(o.a)(e,[{key:"select",value:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,console.log(this.userData.terrain),console.log(this.userData.elevation),console.log(this.position),this}},{key:"deselect",value:function(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this}},{key:"toggle",value:function(){return this.selected?this.deselect():this.select(),this}},{key:"dispose",value:function(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},{key:"setTerrain",value:function(e,t){if(this.userData.elevation=e,this.userData.moisture=t,e<.1)this.userData.terrain="OCEAN";else{if(e<.12)return this.userData.terrain="BEACH",void this.material.color.set(A.Tools.randomizeRGB("194,178,128",13));if(e>.8)return t<.1?(this.userData.terrain="SCORCHED",void this.material.color.set(A.Tools.randomizeRGB("171,95,58",13))):t<.2?(this.userData.terrain="BARE",void this.material.color.set(A.Tools.randomizeRGB("215,171,114",13))):t<.5?(this.userData.terrain="TUNDRA",void this.material.color.set(A.Tools.randomizeRGB("152,171,180",13))):(this.userData.terrain="SNOW",void this.material.color.set(A.Tools.randomizeRGB("223,217,221",13)));if(e>.6)return t<.33?(this.userData.terrain="TEMPERATE_DESERT",void this.material.color.set(A.Tools.randomizeRGB("200,184,158",13))):t<.66?(this.userData.terrain="SHRUBLAND",void this.material.color.set(A.Tools.randomizeRGB("125,124,62",13))):(this.userData.terrain="TAIGA",void this.material.color.set(A.Tools.randomizeRGB("16,86,76",13)));if(e>.3)return t<.16?(this.userData.terrain="TEMPERATE_DESERT",void this.material.color.set(A.Tools.randomizeRGB("200,184,158",13))):t<.5?(this.userData.terrain="GRASSLAND",void this.material.color.set(A.Tools.randomizeRGB("147,217,69",13))):(this.userData.terrain="FOREST",void this.material.color.set(A.Tools.randomizeRGB("16,59,35",13)));if(t<.16)return this.userData.terrain="SUBTROPICAL_DESERT",void this.material.color.set(A.Tools.randomizeRGB("152,79,15",13));if(t<.33)return this.userData.terrain="GRASSLAND",void this.material.color.set(A.Tools.randomizeRGB("147,217,69",13));this.userData.terrain="TROPICAL_RAIN_FOREST",this.material.color.set(A.Tools.randomizeRGB("79,159,27",13))}}}]),e}(),m=function e(){Object(r.a)(this,e),this.obj=null,this.next=null,this.prev=null,this.free=!0},y=function(){function e(){Object(r.a)(this,e),this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]}return Object(o.a)(e,[{key:"getNode",value:function(e){return this.objToNodeMap[e.uniqueID]}},{key:"addNode",value:function(t){var i=new m;if(!t.uniqueID)try{t.uniqueID=e.generateID()}catch(s){return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return i.obj=t,i.free=!1,this.objToNodeMap[t.uniqueID]=i,i}},{key:"swapObjects",value:function(e,t){this.objToNodeMap[e.obj.uniqueID]=null,this.objToNodeMap[t.uniqueID]=e,e.obj=t}},{key:"add",value:function(e){var t=this.objToNodeMap[e.uniqueID];if(t){if(!1===t.free)return;t.obj=e,t.free=!1,t.next=null,t.prev=null}else t=this.addNode(e);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");this.last.next=t,t.prev=this.last,this.last=t,t.next=null}else this.first=t,this.last=t,t.next=null,t.prev=null;this.length++,this.showDebug&&this.dump("after add")}},{key:"has",value:function(e){return!!this.objToNodeMap[e.uniqueID]}},{key:"moveUp",value:function(e){this.dump("before move up");var t=this.getNode(e);if(!t)throw Error("Oops, trying to move an object that isn't in the list");if(t.prev){var i=t.prev,s=i.prev;t==this.last&&(this.last=i);var l=t.next;s&&(s.next=t),t.next=i,t.prev=i.prev,i.next=l,i.prev=t,this.first==i&&(this.first=t)}}},{key:"moveDown",value:function(e){var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.next){var i=t.next;this.moveUp(i.obj),this.last==i&&(this.last=t)}}},{key:"sort",value:function(e){var t,i,s=this.sortArray,l=this.first;for(s.length=0;l;)s.push(l.obj),l=l.next;for(this.clear(),s.sort(e),i=s.length,t=0;t<i;t++)this.add(s[t])}},{key:"remove",value:function(e){var t=this.getNode(e);return!(!t||t.free)&&(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev||(this.first=t.next),t.next||(this.last=t.prev),t.free=!0,t.prev=null,t.next=null,this.length--,!0)}},{key:"shift",value:function(){var e=this.first;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.first=e.next,e.next||(this.last=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)}},{key:"pop",value:function(){var e=this.last;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.last=e.prev,e.prev||(this.first=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)}},{key:"concat",value:function(e){for(var t=e.first;t;)this.add(t.obj),t=t.next}},{key:"clear",value:function(){for(var e=this.first;e;)e.free=!0,e=e.next;this.first=null,this.length=0}},{key:"dispose",value:function(){for(var e=this.first;e;)e.obj=null,e=e.next;this.first=null,this.objToNodeMap=null}},{key:"dump",value:function(e){console.log("===================="+e+"=====================");for(var t=this.first;t;)console.log("{"+t.obj.toString()+"} previous="+(t.prev?t.prev.obj:"NULL")),t=t.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}}],[{key:"generateID",value:function(e){return Math.random().toString(36).slice(2)+Date.now()}}]),e}(),_=function(){function e(t,i,s,l,n){Object(r.a)(this,e),this._listener=i,this.isOnce=s,this.context=l,this.signal=t,this._priority=n||0}return Object(o.a)(e,[{key:"execute",value:function(t){var i,s;return e.active&&this._listener&&(s=this.params?this.params.concat(t):t,i=this._listener.apply(this.context,s),this.isOnce&&this.detach()),i}},{key:"detach",value:function(){return this.isBound()?this.signal.remove(this._listener,this.context):null}},{key:"isBound",value:function(){return!!this.signal&&!!this._listener}},{key:"_destroy",value:function(){delete this.signal,delete this._listener,delete this.context}},{key:"toString",value:function(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+e.active+"]"}}]),e}();_.active=!0,_.params=null;var b=function(){function e(){Object(r.a)(this,e),this._bindings=[],this._prevParams=null}return Object(o.a)(e,[{key:"validateListener",value:function(e,t){if("function"!==typeof e)throw new Error("Signal: listener is a required param of {fn}() and should be a.".replace("{fn}",t))}},{key:"_registerListener",value:function(t,i,s,l){var n,h=this._indexOfListener(t,s);if(-1!==h){if((n=this._bindings[h]).isOnce!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.")}else n=new _(this,t,i,s,l),this._addBinding(n);return e.memorize&&this._prevParams&&n.execute(this._prevParams),n}},{key:"_addBinding",value:function(e){var t=this._bindings.length;do{t--}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)}},{key:"_indexOfListener",value:function(e,t){for(var i,s=this._bindings.length;s--;)if((i=this._bindings[s])._listener===e&&i.context===t)return s;return-1}},{key:"has",value:function(e,t){return-1!==this._indexOfListener(e,t)}},{key:"add",value:function(e,t,i){return this.validateListener(e,"add"),this._registerListener(e,!1,t,i)}},{key:"addOnce",value:function(e,t,i){return this.validateListener(e,"addOnce"),this._registerListener(e,!0,t,i)}},{key:"remove",value:function(e,t){this.validateListener(e,"remove");var i=this._indexOfListener(e,t);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),e}},{key:"removeAll",value:function(e){"undefined"===typeof e&&(e=null);for(var t=this._bindings.length;t--;)e?this._bindings[t].context===e&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();e||(this._bindings.length=0)}},{key:"getNumListeners",value:function(){return this._bindings.length}},{key:"halt",value:function(){e._shouldPropagate=!1}},{key:"dispatch",value:function(){if(e.active){var t,i=Array.prototype.slice.call(arguments),s=this._bindings.length;if(e.memorize&&(this._prevParams=i),s){t=this._bindings.slice(),e._shouldPropagate=!0;do{s--}while(t[s]&&e._shouldPropagate&&!1!==t[s].execute(i))}}}},{key:"forget",value:function(){this._prevParams=null}},{key:"dispose",value:function(){this.removeAll(),delete this._bindings,delete this._prevParams}},{key:"toString",value:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}}]),e}();b.memorize=!1,b._shouldPropagate=!0,b.active=!0;var w=new(function(){function e(){Object(r.a)(this,e)}return Object(o.a)(e,[{key:"backtrace",value:function(e){for(var t=[e];e._parent;)e=e._parent,t.push(e);return t.reverse()}},{key:"biBacktrace",value:function(e,t){var i=this.backtrace(e),s=this.backtrace(t);return i.concat(s.reverse())}},{key:"pathLength",value:function(e){var t,i,s,l,n,h=0;for(t=1;t<e.length;++t)i=e[t-1],s=e[t],l=i[0]-s[0],n=i[1]-s[1],h+=Math.sqrt(l*l+n*n);return h}},{key:"interpolate",value:function(e,t,i,s){var l,n,h,r,o,a,c=Math.abs,u=[];for(l=e<i?1:-1,n=t<s?1:-1,o=(h=c(i-e))-(r=c(s-t));e!==i||t!==s;)u.push([e,t]),(a=2*o)>-r&&(o-=r,e+=l),a<h&&(o+=h,t+=n);return u}},{key:"expandPath",value:function(e){var t,i,s,l,n,h,r=[],o=e.length;if(o<2)return r;for(n=0;n<o-1;++n)for(t=e[n],i=e[n+1],l=(s=this.interpolate(t[0],t[1],i[0],i[1])).length,h=0;h<l-1;++h)r.push(s[h]);return r.push(e[o-1]),r}},{key:"smoothenPath",value:function(e,t){var i,s,l,n,h,r,o,a,c,u,d,v,f=t.length,p=t[0][0],g=t[0][1],m=t[f-1][0],y=t[f-1][1];for(h=[[i=p,s=g]],o=2;o<f;++o){for(l=(c=t[o])[0],n=c[1],u=this.interpolate(i,s,l,n),v=!1,a=1;a<u.length;++a)if(d=u[a],!e.isWalkableAt(d[0],d[1])){v=!0;break}v&&(r=t[o-1],h.push(r),i=r[0],s=r[1])}return h.push([m,y]),h}},{key:"compressPath",value:function(e){if(e.length<3)return e;var t,i,s,l,n,h,r=[],o=e[0][0],a=e[0][1],c=e[1][0],u=e[1][1],d=c-o,v=u-a;for(d/=n=Math.sqrt(d*d+v*v),v/=n,r.push([o,a]),h=2;h<e.length;h++)t=c,i=u,s=d,l=v,d=(c=e[h][0])-t,v=(u=e[h][1])-i,v/=n=Math.sqrt(d*d+v*v),(d/=n)===s&&v===l||r.push([t,i]);return r.push([c,u]),r}}]),e}()),S=i(4),k=i.n(S),T=i(5),z=i.n(T),O=k.a.create("3sdad2ds3819fdez"),x=k.a.create(3129481234),D=new z.a(O.nextDouble.bind(O)),j=new z.a(x.nextDouble.bind(x));var C={clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},sign:function(e){return e&&e/Math.abs(e)},random:function(e,t){return 1===arguments.length?Math.random()*e-.5*e:Math.random()*(t-e)+e},noise1:function(e,t){return D.noise2D(e,t)/2+.5},noise2:function(e,t){return j.noise2D(e,t)/2+.5},randomInt:function(e,t){return 1===arguments.length?Math.random()*e-.5*e|0:Math.random()*(t-e+1)+e|0},normalize:function(e,t,i){return(e-t)/(i-t)},getShortRotation:function(e){return(e%=this.TAU)>this.PI?e-=this.TAU:e<-this.PI&&(e+=this.TAU),e},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(e){if("object"!==typeof e||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},merge:function(e,t){var i=this,s=Array.isArray(t),l=s&&[]||{};return s?(e=e||[],l=l.concat(e),t.forEach((function(t,s){"undefined"===typeof l[s]?l[s]=t:i.isPlainObject(t)?l[s]=i.merge(e[s],t):-1===e.indexOf(t)&&l.push(t)})),l):(e&&i.isPlainObject(e)&&Object.keys(e).forEach((function(t){l[t]=e[t]})),Object.keys(t).forEach((function(s){t[s]&&i.isPlainObject(t[s])&&e[s]?l[s]=i.merge(e[s],t[s]):l[s]=t[s]})),l)},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},radixSort:function(e,t,i,s){if(s=s||31,!((t=t||0)>=(i=i||e.length)-1||s<0)){for(var l=t,n=i,h=1<<s;l<n;)if(e[l]&h){--n;var r=e[l];e[l]=e[n],e[n]=r}else++l;this.radixSort(e,t,n,s-1),this.radixSort(e,n,i,s-1)}},randomizeRGB:function(e,t){var i,s,l=e.split(","),n="rgb(",h=[];for(t=this.randomInt(t),i=0;i<3;i++)(s=parseInt(l[i])+t)<0?s=0:s>255&&(s=255),n+=s+",",h.push(s);return n=n.substring(0,n.length-1),n+=")"},getJSON:function(e){var t=new XMLHttpRequest,i="undefined"!==typeof e.cache&&e.cache?e.url:e.url+"?t="+Math.floor(1e4*Math.random())+Date.now();t.onreadystatechange=function(){if(200!==this.status)0!==this.status&&console.warn("[Tools.getJSON] Error: "+this.status+" ("+this.statusText+") :: "+e.url);else{var t=null;try{t=JSON.parse(this.responseText)}catch(i){return}e.callback.call(e.scope||null,t)}},t.open("GET",i,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send("")}},M=function(){function e(t){Object(r.a)(this,e),this.allowDiagonal=void 0,this.heuristicFilter=void 0,this.list=void 0,t=t||{};var i={allowDiagonal:!1,heuristicFilter:null};i=C.merge(i,t),this.allowDiagonal=i.allowDiagonal,this.heuristicFilter=i.heuristicFilter,this.list=new y}return Object(o.a)(e,[{key:"findPath",value:function(e,t,i,s){var l,n,h,r,o,a;for(i=i||this.heuristicFilter,s.clearPath(),this.list.clear(),this.list.add(e);this.list.length>0;){if(this.list.sort(this.compare),(l=this.list.shift().obj)._visited=!0,l===t)return w.backtrace(t);for(o=0,a=(h=s.getNeighbors(l,this.allowDiagonal,i)).length;o<a;o++)if((r=h[o]).walkable&&(n=l._calcCost+s.distance(l,r),!r._visited||n<r._calcCost)){if(r._visited=!0,r._parent=l,r._calcCost=n,r._priority=n+s.distance(t,r),r===t)return w.backtrace(t);this.list.add(r)}}return null}},{key:"compare",value:function(e,t){return e._priority-t._priority}}]),e}(),P={manager:null,imageLoader:null,crossOrigin:!1,init:function(e){this.crossOrigin=e||!1,this.manager=new v.j((function(){}),(function(){}),(function(){console.warn("Error loading images")})),this.imageLoader=new v.g(this.manager),this.imageLoader.crossOrigin=e},loadTexture:function(e,t,i,s){var l=new v.x(null,t);return this.imageLoader.load(e,(function(e){l.image=e,l.needsUpdate=!0,i&&i(l)}),null,(function(e){s&&s(e)})),l.sourceFile=e,l}},G=function(){function e(t,i,s){Object(r.a)(this,e),this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new v.z,this.screenPosition=new v.y,this.signal=new A.Signal,this.group=t,this._camera=i,this._raycaster=new v.r,this._preventDefault=!1,(s=s||document).addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),s.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),s.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),s.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),s.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1)}return Object(o.a)(e,[{key:"update",value:function(){if(this.active){this._raycaster.setFromCamera(this.screenPosition,this._camera);var e,t,i=this._raycaster.intersectObject(this.group,!0);i.length>0?(t=(e=i[0]).object.userData.structure,this.pickedObject!=t&&(this.pickedObject&&this.signal.dispatch("out",this.pickedObject),this.pickedObject=t,this.selectedObject=null,this.signal.dispatch("over",this.pickedObject)),this.position.copy(e.point),this.screenPosition.z=e.distance):(this.pickedObject&&this.signal.dispatch("out",this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=i}}},{key:"preventDefault",value:function(){this._preventDefault=!0}},{key:"_onDocumentMouseDown",value:function(e){if((e=e||window.event).preventDefault(),this._preventDefault)return this._preventDefault=!1,!1;this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.down=1===e.which,this.rightDown=3===e.which,this.signal.dispatch("down",this.pickedObject)}},{key:"_onDocumentMouseUp",value:function(e){if(e.preventDefault(),this._preventDefault)return this._preventDefault=!1,!1;this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.signal.dispatch("up",this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch("click",this.pickedObject),this.down=1!==e.which&&this.down,this.rightDown=3!==e.which&&this.rightDown}},{key:"_onDocumentMouseMove",value:function(e){e.preventDefault(),this.screenPosition.x=e.clientX/window.innerWidth*2-1,this.screenPosition.y=-e.clientY/window.innerHeight*2+1}},{key:"_onMouseWheel",value:function(e){if(this.active){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?this.wheel++:this.wheel--,this.signal.dispatch("wheel",this.wheel)}}}]),e}();G.OVER="over",G.OUT="out",G.DOWN="down",G.UP="up",G.CLICK="click",G.WHEEL="wheel";var R=G,E=i(9),L=function(){function e(t,i){Object(r.a)(this,e),this.width=void 0,this.height=void 0,this.renderer=void 0,this.orthoZoom=void 0,this.container=void 0,this.camera=void 0,this.controlled=void 0,this.controls=void 0,t=t||{};var s={element:document.body,alpha:!0,antialias:!0,clearColor:"#000000",sortObjects:!1,fog:null,light:new v.c(16777215),lightPosition:null,cameraType:"PerspectiveCamera",cameraPosition:null,orthoZoom:4};s=A.Tools.merge(s,t);var l={minDistance:25,maxDistance:1250,zoomSpeed:3,enableZoom:!0};if(("boolean"===typeof i&&!1!==i||void 0!==i)&&(l=A.Tools.merge(l,i)),this.renderer=new v.A({alpha:s.alpha,antialias:s.antialias}),this.renderer.setClearColor(s.clearColor,1),this.renderer.sortObjects=s.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.orthoZoom=s.orthoZoom,this.container=new v.s,this.container.fog=s.fog,this.container.add(new v.a(14540253)),s.lightPosition||s.light.position.set(-1,1,-1).normalize(),this.container.add(s.light),"OrthographicCamera"===s.cameraType){var n=window.innerWidth/this.orthoZoom,h=window.innerHeight/this.orthoZoom;this.camera=new v.o(n/-2,n/2,h/2,h/-2,1,5e3)}else this.camera=new v.p(50,this.width/this.height,1,5e3);this.controlled="boolean"===typeof i&&!0===i||void 0!==i,this.controlled&&(this.controls=new E.a(this.camera,this.renderer.domElement),this.controls.minDistance=l.minDistance,this.controls.maxDistance=l.maxDistance,this.controls.zoomSpeed=l.zoomSpeed,this.controls.enableZoom=l.enableZoom,this.controls.screenSpacePanning=!1),s.cameraPosition&&this.camera.position.copy(s.cameraPosition);var o=this;window.addEventListener("resize",(function(){if(o.width=window.innerWidth,o.height=window.innerHeight,"OrthographicCamera"===o.camera.type){var e=o.width/o.orthoZoom,t=o.height/o.orthoZoom;o.camera.left=e/-2,o.camera.right=e/2,o.camera.top=t/2,o.camera.bottom=t/-2}else o.camera.aspect=o.width/o.height;o.camera.updateProjectionMatrix(),o.renderer.setSize(o.width,o.height)}),!1),this.attachTo(s.element)}return Object(o.a)(e,[{key:"attachTo",value:function(e){e.style.width=this.width+"px",e.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),e.appendChild(this.renderer.domElement)}},{key:"add",value:function(e){this.container.add(e)}},{key:"remove",value:function(e){this.container.remove(e)}},{key:"render",value:function(){this.controlled&&this.controls.update(),this.renderer.render(this.container,this.camera)}},{key:"updateOrthoZoom",value:function(){if(this.orthoZoom<=0)this.orthoZoom=0;else{var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2,this.camera.updateProjectionMatrix()}}},{key:"focusOn",value:function(e){this.camera.lookAt(e.position)}}]),e}(),q=function(){function e(t){Object(r.a)(this,e),this.mouse=t,this.onSelect=new A.Signal,this.onDeselect=new A.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)}return Object(o.a)(e,[{key:"select",value:function(e,t){e&&(t=t||!0,this.selected!==e&&this.clearSelection(t),e.selected?this.toggleSelection&&(t&&this.onDeselect.dispatch(e),e.deselect()):e.select(),this.selected=e,t&&this.onSelect.dispatch(e))}},{key:"clearSelection",value:function(e){e=e||!0,this.selected&&(e&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null}},{key:"onMouse",value:function(e,t){switch(e){case A.MouseCaster.DOWN:t||this.clearSelection();break;case A.MouseCaster.CLICK:this.select(t)}}}]),e}(),N=function(){function e(t,i){if(Object(r.a)(this,e),this.tiles=void 0,this.tileGroup=void 0,this.group=void 0,this.grid=void 0,this.overlay=void 0,this.finder=void 0,!t)throw new Error("You must pass in a grid system for the board to use.");this.tiles=[],this.tileGroup=null,this.group=new v.n,this.grid=null,this.overlay=null,this.finder=new A.AStarFinder(i),A.Loader.init(),this.setGrid(t)}return Object(o.a)(e,[{key:"setEntityOnTile",value:function(e,t){var i=this.grid.cellToPixel(t.cell);e.position.copy(i),e.position.y+=e.heightOffset||0,e.tile&&(e.tile.entity=null),e.tile=t,t.entity=e}},{key:"addTile",value:function(e){-1===this.tiles.indexOf(e)&&(this.tiles.push(e),this.snapTileToGrid(e),e.position.y=0,this.tileGroup.add(e.mesh),this.grid.add(e.cell),e.cell.tile=e)}},{key:"removeTile",value:function(e){if(e){var t=this.tiles.indexOf(e);this.grid.remove(e.cell),-1!==t&&this.tiles.splice(t,1),e.dispose()}}},{key:"removeAllTiles",value:function(){if(this.tileGroup)for(var e=this.tileGroup.children,t=0;t<e.length;t++)this.tileGroup.remove(e[t])}},{key:"getTileAtCell",value:function(e){var t=this.grid.cellToHash(e);return e.tile||("undefined"!==typeof this.grid.cells[t]?this.grid.cells[t].tile:null)}},{key:"snapToGrid",value:function(e){var t=this.grid.pixelToCell(e);e.copy(this.grid.cellToPixel(t))}},{key:"snapTileToGrid",value:function(e){if(e.cell)e.position.copy(this.grid.cellToPixel(e.cell));else{var t=this.grid.pixelToCell(e.position);e.position.copy(this.grid.cellToPixel(t))}return e}},{key:"getRandomTile",value:function(){var e=A.Tools.randomInt(0,this.tiles.length-1);return this.tiles[e]}},{key:"findPath",value:function(e,t,i){return this.finder.findPath(e.cell,t.cell,i,this.grid)}},{key:"setGrid",value:function(e){if(this.group.remove(this.tileGroup),this.grid&&e!==this.grid){this.removeAllTiles();var t=this;this.tiles.forEach((function(e){t.grid.remove(e.cell),e.dispose()})),this.grid.dispose()}this.grid=e,this.tiles=[],this.tileGroup=new v.n,this.group.add(this.tileGroup)}},{key:"generateOverlay",value:function(e){var t=new v.i({color:0,opacity:.9});this.overlay&&this.group.remove(this.overlay),this.overlay=new v.n,this.grid.generateOverlay(e,this.overlay,t),this.group.add(this.overlay)}},{key:"generateTilemap",value:function(e){this.reset();var t=this.grid.generateTiles(e);this.tiles=t,this.tileGroup=new v.n;for(var i=0;i<t.length;i++)this.tileGroup.add(t[i].mesh);this.group.add(this.tileGroup)}},{key:"generateTerrain",value:function(){if(this.grid.type===A.HEX){var e,t,i,s=this.grid.size,l=0;for(e=-s;e<s+1;e++)for(t=-s;t<s+1;t++)if(i=-e-t,Math.abs(e)<=s&&Math.abs(t)<=s&&Math.abs(i)<=s){var n=e/this.grid._cellWidth-.5,h=i/this.grid._cellLength-.5,r=1*A.Tools.noise1(1*n,1*h)+.5*A.Tools.noise1(2*n,2*h)+.25*A.Tools.noise1(4*n,4*h)+.13*A.Tools.noise1(8*n,8*h)+.06*A.Tools.noise1(16*n,16*h)+.03*A.Tools.noise1(32*n,32*h);r/=1.97,r=Math.pow(r,5);var o=1*A.Tools.noise2(1*n,1*h)+.75*A.Tools.noise2(2*n,2*h)+.33*A.Tools.noise2(4*n,4*h)+.33*A.Tools.noise2(8*n,8*h)+.33*A.Tools.noise2(16*n,16*h)+.5*A.Tools.noise2(32*n,32*h);o/=3.24,this.tiles[l].setTerrain(r,o),l++}}}},{key:"reset",value:function(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup)}}]),e}(),A={VERSION:"1.0.0",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,SQRT3:Math.sqrt(3),Cell:d,HexGrid:f,SqrGrid:p,Tile:g,LinkedList:y,Signal:b,AStarFinder:M,PathUtil:w,Loader:P,MouseCaster:R,Scene:L,SelectionManager:q,Tools:C,Board:N,TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",ABS:"abstract"},I=function(e){function t(){return Object(r.a)(this,t),Object(a.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.scene=new A.Scene({element:document.getElementById("view"),cameraPosition:{x:0,y:150,z:150}},!0),this.gridSpace=new A.HexGrid({cellSize:5}),this.gridSpace.generate({size:75}),this.mouse=new A.MouseCaster(this.scene.container,this.scene.camera),this.board=new A.Board(this.gridSpace),this.board.generateTilemap({tileScale:.965}),this.board.generateTerrain(),this.scene.add(this.board.group),this.scene.focusOn(this.board.group),this.mouse.signal.add((function(e,t){e===A.MouseCaster.CLICK&&t.toggle()}),this),this.update()}},{key:"update",value:function(){var e=this;this.mouse.update(),this.scene.render(),requestAnimationFrame((function(){e.update()}))}},{key:"render",value:function(){return l.a.createElement("div",{className:"App"},l.a.createElement("div",{id:"view"}))}}]),t}(l.a.Component);h.a.render(l.a.createElement(I,null),document.getElementById("root"))}},[[12,1,2]]]);
//# sourceMappingURL=main.2e3be1b7.chunk.js.map