(window["webpackJsonpthreejs-tilemap"]=window["webpackJsonpthreejs-tilemap"]||[]).push([[0],{143:function(e,t,i){"use strict";i.r(t);var n=i(1),s=i.n(n),o=i(44),a=i.n(o),l=(i(55),i(2)),r=i(3),h=i(12),c=i(11),u=i(13),d=(i(56),i(18)),m=i(14),g=function(){function e(t,i,n,s){Object(l.a)(this,e),this.q=void 0,this.r=void 0,this.s=void 0,this.h=void 0,this.tile=void 0,this.userData=void 0,this.walkable=void 0,this._calcCost=void 0,this._priority=void 0,this._visited=void 0,this._parent=void 0,this.uniqueID=void 0,this.q=t||0,this.r=i||0,this.s=n||0,this.h=s||1,this.tile=null,this.userData={},this.walkable=!0,this._calcCost=0,this._priority=0,this._visited=!1,this._parent=null,this.uniqueID=U.LinkedList.generateID()}return Object(r.a)(e,[{key:"set",value:function(e,t,i){return this.q=e,this.r=t,this.s=i,this}},{key:"copy",value:function(e){return this.q=e.q,this.r=e.r,this.s=e.s,this.h=e.h,this.tile=e.tile||null,this.userData=e.userData||{},this.walkable=e.walkable,this}},{key:"add",value:function(e){return this.q+=e.q,this.r+=e.r,this.s+=e.s,this}},{key:"equals",value:function(e){return this.q===e.q&&this.r===e.r&&this.s===e.s}},{key:"resetPath",value:function(){this._calcCost=0,this._priority=0,this._parent=null,this._visited=!1}}]),e}(),p=i(0),v=function(){function e(t){Object(l.a)(this,e),this.cell=void 0,this.geometry=void 0,this.material=void 0,this.mesh=void 0,this.selected=void 0,this.highlight=void 0,this.userData=void 0,this.entity=void 0,this.position=void 0,this.rotation=void 0,this.uniqueID=void 0,this.objectType=void 0,this._emissive=void 0,t=t||{};var i={cell:null,geometry:null,material:null};if(!(i=U.Tools.merge(i,t)).cell||!i.geometry)throw new Error("Missing TM.Tile configuration");this.cell=i.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),this.cell.tile=this,this.uniqueID=U.Tools.generateID(),this.geometry=i.geometry,this.material=i.material,this.material||(this.material=new p.l({color:U.Tools.randomizeRGB("0, 105, 148",13)})),this.objectType=U.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight=33996,this.mesh=new p.k(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=-90*U.DEG_TO_RAD,this.mesh.scale.set(i.scale,i.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null}return Object(r.a)(e,[{key:"select",value:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,console.log(this.position),this}},{key:"deselect",value:function(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this}},{key:"toggle",value:function(){return this.selected?this.deselect():this.select(),this}},{key:"dispose",value:function(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},{key:"setTerrain",value:function(e,t){if(this.userData.elevation=e,this.userData.moisture=t,!(e<.02))return e<.06?(this.userData.terrain="BEACH",void this.material.color.set(U.Tools.randomizeRGB("194,178,128",13))):e<.3?(this.userData.terrain="PLAIN",void this.material.color.set(U.Tools.randomizeRGB("70,118,58",13))):e<1?(this.userData.terrain="MOUNTAIN",void this.material.color.set(U.Tools.randomizeRGB("107,110,112",13))):void 0;this.userData.terrain="OCEAN"}}]),e}(),f=function(){function e(t){var i;Object(l.a)(this,e),this.type=void 0,this.size=void 0,this.cellSize=void 0,this.cells=void 0,this.numCells=void 0,this.autogenerated=void 0,this.extrudeSettings=void 0,this.cellShape=void 0,this.cellGeo=void 0,this.cellShapeGeo=void 0,this._cellWidth=void 0,this._cellLength=void 0,this._hashDelimeter=void 0,this._directions=void 0,this._diagonals=void 0,this._list=void 0,this._vec3=void 0,this._cel=void 0,this._geoCache=void 0,this._matCache=void 0,t=t||{},this.type=U.HEX,this.size="undefined"===typeof t.cellSize?10:t.gridSize,this.cellSize="undefined"===typeof t.cellSize?10:t.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var n=[];for(i=0;i<6;i++)n.push(this._createVertex(i));for(this.cellShape=new p.s,this.cellShape.moveTo(n[0].x,n[0].y),i=1;i<6;i++)this.cellShape.lineTo(n[i].x,n[i].y);this.cellShape.lineTo(n[0].x,n[0].y),this.cellShape.autoClose=!0,this.cellGeo=new p.b,this.cellGeo.vertices=n,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new p.t(this.cellShape),this._cellWidth=2*this.cellSize,this._cellLength=.5*U.SQRT3*this._cellWidth,this._hashDelimeter=".",this._directions=[new g(1,-1,0),new g(1,0,-1),new g(0,1,-1),new g(-1,1,0),new g(-1,0,1),new g(0,-1,1)],this._diagonals=[new g(2,-1,-1),new g(1,1,-2),new g(-1,2,-1),new g(-2,1,1),new g(-1,-1,2),new g(1,-2,1)],this._list=[],this._vec3=new p.y,this._cel=new g,this._geoCache=[],this._matCache=[],t&&this.generateGrid(t)}return Object(r.a)(e,null,[{key:"TWO_THIRDS",get:function(){return 2/3}}]),Object(r.a)(e,[{key:"cellToPixel",value:function(e){return this._vec3.x=e.q*this._cellWidth*.75,this._vec3.y=e.h,this._vec3.z=-(e.s-e.r)*this._cellLength*.5,this._vec3}},{key:"pixelToCell",value:function(t){var i=t.x*(e.TWO_THIRDS/this.cellSize),n=(-t.x/3+U.SQRT3/3*t.z)/this.cellSize;return this._cel.set(i,n,-i-n),this._cubeRound(this._cel)}},{key:"getCellAt",value:function(t){var i=t.x*(e.TWO_THIRDS/this.cellSize),n=(-t.x/3+U.SQRT3/3*t.z)/this.cellSize;return this._cel.set(i,n,-i-n),this._cubeRound(this._cel),this.cells[this.cellToHash(this._cel)]}},{key:"getNeighbors",value:function(e,t,i){var n,s,o=this._directions.length;for(this._list.length=0,n=0;n<o;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(s=this.cells[this.cellToHash(this._cel)])||i&&!i(e,s)||this._list.push(s);if(t)for(n=0;n<o;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(s=this.cells[this.cellToHash(this._cel)])||i&&!i(e,s)||this._list.push(s);return this._list}},{key:"getRandomCell",value:function(){var e,t=0,i=U.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]}},{key:"cellToHash",value:function(e){return e.q+this._hashDelimeter+e.r+this._hashDelimeter+e.s}},{key:"distance",value:function(e,t){var i=Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r),Math.abs(e.s-t.s));return i+=t.h-e.h}},{key:"clearPath",value:function(){var e;for(e in this.cells)this.cells[e].resetPath()}},{key:"traverse",value:function(e){var t;for(t in this.cells)e(this.cells[t])}},{key:"generateTile",value:function(e,t,i){var n=Math.abs(e.h);n<1&&(n=1);var s=this._geoCache[n];s||(this.extrudeSettings.amount=n,s=new p.e(this.cellShape,this.extrudeSettings),this._geoCache[n]=s);var o=new v({scale:t,cell:e,geometry:s,material:i});return e.tile=o,o}},{key:"generateTilemap",value:function(e){e=e||{};var t,i,n,s=[],o={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:10,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in o=U.Tools.merge(o,e),this.cellSize=o.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*U.SQRT3*this._cellWidth,this.autogenerated=!0,this.extrudeSettings=o.extrudeSettings,this.cells)n=this.cells[t],(i=this.generateTile(n,o.tileScale,o.material)).position.copy(this.cellToPixel(n)),i.position.y=0,s.push(i);return s}},{key:"generateGrid",value:function(e){var t,i,n,s;for(e=e||{},this.size="undefined"===typeof e.gridSize?this.size:e.gridSize,t=-this.size;t<this.size+1;t++)for(i=-this.size;i<this.size+1;i++)n=-t-i,Math.abs(t)<=this.size&&Math.abs(i)<=this.size&&Math.abs(n)<=this.size&&(s=new g(t,i,n),this.add(s))}},{key:"generateOverlay",value:function(e,t,i){var n,s,o,a=this.cellShape.createPointsGeometry(6);for(n=-e;n<e+1;n++)for(s=-e;s<e+1;s++)if(o=-n-s,Math.abs(n)<=e&&Math.abs(s)<=e&&Math.abs(o)<=e){this._cel.set(n,s,o);var l=new p.g(a,i);l.position.copy(this.cellToPixel(this._cel)),l.rotation.x=90*U.DEG_TO_RAD,t.add(l)}t.position.y=.5}},{key:"add",value:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e}},{key:"remove",value:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)}},{key:"dispose",value:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._geoCache=null,this._matCache=null}},{key:"load",value:function(e,t,i){var n=this;U.Tools.getJSON({url:e,callback:function(e){n.fromJSON(e),t.call(i||null,e)},cache:!1,scope:n})}},{key:"fromJSON",value:function(e){var t,i,n=e.cells;this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._cellWidth=2*this.cellSize,this._cellLength=.5*U.SQRT3*this._cellWidth,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated;var s=Object.keys(e).length;for(t=0;t<s;t++)(i=new g).copy(n[t]),this.add(i)}},{key:"toJSON",value:function(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated,cells:null},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=n,i}},{key:"_createVertex",value:function(e){var t=U.TAU/6*e;return new p.y(this.cellSize*Math.cos(t),this.cellSize*Math.sin(t),0)}},{key:"_cubeRound",value:function(e){var t=Math.round(e.q),i=Math.round(e.r),n=Math.round(e.s),s=Math.abs(t-e.q),o=Math.abs(i-e.r),a=Math.abs(n-e.s);return s>o&&s>a?t=-i-n:o>a?i=-t-n:n=-t-i,this._cel.set(t,i,n)}}]),e}(),_=function(){function e(t){Object(l.a)(this,e),this.type=void 0,this.size=void 0,this.cellSize=void 0,this.cells=void 0,this.numCells=void 0,this.extrudeSettings=void 0,this.cellShape=void 0,this.cellGeo=void 0,this.cellShapeGeo=void 0,this.autogenerated=void 0,this._fullCellSize=void 0,this._hashDelimeter=void 0,this._directions=void 0,this._diagonals=void 0,this._list=void 0,this._vec3=void 0,this._cel=void 0,this._geoCache=void 0,this._matCache=void 0,t=t||{},this.type=U.SQR,this.size=5,this.cellSize="undefined"===typeof t.cellSize?10:t.cellSize,this.cells={},this.numCells=0,this.extrudeSettings=null,this.autogenerated=!1;var i=[];i.push(new p.y),i.push(new p.y(-this.cellSize,this.cellSize)),i.push(new p.y(this.cellSize,this.cellSize)),i.push(new p.y(this.cellSize,-this.cellSize)),this.cellShape=new p.s,this.cellShape.moveTo(-this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,this.cellSize),this.cellShape.lineTo(this.cellSize,-this.cellSize),this.cellShape.lineTo(-this.cellSize,-this.cellSize),this.cellGeo=new p.b,this.cellGeo.vertices=i,this.cellGeo.verticesNeedUpdate=!0,this.cellShapeGeo=new p.t(this.cellShape),this._fullCellSize=2*this.cellSize,this._hashDelimeter=".",this._directions=[new U.Cell(1,0,0),new U.Cell(0,-1,0),new U.Cell(-1,0,0),new U.Cell(0,1,0)],this._diagonals=[new U.Cell(-1,-1,0),new U.Cell(-1,1,0),new U.Cell(1,1,0),new U.Cell(1,-1,0)],this._list=[],this._vec3=new p.y,this._cel=new U.Cell,this._geoCache=[],this._matCache=[],this.generateGrid(t)}return Object(r.a)(e,[{key:"cellToPixel",value:function(e){return this._vec3.x=e.q*this._fullCellSize,this._vec3.y=e.h,this._vec3.z=e.r*this._fullCellSize,this._vec3}},{key:"pixelToCell",value:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,i,0)}},{key:"getCellAt",value:function(e){var t=Math.round(e.x/this._fullCellSize),i=Math.round(e.z/this._fullCellSize);return this._cel.set(t,0,i),this.cells[this.cellToHash(this._cel)]}},{key:"getNeighbors",value:function(e,t,i){var n,s,o=this._directions.length;for(this._list.length=0,n=0;n<o;n++)this._cel.copy(e),this._cel.add(this._directions[n]),!(s=this.cells[this.cellToHash(this._cel)])||i&&!i(e,s)||this._list.push(s);if(t)for(n=0;n<o;n++)this._cel.copy(e),this._cel.add(this._diagonals[n]),!(s=this.cells[this.cellToHash(this._cel)])||i&&!i(e,s)||this._list.push(s);return this._list}},{key:"getRandomCell",value:function(){var e,t=0,i=U.Tools.randomInt(0,this.numCells);for(e in this.cells){if(t===i)return this.cells[e];t++}return this.cells[e]}},{key:"cellToHash",value:function(e){return e.q+this._hashDelimeter+e.r}},{key:"distance",value:function(e,t){var i=Math.max(Math.abs(e.q-t.q),Math.abs(e.r-t.r));return i+=t.h-e.h}},{key:"clearPath",value:function(){var e,t;for(e in this.cells)(t=this.cells[e])._calcCost=0,t._priority=0,t._parent=null,t._visited=!1}},{key:"traverse",value:function(e){var t;for(t in this.cells)e(this.cells[t])}},{key:"generateTile",value:function(e,t,i){var n=Math.abs(e.h);n<1&&(n=1);var s=this._geoCache[n];s||(this.extrudeSettings.amount=n,s=new p.e(this.cellShape,this.extrudeSettings),this._geoCache[n]=s);var o=new v({scale:t,cell:e,geometry:s,material:i});return e.tile=o,o}},{key:"generateTilemap",value:function(e){e=e||{};var t,i,n,s=[],o={tileScale:.95,cellSize:this.cellSize,material:null,extrudeSettings:{amount:1,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5}};for(t in o=U.Tools.merge(o,e),this.cellSize=o.cellSize,this._fullCellSize=2*this.cellSize,this.autogenerated=!0,this.extrudeSettings=o.extrudeSettings,this.cells)n=this.cells[t],(i=this.generateTile(n,o.tileScale,o.material)).position.copy(this.cellToPixel(n)),i.position.y=0,s.push(i);return s}},{key:"generateGrid",value:function(e){var t,i,n;e=e||{},this.size="undefined"===typeof e.gridSize?this.size:e.gridSize;var s=Math.ceil(this.size/2);for(t=-s;t<s;t++)for(i=-s;i<s;i++)n=new U.Cell(t,i+1),this.add(n)}},{key:"generateOverlay",value:function(e,t,i){var n,s,o=Math.ceil(e/2);for(n=-o;n<o;n++)for(s=-o;s<o;s++){this._cel.set(n,s,void 0);var a=new p.g(this.cellGeo,i);a.position.copy(this.cellToPixel(this._cel)),a.rotation.x=90*U.DEG_TO_RAD,t.add(a)}}},{key:"add",value:function(e){var t=this.cellToHash(e);if(!this.cells[t])return this.cells[t]=e,this.numCells++,e}},{key:"remove",value:function(e){var t=this.cellToHash(e);this.cells[t]&&(delete this.cells[t],this.numCells--)}},{key:"dispose",value:function(){this.cells=null,this.numCells=0,this.cellShape=null,this.cellGeo.dispose(),this.cellGeo=null,this.cellShapeGeo.dispose(),this.cellShapeGeo=null,this._list=null,this._vec3=null,this._geoCache=null,this._matCache=null}},{key:"load",value:function(e,t,i){U.Tools.getJSON({url:e,callback:function(e){this.fromJSON(e),t.call(i||null,e)},cache:!1,scope:this})}},{key:"fromJSON",value:function(e){var t,i,n=e.cells;for(this.cells={},this.numCells=0,this.size=e.size,this.cellSize=e.cellSize,this._fullCellSize=2*this.cellSize,this.extrudeSettings=e.extrudeSettings,this.autogenerated=e.autogenerated,t=0;t<n.length;t++)(i=new U.Cell).copy(n[t]),this.add(i)}},{key:"toJSON",value:function(){var e,t,i={size:this.size,cellSize:this.cellSize,extrudeSettings:this.extrudeSettings,autogenerated:this.autogenerated},n=[];for(t in this.cells)e=this.cells[t],n.push({q:e.q,r:e.r,s:e.s,h:e.h,walkable:e.walkable,userData:e.userData});return i.cells=n,i}}]),e}(),b=function e(){Object(l.a)(this,e),this.obj=null,this.next=null,this.prev=null,this.free=!0},y=function(){function e(){Object(l.a)(this,e),this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.sortArray=[]}return Object(r.a)(e,[{key:"getNode",value:function(e){return this.objToNodeMap[e.uniqueID]}},{key:"addNode",value:function(t){var i=new b;if(!t.uniqueID)try{t.uniqueID=e.generateID()}catch(n){return console.error("[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier"),null}return i.obj=t,i.free=!1,this.objToNodeMap[t.uniqueID]=i,i}},{key:"swapObjects",value:function(e,t){this.objToNodeMap[e.obj.uniqueID]=null,this.objToNodeMap[t.uniqueID]=e,e.obj=t}},{key:"add",value:function(e){var t=this.objToNodeMap[e.uniqueID];if(t){if(!1===t.free)return;t.obj=e,t.free=!1,t.next=null,t.prev=null}else t=this.addNode(e);if(this.first){if(!this.last)throw new Error("[LinkedList.add] No last in the list -- that shouldn't happen here");this.last.next=t,t.prev=this.last,this.last=t,t.next=null}else this.first=t,this.last=t,t.next=null,t.prev=null;this.length++,this.showDebug&&this.dump("after add")}},{key:"has",value:function(e){return!!this.objToNodeMap[e.uniqueID]}},{key:"moveUp",value:function(e){this.dump("before move up");var t=this.getNode(e);if(!t)throw Error("Oops, trying to move an object that isn't in the list");if(t.prev){var i=t.prev,n=i.prev;t==this.last&&(this.last=i);var s=t.next;n&&(n.next=t),t.next=i,t.prev=i.prev,i.next=s,i.prev=t,this.first==i&&(this.first=t)}}},{key:"moveDown",value:function(e){var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.next){var i=t.next;this.moveUp(i.obj),this.last==i&&(this.last=t)}}},{key:"sort",value:function(e){var t,i,n=this.sortArray,s=this.first;for(n.length=0;s;)n.push(s.obj),s=s.next;for(this.clear(),n.sort(e),i=n.length,t=0;t<i;t++)this.add(n[t])}},{key:"remove",value:function(e){var t=this.getNode(e);return!(!t||t.free)&&(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.prev||(this.first=t.next),t.next||(this.last=t.prev),t.free=!0,t.prev=null,t.next=null,this.length--,!0)}},{key:"shift",value:function(){var e=this.first;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.first=e.next,e.next||(this.last=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)}},{key:"pop",value:function(){var e=this.last;return 0===this.length?null:(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),this.last=e.prev,e.prev||(this.first=null),e.free=!0,e.prev=null,e.next=null,this.length--,e.obj)}},{key:"concat",value:function(e){for(var t=e.first;t;)this.add(t.obj),t=t.next}},{key:"clear",value:function(){for(var e=this.first;e;)e.free=!0,e=e.next;this.first=null,this.length=0}},{key:"dispose",value:function(){for(var e=this.first;e;)e.obj=null,e=e.next;this.first=null,this.objToNodeMap=null}},{key:"dump",value:function(e){console.log("===================="+e+"=====================");for(var t=this.first;t;)console.log("{"+t.obj.toString()+"} previous="+(t.prev?t.prev.obj:"NULL")),t=t.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}}],[{key:"generateID",value:function(e){return Math.random().toString(36).slice(2)+Date.now()}}]),e}(),w=function(){function e(t,i,n,s,o){Object(l.a)(this,e),this._listener=i,this.isOnce=n,this.context=s,this.signal=t,this._priority=o||0}return Object(r.a)(e,[{key:"execute",value:function(t){var i,n;return e.active&&this._listener&&(n=this.params?this.params.concat(t):t,i=this._listener.apply(this.context,n),this.isOnce&&this.detach()),i}},{key:"detach",value:function(){return this.isBound()?this.signal.remove(this._listener,this.context):null}},{key:"isBound",value:function(){return!!this.signal&&!!this._listener}},{key:"_destroy",value:function(){delete this.signal,delete this._listener,delete this.context}},{key:"toString",value:function(){return"[SignalBinding isOnce:"+this.isOnce+", isBound:"+this.isBound()+", active:"+e.active+"]"}}]),e}();w.active=!0,w.params=null;var S=function(){function e(){Object(l.a)(this,e),this._bindings=[],this._prevParams=null}return Object(r.a)(e,[{key:"validateListener",value:function(e,t){if("function"!==typeof e)throw new Error("Signal: listener is a required param of {fn}() and should be a.".replace("{fn}",t))}},{key:"_registerListener",value:function(t,i,n,s){var o,a=this._indexOfListener(t,n);if(-1!==a){if((o=this._bindings[a]).isOnce!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.")}else o=new w(this,t,i,n,s),this._addBinding(o);return e.memorize&&this._prevParams&&o.execute(this._prevParams),o}},{key:"_addBinding",value:function(e){var t=this._bindings.length;do{t--}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)}},{key:"_indexOfListener",value:function(e,t){for(var i,n=this._bindings.length;n--;)if((i=this._bindings[n])._listener===e&&i.context===t)return n;return-1}},{key:"has",value:function(e,t){return-1!==this._indexOfListener(e,t)}},{key:"add",value:function(e,t,i){return this.validateListener(e,"add"),this._registerListener(e,!1,t,i)}},{key:"addOnce",value:function(e,t,i){return this.validateListener(e,"addOnce"),this._registerListener(e,!0,t,i)}},{key:"remove",value:function(e,t){this.validateListener(e,"remove");var i=this._indexOfListener(e,t);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),e}},{key:"removeAll",value:function(e){"undefined"===typeof e&&(e=null);for(var t=this._bindings.length;t--;)e?this._bindings[t].context===e&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();e||(this._bindings.length=0)}},{key:"getNumListeners",value:function(){return this._bindings.length}},{key:"halt",value:function(){e._shouldPropagate=!1}},{key:"dispatch",value:function(){if(e.active){var t,i=Array.prototype.slice.call(arguments),n=this._bindings.length;if(e.memorize&&(this._prevParams=i),n){t=this._bindings.slice(),e._shouldPropagate=!0;do{n--}while(t[n]&&e._shouldPropagate&&!1!==t[n].execute(i))}}}},{key:"forget",value:function(){this._prevParams=null}},{key:"dispose",value:function(){this.removeAll(),delete this._bindings,delete this._prevParams}},{key:"toString",value:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}}]),e}();S.memorize=!1,S._shouldPropagate=!0,S.active=!0;var k=new(function(){function e(){Object(l.a)(this,e)}return Object(r.a)(e,[{key:"backtrace",value:function(e){for(var t=[e];e._parent;)e=e._parent,t.push(e);return t.reverse()}},{key:"biBacktrace",value:function(e,t){var i=this.backtrace(e),n=this.backtrace(t);return i.concat(n.reverse())}},{key:"pathLength",value:function(e){var t,i,n,s,o,a=0;for(t=1;t<e.length;++t)i=e[t-1],n=e[t],s=i[0]-n[0],o=i[1]-n[1],a+=Math.sqrt(s*s+o*o);return a}},{key:"interpolate",value:function(e,t,i,n){var s,o,a,l,r,h,c=Math.abs,u=[];for(s=e<i?1:-1,o=t<n?1:-1,r=(a=c(i-e))-(l=c(n-t));e!==i||t!==n;)u.push([e,t]),(h=2*r)>-l&&(r-=l,e+=s),h<a&&(r+=a,t+=o);return u}},{key:"expandPath",value:function(e){var t,i,n,s,o,a,l=[],r=e.length;if(r<2)return l;for(o=0;o<r-1;++o)for(t=e[o],i=e[o+1],s=(n=this.interpolate(t[0],t[1],i[0],i[1])).length,a=0;a<s-1;++a)l.push(n[a]);return l.push(e[r-1]),l}},{key:"smoothenPath",value:function(e,t){var i,n,s,o,a,l,r,h,c,u,d,m,g=t.length,p=t[0][0],v=t[0][1],f=t[g-1][0],_=t[g-1][1];for(a=[[i=p,n=v]],r=2;r<g;++r){for(s=(c=t[r])[0],o=c[1],u=this.interpolate(i,n,s,o),m=!1,h=1;h<u.length;++h)if(d=u[h],!e.isWalkableAt(d[0],d[1])){m=!0;break}m&&(l=t[r-1],a.push(l),i=l[0],n=l[1])}return a.push([f,_]),a}},{key:"compressPath",value:function(e){if(e.length<3)return e;var t,i,n,s,o,a,l=[],r=e[0][0],h=e[0][1],c=e[1][0],u=e[1][1],d=c-r,m=u-h;for(d/=o=Math.sqrt(d*d+m*m),m/=o,l.push([r,h]),a=2;a<e.length;a++)t=c,i=u,n=d,s=m,d=(c=e[a][0])-t,m=(u=e[a][1])-i,m/=o=Math.sqrt(d*d+m*m),(d/=o)===n&&m===s||l.push([t,i]);return l.push([c,u]),l}}]),e}()),T=i(29),x=i.n(T),z=i(30),O=i.n(z),D=x.a.create(Date.now()*Math.random()*100),C=x.a.create(Date.now()*Math.random()*100),A=new O.a(D.nextDouble.bind(D)),E=new O.a(C.nextDouble.bind(C));var P={clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},sign:function(e){return e&&e/Math.abs(e)},random:function(e,t){return 1===arguments.length?Math.random()*e-.5*e:Math.random()*(t-e)+e},noise1:function(e,t){return A.noise2D(e,t)/2+.5},noise2:function(e,t){return E.noise2D(e,t)/2+.5},randomInt:function(e,t){return 1===arguments.length?Math.random()*e-.5*e|0:Math.random()*(t-e+1)+e|0},normalize:function(e,t,i){return(e-t)/(i-t)},getShortRotation:function(e){return(e%=this.TAU)>this.PI?e-=this.TAU:e<-this.PI&&(e+=this.TAU),e},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(e){if("object"!==typeof e||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},merge:function(e,t){var i=this,n=Array.isArray(t),s=n&&[]||{};return n?(e=e||[],s=s.concat(e),t.forEach((function(t,n){"undefined"===typeof s[n]?s[n]=t:i.isPlainObject(t)?s[n]=i.merge(e[n],t):-1===e.indexOf(t)&&s.push(t)})),s):(e&&i.isPlainObject(e)&&Object.keys(e).forEach((function(t){s[t]=e[t]})),Object.keys(t).forEach((function(n){t[n]&&i.isPlainObject(t[n])&&e[n]?s[n]=i.merge(e[n],t[n]):s[n]=t[n]})),s)},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},radixSort:function(e,t,i,n){if(n=n||31,!((t=t||0)>=(i=i||e.length)-1||n<0)){for(var s=t,o=i,a=1<<n;s<o;)if(e[s]&a){--o;var l=e[s];e[s]=e[o],e[o]=l}else++s;this.radixSort(e,t,o,n-1),this.radixSort(e,o,i,n-1)}},randomizeRGB:function(e,t){var i,n,s=e.split(","),o="rgb(",a=[];for(t=this.randomInt(t),i=0;i<3;i++)(n=parseInt(s[i])+t)<0?n=0:n>255&&(n=255),o+=n+",",a.push(n);return o=o.substring(0,o.length-1),o+=")"},getJSON:function(e){var t=new XMLHttpRequest,i="undefined"!==typeof e.cache&&e.cache?e.url:e.url+"?t="+Math.floor(1e4*Math.random())+Date.now();t.onreadystatechange=function(){if(200!==this.status)0!==this.status&&console.warn("[Tools.getJSON] Error: "+this.status+" ("+this.statusText+") :: "+e.url);else{var t=null;try{t=JSON.parse(this.responseText)}catch(i){return}e.callback.call(e.scope||null,t)}},t.open("GET",i,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Content-Type","application/json"),t.send("")}},j=function(){function e(t){Object(l.a)(this,e),this.allowDiagonal=void 0,this.heuristicFilter=void 0,this.list=void 0,t=t||{};var i={allowDiagonal:!1,heuristicFilter:null};i=P.merge(i,t),this.allowDiagonal=i.allowDiagonal,this.heuristicFilter=i.heuristicFilter,this.list=new y}return Object(r.a)(e,[{key:"findPath",value:function(e,t,i,n){var s,o,a,l,r,h;for(i=i||this.heuristicFilter,n.clearPath(),this.list.clear(),this.list.add(e);this.list.length>0;){if(this.list.sort(this.compare),(s=this.list.shift().obj)._visited=!0,s===t)return k.backtrace(t);for(r=0,h=(a=n.getNeighbors(s,this.allowDiagonal,i)).length;r<h;r++)if((l=a[r]).walkable&&(o=s._calcCost+n.distance(s,l),!l._visited||o<l._calcCost)){if(l._visited=!0,l._parent=s,l._calcCost=o,l._priority=o+n.distance(t,l),l===t)return k.backtrace(t);this.list.add(l)}}return null}},{key:"compare",value:function(e,t){return e._priority-t._priority}}]),e}(),M={manager:null,imageLoader:null,crossOrigin:!1,init:function(e){this.crossOrigin=e||!1,this.manager=new p.i((function(){}),(function(){}),(function(){console.warn("Error loading images")})),this.imageLoader=new p.f(this.manager),this.imageLoader.crossOrigin=e},loadTexture:function(e,t,i,n){var s=new p.w(null,t);return this.imageLoader.load(e,(function(e){s.image=e,s.needsUpdate=!0,i&&i(s)}),null,(function(e){n&&n(e)})),s.sourceFile=e,s}},L=function(){function e(t,i,n){Object(l.a)(this,e),this.down=!1,this.rightDown=!1,this.pickedObject=null,this.selectedObject=null,this.allHits=null,this.active=!0,this.shift=!1,this.ctrl=!1,this.wheel=0,this.position=new p.y,this.screenPosition=new p.x,this.signal=new U.Signal,this.group=t,this._camera=i,this._raycaster=new p.q,this._preventDefault=!1,this.element=n||document,this.element.addEventListener("mousemove",this._onDocumentMouseMove.bind(this),!1),this.element.addEventListener("mousedown",this._onDocumentMouseDown.bind(this),!1),this.element.addEventListener("mouseup",this._onDocumentMouseUp.bind(this),!1),this.element.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),this.element.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1)}return Object(r.a)(e,[{key:"dispose",value:function(){this.element.removeEventListener("mousemove",this._onDocumentMouseDown,!1),this.element.removeEventListener("mousedown",this._onDocumentMouseDown,!1),this.element.removeEventListener("mouseup",this._onDocumentMouseUp,!1),this.element.removeEventListener("mousewheel",this._onMouseWheel,!1),this.element.removeEventListener("DOMMouseScroll",this._onMouseWheel,!1)}},{key:"update",value:function(){if(this.active){this._raycaster.setFromCamera(this.screenPosition,this._camera);var e,t,i=this._raycaster.intersectObject(this.group,!0);i.length>0?(t=(e=i[0]).object.userData.structure,this.pickedObject!=t&&(this.pickedObject&&this.signal.dispatch("out",this.pickedObject),this.pickedObject=t,this.selectedObject=null,this.signal.dispatch("over",this.pickedObject)),this.position.copy(e.point),this.screenPosition.z=e.distance):(this.pickedObject&&this.signal.dispatch("out",this.pickedObject),this.pickedObject=null,this.selectedObject=null),this.allHits=i}}},{key:"preventDefault",value:function(){this._preventDefault=!0}},{key:"_onDocumentMouseDown",value:function(e){if(e=e||window.event,this._preventDefault)return this._preventDefault=!1,!1;this.pickedObject&&(this.selectedObject=this.pickedObject),this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.down=1===e.which,this.rightDown=3===e.which,this.signal.dispatch("down",this.pickedObject)}},{key:"_onDocumentMouseUp",value:function(e){if(e.preventDefault(),this._preventDefault)return this._preventDefault=!1,!1;this.shift=e.shiftKey,this.ctrl=e.ctrlKey,this.signal.dispatch("up",this.pickedObject),this.selectedObject&&this.pickedObject&&this.selectedObject.uniqueID===this.pickedObject.uniqueID&&this.signal.dispatch("click",this.pickedObject),this.down=1!==e.which&&this.down,this.rightDown=3!==e.which&&this.rightDown}},{key:"_onDocumentMouseMove",value:function(e){e.preventDefault(),this.screenPosition.x=e.clientX/window.innerWidth*2-1,this.screenPosition.y=-e.clientY/window.innerHeight*2+1,this.signal.dispatch("move",e)}},{key:"_onMouseWheel",value:function(e){if(this.active){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?this.wheel++:this.wheel--,console.log(this.wheel),this.signal.dispatch("wheel",this.wheel)}}},{key:"mouseToWorld",value:function(e,t){if(e){var i=new p.y(e.x/window.innerWidth*2-1,-e.y/window.innerHeight*2+1,.5);return this.pickingRay(i,t).ray.intersectPlane(new p.o(new p.y(0,0,1),0))}var n=new p.y(this.screenPosition.x/window.innerWidth*2-1,-this.screenPosition.y/window.innerHeight*2+1,.5);return this.pickingRay(n,t).ray.intersectPlane(new p.o(new p.y(0,0,1),0))}},{key:"pickingRay",value:function(e,t){e.z=-1;var i=new p.y(e.x,e.y,1);return e.unproject(t),i.unproject(t),i.sub(e).normalize(),new p.q(e,i)}}]),e}();L.OVER="over",L.OUT="out",L.DOWN="down",L.UP="up",L.CLICK="click",L.WHEEL="wheel",L.MOVE="move";var R=L,N=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new p.y,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=10,this.autoRotate=!1,this.autoRotateSpeed=1,this.enableKeys=!0,this.keys={LEFT:65,UP:87,RIGHT:68,BOTTOM:83},this.mouseButtons={LEFT:p.j.ROTATE,MIDDLE:p.j.DOLLY,RIGHT:p.j.PAN},this.touches={ONE:p.v.ROTATE,TWO:p.v.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return h.phi},this.getAzimuthalAngle=function(){return h.theta},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(n),i.update(),l=a.NONE},this.setZoom=function(e){console.log("set zoom"),i.enableZoom=e,i.enableZoom?i.domElement.addEventListener("wheel",q,!1):(console.log(i.domElement),i.domElement.removeEventListener("wheel",q,!1))},this.update=function(){var t=new p.y,s=(new p.p).setFromUnitVectors(e.up,new p.y(0,1,0)),o=s.clone().inverse(),g=new p.y,v=new p.p;return function(){var e=i.object.position;return t.copy(e).sub(i.target),t.applyQuaternion(s),h.setFromVector3(t),i.autoRotate&&l===a.NONE&&x(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(h.theta+=c.theta*i.dampingFactor,h.phi+=c.phi*i.dampingFactor):(h.theta+=c.theta,h.phi+=c.phi),h.theta=Math.max(i.minAzimuthAngle,Math.min(i.maxAzimuthAngle,h.theta)),h.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,h.phi)),h.makeSafe(),h.radius*=u,h.radius=Math.max(i.minDistance,Math.min(i.maxDistance,h.radius)),!0===i.enableDamping?i.target.addScaledVector(d,i.dampingFactor):i.target.add(d),t.setFromSpherical(h),t.applyQuaternion(o),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(c.theta*=1-i.dampingFactor,c.phi*=1-i.dampingFactor,d.multiplyScalar(1-i.dampingFactor)):(c.set(0,0,0),d.set(0,0,0)),u=1,!!(m||g.distanceToSquared(i.object.position)>r||8*(1-v.dot(i.object.quaternion))>r)&&(i.dispatchEvent(n),g.copy(i.object.position),v.copy(i.object.quaternion),m=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Z,!1),i.domElement.removeEventListener("mousedown",H,!1),i.domElement.removeEventListener("wheel",q,!1),i.domElement.removeEventListener("touchstart",U,!1),i.domElement.removeEventListener("touchend",B,!1),i.domElement.removeEventListener("touchmove",Y,!1),document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",F,!1),window.removeEventListener("keydown",W,!1)},this.rotateUp=z;var i=this,n={type:"change"},s={type:"start"},o={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},l=a.NONE,r=1e-6,h=new p.u,c=new p.u,u=1,d=new p.y,m=!1,g=new p.x,v=new p.x,f=new p.x,_=new p.x,b=new p.x,y=new p.x,w=new p.x,S=new p.x,k=new p.x;function T(){return Math.pow(.95,i.zoomSpeed)}function x(e){c.theta-=e}function z(e){c.phi-=e}var O=function(){var e=new p.y;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),d.add(e)}}(),D=function(){var e=new p.y;return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),d.add(e)}}();function C(e){i.object.isPerspectiveCamera?u/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function A(e){i.object.isPerspectiveCamera?u*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function E(e){g.set(e.clientX,e.clientY)}function P(e){_.set(e.clientX,e.clientY)}function j(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,i)}}function M(e){if(1==e.touches.length)_.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(t,i)}}function L(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);w.set(0,n)}function R(e){if(1==e.touches.length)v.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(t,n)}f.subVectors(v,g).multiplyScalar(i.rotateSpeed);var s=i.domElement===document?i.domElement.body:i.domElement;x(2*Math.PI*f.x/s.clientHeight),z(2*Math.PI*f.y/s.clientHeight),g.copy(v)}function N(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,n)}y.subVectors(b,_).multiplyScalar(i.panSpeed),i.pan(y.x,y.y),_.copy(b)}function I(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(t*t+n*n);S.set(0,s),k.set(0,Math.pow(S.y/w.y,i.zoomSpeed)),C(k.y),w.copy(S)}function H(e){if(!1!==i.enabled){switch(e.preventDefault(),i.domElement.focus?i.domElement.focus():window.focus(),e.button){case 0:switch(i.mouseButtons.LEFT){case p.j.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;P(e),l=a.PAN}else{if(!1===i.enableRotate)return;E(e),l=a.ROTATE}break;case p.j.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;E(e),l=a.ROTATE}else{if(!1===i.enablePan)return;P(e),l=a.PAN}break;default:l=a.NONE}break;case 1:switch(i.mouseButtons.MIDDLE){case p.j.DOLLY:if(!1===i.enableZoom)return;!function(e){w.set(e.clientX,e.clientY)}(e),l=a.DOLLY;break;default:l=a.NONE}break;case 2:switch(i.mouseButtons.RIGHT){case p.j.ROTATE:if(!1===i.enableRotate)return;E(e),l=a.ROTATE;break;case p.j.PAN:if(!1===i.enablePan)return;P(e),l=a.PAN;break;default:l=a.NONE}}l!==a.NONE&&(document.addEventListener("mousemove",G,!1),document.addEventListener("mouseup",F,!1),i.dispatchEvent(s))}}function G(e){if(!1!==i.enabled)switch(e.preventDefault(),l){case a.ROTATE:if(!1===i.enableRotate)return;!function(e){v.set(e.clientX,e.clientY),f.subVectors(v,g).multiplyScalar(i.rotateSpeed);var t=i.domElement===document?i.domElement.body:i.domElement;x(2*Math.PI*f.x/t.clientHeight),z(2*Math.PI*f.y/t.clientHeight),g.copy(v),i.update()}(e);break;case a.DOLLY:if(!1===i.enableZoom)return;!function(e){S.set(e.clientX,e.clientY),k.subVectors(S,w),k.y>0?C(T()):k.y<0&&A(T()),w.copy(S),i.update()}(e);break;case a.PAN:if(!1===i.enablePan)return;!function(e){b.set(e.clientX,e.clientY),y.subVectors(b,_).multiplyScalar(i.panSpeed),i.pan(y.x,y.y),_.copy(b),i.update()}(e)}}function F(e){!1!==i.enabled&&(document.removeEventListener("mousemove",G,!1),document.removeEventListener("mouseup",F,!1),i.dispatchEvent(o),l=a.NONE)}function q(e){!1===i.enabled||!1===i.enableZoom||l!==a.NONE&&l!==a.ROTATE||(e.preventDefault(),i.dispatchEvent(s),function(e){e.deltaY<0?A(T()):e.deltaY>0&&C(T()),i.update()}(e),i.dispatchEvent(o))}function W(e){!1!==i.enabled&&!1!==i.enableKeys&&!1!==i.enablePan&&function(e){var t=!1;switch(e.keyCode){case i.keys.UP:i.pan(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:i.pan(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:i.pan(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:i.pan(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function U(e){if(!1!==i.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(i.touches.ONE){case p.v.ROTATE:if(!1===i.enableRotate)return;j(e),l=a.TOUCH_ROTATE;break;case p.v.PAN:if(!1===i.enablePan)return;M(e),l=a.TOUCH_PAN;break;default:l=a.NONE}break;case 2:switch(i.touches.TWO){case p.v.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&L(e),i.enablePan&&M(e)}(e),l=a.TOUCH_DOLLY_PAN;break;case p.v.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&L(e),i.enableRotate&&j(e)}(e),l=a.TOUCH_DOLLY_ROTATE;break;default:l=a.NONE}break;default:l=a.NONE}l!==a.NONE&&i.dispatchEvent(s)}}function Y(e){if(!1!==i.enabled)switch(e.preventDefault(),l){case a.TOUCH_ROTATE:if(!1===i.enableRotate)return;R(e),i.update();break;case a.TOUCH_PAN:if(!1===i.enablePan)return;N(e),i.update();break;case a.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&I(e),i.enablePan&&N(e)}(e),i.update();break;case a.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&I(e),i.enableRotate&&R(e)}(e),i.update();break;default:l=a.NONE}}function B(e){!1!==i.enabled&&(i.dispatchEvent(o),l=a.NONE)}function Z(e){!1!==i.enabled&&e.preventDefault()}this.pan=function(){var e=new p.y;return function(t,n){var s=i.domElement===document?i.domElement.body:i.domElement;if(i.object.isPerspectiveCamera){var o=i.object.position;e.copy(o).sub(i.target);var a=e.length();a*=Math.tan(i.object.fov/2*Math.PI/180),O(2*t*a/s.clientHeight,i.object.matrix),D(2*n*a/s.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(O(t*(i.object.right-i.object.left)/i.object.zoom/s.clientWidth,i.object.matrix),D(n*(i.object.top-i.object.bottom)/i.object.zoom/s.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}(),i.domElement.addEventListener("contextmenu",Z,!1),i.domElement.addEventListener("mousedown",H,!1),i.domElement.addEventListener("wheel",q,!1),i.domElement.addEventListener("touchstart",U,!1),i.domElement.addEventListener("touchend",B,!1),i.domElement.addEventListener("touchmove",Y,!1),window.addEventListener("keydown",W,!1),this.update()};(N.prototype=Object.create(p.d.prototype)).constructor=N;var I=function(e,t){N.call(this,e,t),this.mouseButtons.LEFT=p.j.PAN,this.mouseButtons.RIGHT=p.j.ROTATE,this.touches.ONE=p.v.PAN,this.touches.TWO=p.v.DOLLY_ROTATE};(I.prototype=Object.create(p.d.prototype)).constructor=I;var H=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.easeInOutQuad;Object(l.a)(this,e),this.durationMs=t,this.update=i,this.easingFunction=n,this.progress=0}return Object(r.a)(e,[{key:"animate",value:function(e){return this.progress=this.progress+1e3*e/this.durationMs,this.update(this.easingFunction(this.progress)),this.progress>=1}}]),e}();H.easeInOutQuad=function(e){return e<.5?2*e*e:(4-2*e)*e-1},H.easeLinear=function(e){return e};var G=function(){function e(t,i){if(Object(l.a)(this,e),this._view=t,this._controls=void 0,this.animations=[],!t)throw new Error("Controller missing View reference");i&&this.initControls(i)}return Object(r.a)(e,[{key:"initControls",value:function(e){var t=this;this._view.controlled=e.controlled,this._controls=new N(this._view.camera,this._view.renderer.domElement),this._controls.minDistance=e.minDistance,this._controls.maxDistance=e.maxDistance,this._controls.zoomSpeed=e.zoomSpeed,this._view.hotEdges=e.hotEdges,this._controls.autoRotate=e.autoRotate,this._controls.enableDamping=e.enableDamping,this._controls.dampingFactor=e.dampingFactor,this._controls.screenSpacePanning=e.screenSpacePanning,this._controls.minPolarAngle=e.minPolarAngle,this._controls.maxPolarAngle=e.maxPolarAngle,e.horizontalRotation||(e.maxAzimuthAngle&&(this._controls.maxAzimuthAngle=e.maxAzimuthAngle),e.minAzimuthAngle&&(this._controls.minAzimuthAngle=e.minAzimuthAngle)),this._controls.mouseButtons={LEFT:p.j.RIGHT,MIDDLE:p.j.MIDDLE,RIGHT:p.j.LEFT};this._view.setOnAnimateCallback(function(e){for(var i=t.animations,n=0;n<i.length;n++){var s=i[n];if(s)s.animate(e)&&(i[n]=i[i.length-1],i[i.length-1]=s,i.pop())}}.bind(this))}},{key:"update",value:function(){this._controls.update()}},{key:"dispose",value:function(){this._controls.dispose()}},{key:"panInDirection",value:function(e,t,i,n){this.animations.length>=1&&this.cancelAnimation(),e&&i?this._controls.pan(15,15):e&&n?this._controls.pan(15,-15):t&&i?this._controls.pan(-15,15):t&&n?this._controls.pan(-15,-15):t?this._controls.pan(-15,0):e?this._controls.pan(15,0):i?this._controls.pan(0,15):this._controls.pan(0,-15),this._controls.update()}},{key:"addAnimation",value:function(e){this.animations.push(e)}},{key:"cancelAnimation",value:function(){this.animations.shift()}},{key:"panCameraTo",value:function(e,t){var i=this;e instanceof g&&(e=e.tile);var n=this._controls.target.clone(),s=e.position.clone();this.addAnimation(new H(t,(function(t){i._view.focusOn(e),i._controls.target=n.lerp(s,t),i._controls.update()}))),this.animations.length>1&&this.cancelAnimation()}},{key:"toggleControls",value:function(){this._view.controlled?(this._view.controlled=!1,this._controls.dispose(),delete this._controls):this.initControls(this._view.settings.cameraControlSettings)}},{key:"updateControls",value:function(e){this._view.settings.cameraControlSettings=U.Tools.merge(this._view.settings.cameraControlSettings,e),this._controls.minDistance=e.minDistance||this._controls.minDistance,this._controls.maxDistance=e.maxDistance||this._controls.maxDistance,this._controls.zoomSpeed=e.zoomSpeed||this._controls.zoomSpeed,void 0!==e.hotEdges?this._view.hotEdges=e.hotEdges:this._view.hotEdges=this._view.settings.cameraControlSettings.hotEdges,void 0!==e.autoRotate?(this.toggleHorizontalRotation(e.autoRotate),this._controls.autoRotate=e.autoRotate):this._controls.autoRotate=this._view.settings.cameraControlSettings.autoRotate,void 0!==e.enableDamping?this._controls.enableDamping=e.enableDamping:this._controls.enableDamping=this._view.settings.cameraControlSettings.enableDamping,this._controls.dampingFactor=e.dampingFactor||this._view.settings.cameraControlSettings.dampingFactor,void 0!==e.screenSpacePanning?this._controls.screenSpacePanning=e.screenSpacePanning:this._controls.screenSpacePanning=this._view.settings.cameraControlSettings.screenSpacePanning,e.minPolarAngle&&(this._controls.minPolarAngle=e.minPolarAngle),e.maxPolarAngle&&(this._controls.maxPolarAngle=e.maxPolarAngle),e.maxAzimuthAngle&&(this._controls.maxAzimuthAngle=e.maxAzimuthAngle),e.minAzimuthAngle&&(this._controls.minAzimuthAngle=e.minAzimuthAngle)}},{key:"toggleHorizontalRotation",value:function(e){e?(this._controls.dispose(),this._controls=new N(this._view.camera,this._view.renderer.domElement),this._controls.minDistance=this._view.settings.cameraControlSettings.minDistance,this._controls.maxDistance=this._view.settings.cameraControlSettings.maxDistance,this._controls.zoomSpeed=this._view.settings.cameraControlSettings.zoomSpeed,this._view.hotEdges=this._view.settings.cameraControlSettings.hotEdges,this._controls.autoRotate=this._view.settings.cameraControlSettings.autoRotate,this._controls.enableDamping=this._view.settings.cameraControlSettings.enableDamping,this._controls.screenSpacePanning=this._view.settings.cameraControlSettings.screenSpacePanning,this._controls.minPolarAngle=this._view.settings.cameraControlSettings.minPolarAngle,this._controls.maxPolarAngle=this._view.settings.cameraControlSettings.maxPolarAngle,this._controls.mouseButtons={LEFT:p.j.RIGHT,MIDDLE:p.j.MIDDLE,RIGHT:p.j.LEFT}):(this._controls.dispose(),this._controls=new N(this._view.camera,this._view.renderer.domElement),this._controls.minDistance=this._view.settings.cameraControlSettings.minDistance,this._controls.maxDistance=this._view.settings.cameraControlSettings.maxDistance,this._controls.zoomSpeed=this._view.settings.cameraControlSettings.zoomSpeed,this._view.hotEdges=this._view.settings.cameraControlSettings.hotEdges,this._controls.autoRotate=this._view.settings.cameraControlSettings.autoRotate,this._controls.enableDamping=this._view.settings.cameraControlSettings.enableDamping,this._controls.screenSpacePanning=this._view.settings.cameraControlSettings.screenSpacePanning,this._controls.minPolarAngle=this._view.settings.cameraControlSettings.minPolarAngle,this._controls.maxPolarAngle=this._view.settings.cameraControlSettings.maxPolarAngle,this._view.settings.cameraControlSettings.maxAzimuthAngle&&(this._controls.maxAzimuthAngle=this._view.settings.cameraControlSettings.maxAzimuthAngle),this._view.settings.cameraControlSettings.minAzimuthAngle&&(this._controls.minAzimuthAngle=this._view.settings.cameraControlSettings.minAzimuthAngle),this._controls.mouseButtons={LEFT:p.j.RIGHT,MIDDLE:p.j.MIDDLE,RIGHT:p.j.LEFT})}},{key:"rotateUp",value:function(e){this._controls.rotateUp(e)}}]),e}(),F=function(){function e(t){Object(l.a)(this,e),this.width=void 0,this.height=void 0,this.renderer=void 0,this.container=void 0,this.camera=void 0,this.controlled=void 0,this.settings=void 0,this.controls=void 0,this._selectedTile=void 0,this._onAnimate=function(e){},this._onTileSelected=void 0,this._onLoaded=void 0,this._lastTimestamp=Date.now(),this._animationID=void 0,this.w1=void 0,this.w2=void 0,this.h1=void 0,this.h2=void 0,this.hotEdges=void 0,this._mouseCaster=void 0,this._panning=!1,this._panningLeft=!1,this._panningRight=!1,this._panningUp=!1,this._panningDown=!1,this.board=void 0,t=t||{};var i={element:document.body,alpha:!0,antialias:!0,clearColor:"#000000",sortObjects:!1,fog:null,light:new p.c(16777215),lightPosition:null,cameraPosition:null,sceneMarginSize:20,cameraControlSettings:{controlled:!0,enableDamping:!1,dampingFactor:.05,minDistance:25,maxDistance:1250,zoomSpeed:3,hotEdges:!0,autoRotate:!1,screenSpacePanning:!1,minPolarAngle:Math.PI/6,maxPolarAngle:Math.PI/3,minAzimuthAngle:0,maxAzimuthAngle:-Math.PI,horizontalRotation:!1}};void 0!==t.cameraControlSettings&&(i.cameraControlSettings=P.merge(i.cameraControlSettings,t.cameraControlSettings)),i=P.merge(i,t),this.settings=i,this._initSceneSettings(),this.attachTo(i.element),this.animate(0)}return Object(r.a)(e,[{key:"setOnAnimateCallback",value:function(e){this.onAnimate=e}},{key:"onAnimate",set:function(e){if(!e)throw new Error("Invalid onRender callback");this._onAnimate=e}},{key:"onTileSelected",set:function(e){this._onTileSelected=e}},{key:"onLoaded",set:function(e){this._onLoaded=e}},{key:"selectedTile",get:function(){return this._selectedTile}},{key:"mouseCaster",set:function(e){this._mouseCaster=e}}]),Object(r.a)(e,[{key:"dispose",value:function(){window.removeEventListener("resize",this.onWindowResize,!1),this.controls.dispose(),this._mouseCaster.dispose(),window.cancelAnimationFrame(this._animationID),delete this.container,delete this.camera,delete this.controls,delete this._mouseCaster}},{key:"onWindowResize",value:function(){this.width=window.innerWidth,this.height=window.innerHeight,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}},{key:"attachTo",value:function(e){e.style.width=this.width+"px",e.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),e.appendChild(this.renderer.domElement)}},{key:"add",value:function(e){this.container.add(e)}},{key:"addBoard",value:function(e){this.board=e,this.container.add(e.group)}},{key:"remove",value:function(e){this.container.remove(e)}},{key:"animate",value:function(e){var t=(e-this._lastTimestamp)/1e3;this._lastTimestamp=e,this._mouseCaster&&this._mouseCaster.update(),this.controlled&&this.hotEdges&&this._panning&&this.panInDirection(this._panningLeft,this._panningRight,this._panningUp,this._panningDown),this._onAnimate(t),this.controls.update(),this.renderer.render(this.container,this.camera),this._animationID=requestAnimationFrame(this.animate.bind(this))}},{key:"focusOn",value:function(e){this.camera.lookAt(e.position)}},{key:"getViewCenter",value:function(){return this._mouseCaster.mouseToWorld({x:window.innerWidth/2,y:window.innerHeight/2},this.camera)}},{key:"getCameraFocusPosition",value:function(e){return this.getCameraFocusPositionWorld(e)}},{key:"getCameraFocusPositionWorld",value:function(e){var t=this.camera.position.clone().sub(this.getViewCenter());return e.add(t)}},{key:"updateSettings",value:function(e){this.w1=e.sceneMarginSize/window.innerWidth|this.settings.sceneMarginSize/window.innerWidth,this.h1=e.sceneMarginSize/window.innerHeight|this.settings.sceneMarginSize/window.innerHeight,this.w2=1-e.sceneMarginSize/window.innerWidth|1-this.settings.sceneMarginSize/window.innerWidth,this.h2=1-e.sceneMarginSize/window.innerHeight|this.settings.sceneMarginSize/window.innerHeight,this.updateControls(this.settings.cameraControlSettings)}},{key:"toggleControls",value:function(){this.controls.toggleControls()}},{key:"updateControls",value:function(e){this.controls.updateControls(e)}},{key:"toggleHorizontalRotation",value:function(e){this.toggleHorizontalRotation(e)}},{key:"initControls",value:function(e){this.controls=new G(this,e)}},{key:"panInDirection",value:function(e,t,i,n){this.controls.panInDirection(e,t,i,n)}},{key:"panCameraTo",value:function(e,t){this.controls.panCameraTo(e,t)}},{key:"_initSceneSettings",value:function(){if(this.renderer=new p.z({alpha:this.settings.alpha,antialias:this.settings.antialias}),this.renderer.setClearColor(this.settings.clearColor,1),this.renderer.sortObjects=this.settings.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.w1=this.settings.sceneMarginSize/window.innerWidth,this.h1=this.settings.sceneMarginSize/window.innerHeight,this.w2=1-this.settings.sceneMarginSize/window.innerWidth,this.h2=1-this.settings.sceneMarginSize/window.innerHeight,this.container=new p.r,this.container.fog=this.settings.fog,this.container.add(new p.a(14540253)),this.settings.lightPosition){var e=this.settings.lightPosition;this.settings.light.position.set(e.x,e.y,e.z).normalize(),this.settings.light.intensity=1.2}else this.settings.light.position.set(1,1,3).normalize(),this.settings.light.intensity=1.2;this.container.add(this.settings.light),this.camera=new p.n(50,this.width/this.height,1,5e3),this.settings.cameraPosition&&this.camera.position.copy(this.settings.cameraPosition),this.initControls(this.settings.cameraControlSettings),this.initMouseCaster(),window.addEventListener("resize",this.onWindowResize.bind(this),!1)}},{key:"initMouseCaster",value:function(){this._mouseCaster=new R(this.container,this.camera);var e=this;this._mouseCaster.signal.add((function(t,i){if(e.controlled){if(t===R.CLICK){e.controls.panCameraTo(i,2500);var n=e.board.grid.pixelToCell(e._mouseCaster.position),s=e.board.getTileAtCell(n);s&&s.toggle()}t===R.MOVE&&e.checkEdge(i),t===R.WHEEL&&e._mouseCaster.wheel}}),this)}},{key:"checkEdge",value:function(e){var t=new p.x(e.clientX,e.clientY),i=t.x/window.innerWidth,n=t.y/window.innerHeight;i>this.w2||i<this.w1||n>this.h2||n<this.h1?(this._panning=!0,i>this.w2&&(this._panningRight=!0),i<this.w1&&(this._panningLeft=!0),n>this.h2&&(this._panningDown=!0),n<this.h1&&(this._panningUp=!0)):(this._panning=!1,this._panningRight=!1,this._panningLeft=!1,this._panningDown=!1,this._panningUp=!1)}}]),e}(),q=function(){function e(t){Object(l.a)(this,e),this.mouse=t,this.onSelect=new U.Signal,this.onDeselect=new U.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)}return Object(r.a)(e,[{key:"select",value:function(e,t){e&&(t=t||!0,this.selected!==e&&this.clearSelection(t),e.selected?this.toggleSelection&&(t&&this.onDeselect.dispatch(e),e.deselect()):e.select(),this.selected=e,t&&this.onSelect.dispatch(e))}},{key:"clearSelection",value:function(e){e=e||!0,this.selected&&(e&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null}},{key:"onMouse",value:function(e,t){switch(e){case U.MouseCaster.DOWN:t||this.clearSelection();break;case U.MouseCaster.CLICK:this.select(t)}}}]),e}(),W=function(){function e(t,i){if(Object(l.a)(this,e),this.tiles=void 0,this.tileGroup=void 0,this.group=void 0,this.grid=void 0,this.overlay=void 0,this.finder=void 0,!t)throw new Error("You must pass in a grid system for the board to use.");this.tiles=[],this.tileGroup=null,this.group=new p.m,this.grid=null,this.overlay=null,this.finder=new U.AStarFinder(i),U.Loader.init(),this.setGrid(t)}return Object(r.a)(e,[{key:"dispose",value:function(){delete this.tiles,delete this.tileGroup,delete this.group,delete this.overlay,delete this.finder}}]),Object(r.a)(e,[{key:"setEntityOnTile",value:function(e,t){var i=this.grid.cellToPixel(t.cell);e.position.copy(i),e.position.y+=e.heightOffset||0,e.tile&&(e.tile.entity=null),e.tile=t,t.entity=e}},{key:"addTile",value:function(e){-1===this.tiles.indexOf(e)&&(this.tiles.push(e),this.snapTileToGrid(e),e.position.y=0,this.tileGroup.add(e.mesh),this.grid.add(e.cell),e.cell.tile=e)}},{key:"removeTile",value:function(e){if(e){var t=this.tiles.indexOf(e);this.grid.remove(e.cell),-1!==t&&this.tiles.splice(t,1),e.dispose()}}},{key:"removeAllTiles",value:function(){if(this.tileGroup)for(var e=this.tileGroup.children,t=0;t<e.length;t++)this.tileGroup.remove(e[t])}},{key:"getTileAtCell",value:function(e){var t=this.grid.cellToHash(e);return e.tile||("undefined"!==typeof this.grid.cells[t]?this.grid.cells[t].tile:null)}},{key:"snapToGrid",value:function(e){var t=this.grid.pixelToCell(e);e.copy(this.grid.cellToPixel(t))}},{key:"snapTileToGrid",value:function(e){if(e.cell)e.position.copy(this.grid.cellToPixel(e.cell));else{var t=this.grid.pixelToCell(e.position);e.position.copy(this.grid.cellToPixel(t))}return e}},{key:"getRandomTile",value:function(){var e=U.Tools.randomInt(0,this.tiles.length-1);return this.tiles[e]}},{key:"findPath",value:function(e,t,i){return this.finder.findPath(e.cell,t.cell,i,this.grid)}},{key:"setGrid",value:function(e){if(this.group.remove(this.tileGroup),this.grid&&e!==this.grid){this.removeAllTiles();var t=this;this.tiles.forEach((function(e){t.grid.remove(e.cell),e.dispose()})),this.grid.dispose()}this.grid=e,this.tiles=[],this.tileGroup=new p.m,this.group.add(this.tileGroup)}},{key:"generateOverlay",value:function(e){var t=new p.h({color:0,opacity:.9});this.overlay&&this.group.remove(this.overlay),this.overlay=new p.m,this.grid.generateOverlay(e,this.overlay,t),this.group.add(this.overlay)}},{key:"generateTilemap",value:function(e){this.reset();var t=this.grid.generateTilemap(e);this.tiles=t,this.tileGroup=new p.m;for(var i=0;i<t.length;i++)this.tileGroup.add(t[i].mesh);this.group.add(this.tileGroup)}},{key:"generateTerrain",value:function(){if(this.grid.type===U.HEX){var e,t,i,n=this.grid.size,s=0;for(e=-n;e<n+1;e++)for(t=-n;t<n+1;t++)if(i=-e-t,Math.abs(e)<=n&&Math.abs(t)<=n&&Math.abs(i)<=n){var o=e/this.grid._cellWidth-.5,a=i/this.grid._cellLength-.5,l=1*U.Tools.noise1(1*o,1*a)+.5*U.Tools.noise1(2*o,2*a)+.25*U.Tools.noise1(4*o,4*a)+.13*U.Tools.noise1(8*o,8*a)+.06*U.Tools.noise1(16*o,16*a)+.03*U.Tools.noise1(32*o,32*a);l/=1.97,l=Math.pow(l,5);var r=1*U.Tools.noise2(1*o,1*a)+.75*U.Tools.noise2(2*o,2*a)+.33*U.Tools.noise2(4*o,4*a)+.33*U.Tools.noise2(8*o,8*a)+.33*U.Tools.noise2(16*o,16*a)+.5*U.Tools.noise2(32*o,32*a);r/=3.24,this.tiles[s].setTerrain(l,r),s++}}}},{key:"reset",value:function(){this.removeAllTiles(),this.tileGroup&&this.group.remove(this.tileGroup)}}]),e}(),U={VERSION:"1.0.0",PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,SQRT3:Math.sqrt(3),Cell:g,Grid:function e(t){return Object(l.a)(this,e),void 0===t.type||t.type===U.HEX?new f(t):t.type===U.SQR?new _(t):void 0},HexGrid:f,SqrGrid:_,Tile:v,LinkedList:y,Signal:S,AStarFinder:j,PathUtil:k,Loader:M,MouseCaster:R,View:F,SelectionManager:q,Tools:P,Board:W,TILE:"tile",ENT:"entity",STR:"structure",HEX:"hex",SQR:"square",ABS:"abstract"},Y=function(e){function t(){var e,i;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(i=Object(h.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(s)))).params={cameraControl:{enableDamping:!0,controlled:!1,dampingFactor:.05,minDistance:250,maxDistance:400,zoomSpeed:3,autoRotate:!0,screenSpacePanning:!1,minPolarAngle:Math.PI/10,maxPolarAngle:Math.PI/4,minAzimuthAngle:0,maxAzimuthAngle:-Math.PI,horizontalRotation:!0}},i}return Object(u.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.params.cameraControl;this.scene=new U.View({element:document.getElementById("engine"),cameraPosition:{x:0,y:40,z:50},cameraControlSettings:{controlled:e.controlled,enableDamping:e.enableDamping,dampingFactor:e.dampingFactor,maxDistance:e.maxDistance,minDistance:e.minDistance,enableZoom:e.enableZoom,zoomSpeed:e.zoomSpeed,hotEdges:e.hotEdges,autoRotate:e.autoRotate,screenSpacePanning:e.screenSpacePanning,minPolarAngle:e.minPolarAngle,maxPolarAngle:e.maxPolarAngle,maxAzimuthAngle:e.maxAzimuthAngle,minAzimuthAngle:e.minAzimuthAngle,horizontalRotation:e.horizontalRotation}}),this.gridSpace=new U.Grid({cellSize:15,gridSize:100}),this.board=new U.Board(this.gridSpace),this.board.generateTilemap({tileScale:.965}),this.board.generateTerrain(),this.scene.addBoard(this.board),this.scene.focusOn(this.board.group)}},{key:"componentWillUnmount",value:function(){window.cancelAnimationFrame(this.animID),this.scene.dispose(),this.gridSpace.dispose(),this.board.dispose(),delete this.board,delete this.gridSpace,delete this.scene}},{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement("div",{id:"overlay"},s.a.createElement("h1",null,"Tiles.js"),s.a.createElement("hr",null),s.a.createElement("h3",null,"A 3D Tile Engine"),s.a.createElement(d.b,{to:"/sandbox",style:{backgroundColor:"rgb(147,217,69)",color:"black"}},"Sandbox"),s.a.createElement("br",null),s.a.createElement(d.b,{to:"/docs"},"Docs"),s.a.createElement("br",null),s.a.createElement("a",{href:"https://github.com/christophgomez/threejs-tilemap",target:"_blank",rel:"noopener noreferrer"},"Github")),s.a.createElement("div",{id:"engine"}))}}]),t}(s.a.Component),B=i(33),Z=i(35),X=(i(63),i(47)),V=function e(t,i){Object(l.a)(this,e),this.gui=new X.a({autoPlace:!1}),document.getElementById("gui").append(this.gui.domElement);var n=this.gui.addFolder("Camera");n.add(i.camera.position,"x").step(10).listen(),n.add(i.camera.position,"y").step(10).listen(),n.add(i.camera.position,"z").step(10).listen();var s=n.addFolder("Control");s.add(t,"controlled").name("Enabled").onChange((function(){i.toggleControls()})),s.add(t,"enableDamping").name("Damping").onChange((function(e){i.updateControls({enableDamping:e})})),s.add(t,"dampingFactor",0,1).step(.01).name("Damping Factor").onChange((function(e){i.updateControls({dampingFactor:e})})),s.add(t,"maxDistance",0,1e3).step(10).name("Max Zoom Out").onChange((function(e){i.updateControls({maxDistance:e})})),s.add(t,"minDistance",0,1e3).step(10).name("Max Zoom In").onChange((function(e){i.updateControls({minDistance:e})})),s.add(t,"zoomSpeed",0,20).step(1).name("Zoom Speed").onChange((function(e){i.updateControls({zoomSpeed:e})})),s.add(t,"hotEdges").name("Edge Scroll").onChange((function(e){i.updateControls({hotEdges:e})})),s.add(t,"autoRotate").name("Auto Rotate").onChange((function(e){i.updateControls({autoRotate:e}),t.horizontalRotation=!0===e})),s.add(t,"screenSpacePanning").name("Screen Space Panning").onChange((function(e){i.updateControls({screenSpacePanning:e})})),s.add(t,"minPolarAngle",0,180).step(1).name("Min Polar Angle").onChange((function(e){e=e*Math.PI/180,i.updateControls({minPolarAngle:e})})),s.add(t,"maxPolarAngle",0,180).step(1).name("Max Polar Angle").onChange((function(e){e=e*Math.PI/180,i.updateControls({minPolarAngle:e})})),s.add(t,"minAzimuthAngle",-180,180).step(1).name("Min Azimuth Angle").onChange((function(e){e=e*Math.PI/180,i.updateControls({minAzimuthAngle:e})})),s.add(t,"maxAzimuthAngle",-180,180).step(1).name("Max Azimuth Angle").onChange((function(e){e=e*Math.PI/180,i.updateControls({maxAzimuthAngle:e})})),s.add(t,"horizontalRotation").name("Hor. Rotation").onChange((function(e){i.toggleHorizontalRotation(e)})).listen();var o=this.gui.addFolder("World");o.addFolder("Grid/Board"),o.addFolder("Terrain"),n.open(),s.open()},K=function(e){function t(){var e,i;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(i=Object(h.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(s)))).params={cameraControl:{controlled:!0,enableDamping:!0,dampingFactor:.05,minDistance:250,maxDistance:400,zoomSpeed:3,hotEdges:!0,autoRotate:!1,screenSpacePanning:!1,minPolarAngle:Math.PI/10,maxPolarAngle:Math.PI/4,minAzimuthAngle:0,maxAzimuthAngle:-Math.PI,horizontalRotation:!1}},i.state={fullscreen:!1},i}return Object(u.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.params.cameraControl;this.scene=new U.View({element:document.querySelector(".App"),cameraPosition:{x:0,y:40,z:50},cameraControlSettings:{controlled:e.controlled,enableDamping:e.enableDamping,dampingFactor:e.dampingFactor,maxDistance:e.maxDistance,minDistance:e.minDistance,enableZoom:e.enableZoom,zoomSpeed:e.zoomSpeed,hotEdges:e.hotEdges,autoRotate:e.autoRotate,screenSpacePanning:e.screenSpacePanning,minPolarAngle:e.minPolarAngle,maxPolarAngle:e.maxPolarAngle,maxAzimuthAngle:e.maxAzimuthAngle,minAzimuthAngle:e.minAzimuthAngle,horizontalRotation:e.horizontalRotation}}),this.gridSpace=new U.Grid({cellSize:20,gridSize:80}),this.board=new U.Board(this.gridSpace),this.board.generateTilemap({tileScale:.965}),this.board.generateTerrain(),this.scene.addBoard(this.board),this.scene.focusOn(this.board.group),this.gui=new V(e,this.scene)}},{key:"componentWillUnmount",value:function(){window.cancelAnimationFrame(this.animID),this.scene.dispose(),this.gridSpace.dispose(),this.board.dispose(),delete this.board,delete this.gridSpace,delete this.scene}},{key:"toggleFullscreen",value:function(){var e=this,t=document.querySelector(".App");document.fullscreenElement?document.exitFullscreen().then((function(){e.setState({fullscreen:!1})})):t.requestFullscreen().then((function(){e.setState({fullscreen:!0})})).catch((function(e){alert("Error attempting to enable full-screen mode: ".concat(e.message," (").concat(e.name,")"))}))}},{key:"render",value:function(){var e,t=this;return e=document.fullscreenElement?s.a.createElement(B.a,{icon:Z.a,size:"4x"}):s.a.createElement(B.a,{icon:Z.b,size:"4x"}),s.a.createElement("div",{className:"App"},s.a.createElement("div",{id:"gui"}),s.a.createElement("button",{className:"fullScreenToggle",onClick:function(){return t.toggleFullscreen()}},e))}}]),t}(s.a.Component),J=i(48),Q=i.n(J),$=i(49),ee=i.n($),te=function(e){function t(){var e,i;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(i=Object(h.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(s)))).state={docu:"Documentation"},i}return Object(u.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch(ee.a).then((function(e){return e.text()})).then((function(t){e.setState({docu:t})})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){return s.a.createElement("div",{className:"docs"},s.a.createElement(Q.a,{source:this.state.docu}))}}]),t}(s.a.Component),ie=function(e){function t(){return Object(l.a)(this,t),Object(h.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return s.a.createElement(d.a,{basename:"/"},s.a.createElement(m.a,{path:"/",exact:!0,component:Y}),s.a.createElement(m.a,{path:"/sandbox",component:K}),s.a.createElement(m.a,{path:"/docs",component:te}))}}]),t}(s.a.Component);a.a.render(s.a.createElement(ie,null),document.getElementById("root"))},49:function(e,t,i){e.exports=i.p+"static/media/docs.6819c3d3.md"},50:function(e,t,i){e.exports=i(143)},55:function(e,t,i){},56:function(e,t,i){},63:function(e,t,i){}},[[50,1,2]]]);
//# sourceMappingURL=main.f4317d3e.chunk.js.map