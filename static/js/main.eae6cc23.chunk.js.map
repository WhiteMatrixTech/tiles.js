{"version":3,"sources":["lib/grids/Cell.ts","lib/grids/Tile.ts","lib/grids/HexGrid.ts","lib/grids/SqrGrid.ts","lib/lib/LinkedList.js","lib/lib/Signal.js","lib/pathing/PathUtil.js","lib/utils/Tools.js","lib/pathing/AStarFinder.ts","lib/utils/Loader.js","lib/utils/MouseCaster.ts","lib/lib/OrbitControls.js","lib/utils/Animation.ts","lib/map/Controller.ts","lib/utils/AnimationManager.ts","lib/map/View.ts","lib/utils/SelectionManager.js","lib/map/Map.ts","lib/Engine.ts","lib/grids/Grid.ts","Components/Splash.jsx","Components/dat.js","Components/Sandbox.jsx","Components/Docs/Docs.jsx","App.js","index.js","Components/Docs/markdown/toc.md","Components/Docs/markdown/intro.md","Components/Docs/markdown/grid.md","Components/Docs/markdown/cell.md","Components/Docs/markdown/tile.md","Components/Docs/markdown/map.md","Components/Docs/markdown/view.md","Components/Docs/markdown/controller.md","Components/Docs/markdown/animation.md","Components/Docs/markdown/animationmanager.md","Components/Docs/markdown/finder.md","Components/Docs/markdown/mousecaster.md","Components/Docs/markdown/interfaces.md"],"names":["Cell","q","r","s","h","tile","userData","walkable","_calcCost","_priority","_visited","_parent","uniqueID","this","Engine","LinkedList","generateID","cell","Tile","config","geometry","material","mesh","selected","highlight","entity","position","rotation","objectType","_emissive","settings","Tools","merge","Error","dispose","MeshPhongMaterial","color","randomizeRGB","TILE","Mesh","structure","x","DEG_TO_RAD","scale","set","emissive","getHex","setHex","deselect","select","parent","remove","e","m","elevation","moisture","terrain","HexGrid","gridShape","gridSize","cellSize","cells","numCells","autogenerated","extrudeSettings","cellShape","cellGeo","cellShapeGeo","_cellWidth","_cellLength","_hashDelimeter","_directions","_diagonals","_list","_vec3","_cel","_geoCache","_matCache","i","HEX","verts","push","_createVertex","Shape","moveTo","y","lineTo","autoClose","BufferGeometry","vertices","verticesNeedUpdate","ShapeGeometry","SQRT3","Vector3","generateGrid","z","pos","TWO_THIRDS","_cubeRound","cellToHash","diagonal","filter","n","l","length","copy","add","c","randomInt","cellA","cellB","d","Math","max","abs","resetPath","cb","height","geo","amount","ExtrudeGeometry","nx","ny","noise1","pow","noise2","setTerrain","t","tiles","tileScale","bevelEnabled","bevelSegments","steps","bevelSize","bevelThickness","generateTile","cellToPixel","RCT","rOffset","size","overlayObj","overlayMat","createPointsGeometry","line","Line","url","scope","self","getJSON","callback","json","fromJSON","call","cache","Object","keys","k","angle","TAU","cos","sin","rx","round","ry","rz","xDiff","yDiff","zDiff","SqrGrid","_fullCellSize","SQR","half","ceil","undefined","Node","obj","next","prev","free","first","last","objToNodeMap","Date","now","floor","random","sortArray","node","err","console","error","newObj","addNode","showDebug","dump","getNode","b","a","oldCNext","moveUp","compare","clear","sort","list","msg","log","toString","slice","SignalBinding","signal","listener","isOnce","listenerContext","priority","_listener","context","paramsArr","handlerReturn","params","active","concat","apply","detach","isBound","Signal","_bindings","_prevParams","fnName","replace","binding","prevIndex","_indexOfListener","_addBinding","memorize","execute","splice","cur","validateListener","_registerListener","_destroy","_shouldPropagate","bindings","Array","prototype","arguments","removeAll","getNumListeners","path","reverse","nodeA","nodeB","pathA","backtrace","pathB","dx","dy","sum","sqrt","x0","y0","x1","y1","sx","sy","e2","coord0","coord1","interpolated","interpolatedLen","j","expanded","len","interpolate","grid","ex","ey","newPath","lastValidCoord","coord","testCoord","blocked","isWalkableAt","lx","ly","ldx","ldy","sq","compressed","px","py","rng1","PM_PRNG","create","rng2","gen1","SimplexNoise","nextDouble","bind","gen2","clamp","val","min","sign","noise2D","normalize","v","getShortRotation","PI","isPlainObject","nodeType","window","constructor","hasOwnProperty","target","src","array","isArray","dst","forEach","indexOf","key","nwf","system","Performance","elapsedTime","performance","empty","lastChild","removeChild","radixSort","arr","idxBegin","idxEnd","bit","idx","idxOnes","mask","tmp","base","range","rgb","split","rgb_","parseInt","substring","xhr","XMLHttpRequest","uri","onreadystatechange","status","warn","statusText","JSON","parse","responseText","open","setRequestHeader","send","AStarFinder","finderConfig","allowDiagonal","heuristicFilter","startNode","endNode","heuristic","current","costSoFar","neighbors","clearPath","shift","PathUtil","getNeighbors","distance","Loader","manager","imageLoader","crossOrigin","init","THREE","loadTexture","mapping","onLoad","onError","texture","load","image","needsUpdate","evt","sourceFile","MouseCaster","group","camera","element","down","rightDown","pickedObject","selectedObject","allHits","ctrl","wheel","screenPosition","_camera","_raycaster","_preventDefault","document","addEventListener","_onDocumentMouseMove","_onDocumentMouseDown","_onDocumentMouseUp","_onMouseWheel","touches","changedTouches","ctx","removeEventListener","hit","intersects","rayCast","object","dispatch","point","event","preventDefault","shiftKey","ctrlKey","which","clientX","innerWidth","clientY","innerHeight","stopPropagation","delta","wheelDelta","detail","setFromCamera","intersectObject","OVER","OUT","DOWN","UP","CLICK","WHEEL","MOVE","OrbitControls","domElement","view","enabled","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","LEFT","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","ONE","TOUCH","DOLLY_PAN","TWO","target0","clone","position0","zoom0","zoom","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","saveState","reset","updateProjectionMatrix","dispatchEvent","changeEvent","update","state","STATE","NONE","setZoom","bool","onMouseWheel","offset","quat","Quaternion","setFromUnitVectors","up","quatInverse","inverse","lastPosition","lastQuaternion","sub","applyQuaternion","setFromVector3","rotateLeft","sphericalDelta","makeSafe","radius","addScaledVector","panOffset","setFromSpherical","lookAt","multiplyScalar","zoomChanged","distanceToSquared","EPS","dot","quaternion","onContextMenu","onMouseDown","onTouchStart","onTouchEnd","onTouchMove","onMouseMove","onMouseUp","onKeyDown","rotateUp","type","startEvent","endEvent","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","panLeft","objectMatrix","setFromMatrixColumn","panUp","crossVectors","dollyIn","dollyScale","isPerspectiveCamera","isOrthographicCamera","dollyOut","handleMouseDownRotate","handleMouseDownPan","handleTouchStartRotate","pageX","pageY","handleTouchStartPan","handleTouchStartDolly","handleTouchMoveRotate","subVectors","body","clientHeight","handleTouchMovePan","pan","handleTouchMoveDolly","focus","button","metaKey","_mouseCaster","animationManager","animations","cancelAnimation","handleMouseDownDolly","handleMouseMoveRotate","handleMouseMoveDolly","map","pixelToCell","getTileAtCell","handleMouseMovePan","deltaY","handleMouseWheel","keyCode","handleKeyDown","handleTouchStartDollyPan","DOLLY_ROTATE","handleTouchStartDollyRotate","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","deltaX","targetDistance","tan","fov","matrix","right","left","clientWidth","top","bottom","EventDispatcher","MapControls","Animation","durationMs","easingFunction","easeInOutQuad","progress","complete","dtS","easeLinear","Controller","_view","controls","panning","_panDirection","_initControls","controlled","renderer","hotEdges","horizontalRotation","direction","from","to","addAnimation","focusOn","lerp","cameraControlSettings","toggleHorizontalRotation","AnimationManager","container","onAnimate","_lastTimestamp","_animationID","_onAnimate","_paused","genID","animation","animate","id","cancelAnimationFrame","timestamp","render","requestAnimationFrame","substr","paused","View","viewConfig","width","_selectedTile","_onTileSelected","_onLoaded","_hoverTile","sceneSettings","alpha","antialias","clearColor","sortObjects","fog","light","DirectionalLight","lightPosition","cameraPosition","sceneMarginSize","_initSceneSettings","attachTo","addMap","style","setPixelRatio","devicePixelRatio","setSize","appendChild","onWindowResize","panCameraTo","panInDirection","toggleAnimationLoop","toggleControls","updateControlSettings","WebGLRenderer","setClearColor","createElement","cssText","panDirection","topLeft","topRight","bottomLeft","bottomRight","Scene","AmbientLight","p","intensity","PerspectiveCamera","_initMouseCaster","_initAnimationManager","toggle","aspect","mouse","SelectionManager","onSelect","onDeselect","toggleSelection","onMouse","fireSignal","clearSelection","Map","mapConfig","pathFinder","tileGroup","tileOverlay","Object3D","setGrid","generateTiles","heightOffset","snapTileToGrid","children","startTile","endTile","findPath","newGrid","removeAllTiles","mat","LineBasicMaterial","opacity","generateOverlay","VERSION","RAD_TO_DEG","Grid","ENT","STR","ABS","Splash","cameraControl","cc","gridSpace","scene","getElementById","getRandomTile","animID","className","backgroundColor","href","rel","React","Component","GUI","options","gui","dat","autoPlace","append","camGUI","addFolder","step","listen","orbitControls","name","onChange","worldGUI","Sandbox","fullscreen","querySelector","el","animationID","addOnAnimate","fps","innerHTML","toFixed","elem","fullscreenElement","exitFullscreen","then","setState","requestFullscreen","catch","alert","message","icon","faCompress","faExpand","onClick","toggleFullscreen","hljs","registerLanguage","javascript","typescript","bash","Docs","toc","combinedData","currSlide","currKey","updateCodeSyntaxHighlighting","querySelectorAll","block","highlightBlock","fetch","TOC","response","text","fetchedDocData","docFiles","index","Promise","all","values","startsWith","slide","props","value","borderBottom","setCurrSlide","language","code","renderers","link","markdownLinkRenderer","markdownCodeRenderer","plugins","HTMLParser","source","App","basename","exact","component","ReactDOM","module","exports"],"mappings":"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","file":"static/js/main.eae6cc23.chunk.js","sourcesContent":["import Engine from '../Engine';\nimport Tile from './Tile';\n\n// Coordinate data for a cell\nexport default class Cell {\n\n  public q: number;\n  public r: number;\n  public s: number;\n  public h: number;\n  public tile: Tile;\n  public userData: {};\n  public walkable: boolean;\n\n  public _calcCost: number;\n  public _priority: number;\n  public _visited: boolean;\n  public _parent: Cell;\n  public uniqueID: string;\n  \n  constructor(q?: number, r?: number, s?: number, h?: number) {\n    this.q = q || 0; // x grid coordinate (using different letters so that it won't be confused with pixel/world coordinates)\n    this.r = r || 0; // y grid coordinate\n    this.s = s || 0; // z grid coordinate\n    this.h = h || 1; // 3D height of the cell, used by visual representation and pathfinder, cannot be less than 1\n    this.tile = null; // optional link to the visual representation's class instance\n    this.userData = {}; // populate with any extra data needed in your game\n    this.walkable = true; // if true, pathfinder will use as a through node\n\n    // rest of these are used by the pathfinder and overwritten at runtime, so don't touch\n    this._calcCost = 0;\n    this._priority = 0;\n    this._visited = false;\n    this._parent = null;\n    this.uniqueID = Engine.LinkedList.generateID();\n  }\n  \n  set(q: number, r: number, s: number): Cell {\n    this.q = q;\n    this.r = r;\n    this.s = s;\n    return this;\n  }\n\n  copy(cell: Cell): Cell {\n    this.q = cell.q;\n    this.r = cell.r;\n    this.s = cell.s;\n    this.h = cell.h;\n    this.tile = cell.tile || null;\n    this.userData = cell.userData || {};\n    this.walkable = cell.walkable;\n    return this;\n  }\n\n  add(cell: Cell): Cell {\n    this.q += cell.q;\n    this.r += cell.r;\n    this.s += cell.s;\n    return this;\n  }\n\n  equals(cell: Cell): boolean {\n    return this.q === cell.q && this.r === cell.r && this.s === cell.s;\n  }\n\n  resetPath(): void {\n    this._calcCost = 0;\n    this._priority = 0;\n    this._parent = null;\n    this._visited = false;\n  }\n}","import Engine from '../Engine';\nimport { Geometry, MeshPhongMaterial, Mesh, Vector3, Euler, Material } from 'three';\nimport Cell from './Cell';\nimport { TileSettings } from '../utils/Interfaces';\n\n// Visual representation of a cell\nexport default class Tile {\n\n  public cell: Cell;\n  \n  public geometry: Geometry;\n  public material: Material;\n  public mesh: Mesh;\n\n  public selected: boolean;\n  public highlight: number;\n  \n  public userData: {\n    terrain?: string;\n    elevation?: number;\n    moisture?: number;\n  };\n\n  public entity: any;\n  \n  public position: Vector3;\n  public rotation: Euler;\n\n  public uniqueID: string;\n  public objectType: string;\n\n  private _emissive: number;\n\n  \n  constructor(config?: TileSettings) {\n    let settings: TileSettings = {\n      cell: null,\n      geometry: null,\n      material: null,\n    };\n    if(config)\n      settings = Engine.Tools.merge(settings, config) as TileSettings;\n\n    if (!settings.cell || !settings.geometry) {\n      throw new Error('Missing Engine.Tile configuration');\n    }\n\n    this.cell = settings.cell;\n    if (this.cell.tile && this.cell.tile !== this) this.cell.tile.dispose(); // remove whatever was there\n    this.cell.tile = this;\n\n    this.uniqueID = Engine.Tools.generateID();\n\n    this.geometry = settings.geometry;\n    this.material = settings.material;\n    if (!this.material) {\n      this.material = new MeshPhongMaterial({\n        color: Engine.Tools.randomizeRGB('0, 105, 148', 13)\n      });\n    }\n\n    this.objectType = Engine.TILE;\n    this.entity = null;\n    this.userData = {};\n\n    this.selected = false;\n    this.highlight = 0x0084cc;\n\n    this.mesh = new Mesh(this.geometry, this.material);\n    this.mesh.userData.structure = this;\n\n    // create references so we can control orientation through this (Tile), instead of drilling down\n    this.position = this.mesh.position;\n    this.rotation = this.mesh.rotation;\n\n    // rotate it to face \"up\" (the threejs coordinate space is Y+)\n    this.rotation.x = -90 * Engine.DEG_TO_RAD;\n    this.mesh.scale.set(settings.scale, settings.scale, 1);\n\n    if ((this.material as MeshPhongMaterial).emissive) {\n      this._emissive = (this.material as MeshPhongMaterial).emissive.getHex();\n    }\n    else {\n      this._emissive = null;\n    }\n  }\n  select(): Tile {\n    if ((this.material as MeshPhongMaterial).emissive) {\n      (this.material as MeshPhongMaterial).emissive.setHex(this.highlight);\n    }\n    this.selected = true;\n    return this;\n  }\n\n  deselect(): Tile {\n    if (this._emissive !== null && (this.material as MeshPhongMaterial).emissive) {\n      (this.material as MeshPhongMaterial).emissive.setHex(this._emissive);\n    }\n    this.selected = false;\n    return this;\n  }\n\n  toggle(): Tile {\n    if (this.selected) {\n      this.deselect();\n    }\n    else {\n      this.select();\n    }\n    return this;\n  }\n\n  dispose(): void {\n    if (this.cell && this.cell.tile) this.cell.tile = null;\n    this.cell = null;\n    this.position = null;\n    this.rotation = null;\n    if (this.mesh.parent) this.mesh.parent.remove(this.mesh);\n    this.mesh.userData.structure = null;\n    this.mesh = null;\n    this.material = null;\n    this.userData = null;\n    this.entity = null;\n    this.geometry = null;\n    this._emissive = null;\n  }\n  \n  setTerrain(e: number, m: number): void {\n    \n    this.userData.elevation = e;\n    this.userData.moisture = m;\n\n    if (e < 0.02) {\n      this.userData.terrain = 'OCEAN';\n      return;\n    }\n    if (e < 0.06) {\n      this.userData.terrain = 'BEACH';\n      (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('194,178,128', 13));\n      return;\n    }\n    if (e < .3) {\n      this.userData.terrain = 'PLAIN';\n      (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('70,118,58', 13));\n      return;\n    }\n    if (e < 1) {\n      this.userData.terrain = 'MOUNTAIN';\n      \n      (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('107,110,112', 13));\n      return;\n    };\n\n    /*if (e > 0.6) {\n      if (m < 0.1) {\n        this.userData.terrain = 'SCORCHED';\n        (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('171,95,58', 13));\n        return;\n      }\n      if (m < 0.2) {\n        this.userData.terrain = 'BARE';\n        (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('215,171,114', 13));\n        return;\n      }\n      if (m < 0.5) {\n        this.userData.terrain = 'TUNDRA';\n        (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('152,171,180', 13));\n        return;\n      }\n      this.userData.terrain = 'SNOW';\n      (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('223,217,221', 13));\n      return;\n    }\n\n    /*if (e > 0.45) {\n      if (m < 0.33) {\n        this.userData.terrain = 'TEMPERATE_DESERT';\n        (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('200,184,158', 13));\n        return;\n      }\n      if (m < 0.66) {\n        this.userData.terrain = 'SHRUBLAND';\n        (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('125,124,62', 13));\n        return;\n      };\n      this.userData.terrain = 'TAIGA';\n      (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('16,86,76', 13));\n      return;\n    }\n\n    if (e > 0.35) {\n      if (m < 0.16) {\n        this.userData.terrain = 'TEMPERATE_DESERT';\n        (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('200,184,158', 13));\n        return;\n      }\n      if (m < 0.25) {\n        this.userData.terrain = 'GRASSLAND';\n        (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('147,217,69', 13));\n        return;\n      }\n      //if (m < 0.83) return 'TEMPERATE_DECIDUOUS_FOREST';\n      this.userData.terrain = 'FOREST';\n      (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('16,59,35', 13));\n      return;\n    }\n\n    if (m < 0.16) {\n      this.userData.terrain = 'SUBTROPICAL_DESERT';\n      (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('152,79,15', 13));\n      return;\n    }\n    if (m < 0.33) {\n      this.userData.terrain = 'GRASSLAND';\n      (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('147,217,69', 13));\n      return;\n    }\n    this.userData.terrain = 'TROPICAL_RAIN_FOREST';\n    (this.material as MeshPhongMaterial).color.set(Engine.Tools.randomizeRGB('79,159,27', 13));\n    return;*/\n  }\n}","import Engine from '../Engine';\nimport {\n  Shape,\n  BufferGeometry,\n  ShapeGeometry,\n  Vector3,\n  Geometry,\n  ExtrudeGeometry,\n  Object3D,\n  Material,\n  Line,\n} from 'three';\nimport { GridInterface } from './Grid';\nimport { GridSettings, ExtrudeSettings, MapSettings, GridJSONData, TileSettings, heuristic } from '../utils/Interfaces';\nimport Cell from './Cell';\nimport Tile from './Tile';\n\n/*\n\tGraph of hexagons. Handles grid cell management (placement math for eg pathfinding, range, etc) and grid conversion math.\n\t[Cube/axial coordinate system](http://www.redblobgames.com/grids/hexagons/), \"flat top\" version only. Since this is 3D, just rotate your camera for pointy top maps.\n */\n// 'utils/Loader', 'graphs/Hex', 'utils/Tools'\nexport default class HexGrid implements GridInterface {\n\n  // Interface\n  public gridShape: string;\n  public gridSize: number;\n  public cellSize: number;\n\n  \n  public cells: { [key: string]: Cell };\n  public numCells: number;\n  public autogenerated: boolean;\n\n  public extrudeSettings: ExtrudeSettings;\n  // Hex Specific\n  public cellShape: Shape;\n  public cellGeo: BufferGeometry;\n  public cellShapeGeo: ShapeGeometry;\n  public _cellWidth: number;\n  public _cellLength: number;\n  \n  // Internals\n  private _hashDelimeter: string;\n  private _directions: Cell[];\n  private _diagonals: Cell[];\n  private _list: Cell[];\n  private  _vec3: Vector3;\n  private _cel: Cell;\n  private _geoCache: Geometry[];\n  private _matCache: Material[];\n\n  public static get TWO_THIRDS(): number { return 2 / 3};\n\n  constructor(config?: GridSettings) {\n    let settings = {\n      gridShape: Engine.HEX,\n      gridSize: 10,\n      cellSize: 10,\n      cellShape: Engine.HEX,\n    } as GridSettings;\n    if (config)\n      settings = Engine.Tools.merge(settings, config) as GridSettings\n\n    this.gridShape = settings.gridShape;\n    this.gridSize = settings.gridSize;\n    this.cellSize = settings.cellSize;\n\n    // Generate cells\n    this.cells = {};\n    this.numCells = 0;\n\n    this.extrudeSettings = null;\n    this.autogenerated = false;\n\n    // create base shape used for building geometry\n    let i;\n    const verts = [];\n    // create the skeleton of the hex\n    for (i = 0; i < 6; i++) {\n      verts.push(this._createVertex(i));\n    }\n    // copy the verts into a shape for the geometry to use\n    this.cellShape = new Shape();\n    this.cellShape.moveTo(verts[0].x, verts[0].y);\n    for (i = 1; i < 6; i++) {\n      this.cellShape.lineTo(verts[i].x, verts[i].y);\n    }\n    this.cellShape.lineTo(verts[0].x, verts[0].y);\n    this.cellShape.autoClose = true;\n\n    this.cellGeo = new BufferGeometry();\n    (this.cellGeo as any).vertices = verts;\n    (this.cellGeo as any).verticesNeedUpdate = true;\n\n    this.cellShapeGeo = new ShapeGeometry(this.cellShape);\n\n    /*  ______________________________________________\n      PRIVATE\n    */\n\n    this._cellWidth = this.cellSize * 2;\n    this._cellLength = (Engine.SQRT3 * 0.5) * this._cellWidth;\n    this._hashDelimeter = '.';\n    // pre-computed permutations\n    this._directions = [new Cell(+1, -1, 0), new Cell(+1, 0, -1), new Cell(0, +1, -1),\n    new Cell(-1, +1, 0), new Cell(-1, 0, +1), new Cell(0, -1, +1)];\n    this._diagonals = [new Cell(+2, -1, -1), new Cell(+1, +1, -2), new Cell(-1, +2, -1),\n    new Cell(-2, +1, +1), new Cell(-1, -1, +2), new Cell(+1, -2, +1)];\n    // cached objects\n    this._list = [];\n    this._vec3 = new Vector3();\n    this._cel = new Cell();\n    this._geoCache = [];\n    this._matCache = [];\n\n    this.generateGrid(settings);\n  }\n  /*  ________________________________________________________________________\n\t\tHigh-level functions that the map interfaces with (all grids implement)\n\t */\n\n  // grid cell (Hex in cube coordinate space) to position in pixels/world\n  cellToPixel(cell: Cell): Vector3 {\n    this._vec3.x = cell.q * this._cellWidth * 0.75;\n    this._vec3.y = cell.h;\n    this._vec3.z = -((cell.s - cell.r) * this._cellLength * 0.5);\n    return this._vec3;\n  }\n\n  pixelToCell(pos: Vector3): Cell {\n    // convert a position in world space (\"pixels\") to cell coordinates\n    const q = pos.x * (HexGrid.TWO_THIRDS / this.cellSize);\n    const r = ((-pos.x / 3) + (Engine.SQRT3 / 3) * pos.z) / this.cellSize;\n    this._cel.set(q, r, -q - r);\n    return this._cubeRound(this._cel);\n  }\n\n  getCellAt(pos: Vector3): Cell {\n    // get the Cell (if any) at the passed world position\n    const q = pos.x * (HexGrid.TWO_THIRDS / this.cellSize);\n    const r = ((-pos.x / 3) + (Engine.SQRT3 / 3) * pos.z) / this.cellSize;\n    this._cel.set(q, r, -q - r);\n    this._cubeRound(this._cel);\n    return this.cells[this.cellToHash(this._cel)];\n  }\n\n  getNeighbors(cell: Cell, diagonal?: boolean, filter?: heuristic): Cell[] {\n    // always returns an array\n    let i, n;\n    const l = this._directions.length;\n    this._list.length = 0;\n    for (i = 0; i < l; i++) {\n      this._cel.copy(cell);\n      this._cel.add(this._directions[i]);\n      n = this.cells[this.cellToHash(this._cel)];\n      if (!n || (filter && !filter(cell, n))) {\n        continue;\n      }\n      this._list.push(n);\n    }\n    if (diagonal == null || diagonal === true) {\n      for (i = 0; i < l; i++) {\n        this._cel.copy(cell);\n        this._cel.add(this._diagonals[i]);\n        n = this.cells[this.cellToHash(this._cel)];\n        if (!n || (filter && !filter(cell, n))) {\n          continue;\n        }\n        this._list.push(n);\n      }\n    }\n    return this._list;\n  }\n\n  getRandomCell(): Cell {\n    let c;\n    let i = 0;\n    const x = Engine.Tools.randomInt(0, this.numCells);\n    for (c in this.cells) {\n      if (i === x) {\n        return this.cells[c];\n      }\n      i++;\n    }\n    return this.cells[c];\n  }\n\n  cellToHash(cell: Cell): string {\n    return cell.q + this._hashDelimeter + cell.r + this._hashDelimeter + cell.s;\n  }\n\n  distance(cellA: Cell, cellB: Cell): number {\n    let d = Math.max(Math.abs(cellA.q - cellB.q), Math.abs(cellA.r - cellB.r), Math.abs(cellA.s - cellB.s));\n    d += cellB.h - cellA.h; // include vertical height\n    return d;\n  }\n\n  clearPath(): void {\n    let i, c;\n    for (i in this.cells) {\n      c = this.cells[i];\n      c.resetPath();\n    }\n  }\n\n  traverse(cb: (cell: Cell) => void): void {\n    let i;\n    for (i in this.cells) {\n      cb(this.cells[i]);\n    }\n  }\n\n  generateTile(cell: Cell, scale: number, material: Material): Tile {\n    let height = Math.abs(cell.h);\n    if (height < 1) height = 1;\n\n    let geo = this._geoCache[height];\n    if (!geo) {\n      this.extrudeSettings.amount = height;\n      geo = new ExtrudeGeometry(this.cellShape, this.extrudeSettings);\n      this._geoCache[height] = geo;\n    }\n\n\t\t/*mat = this._matCache[c.matConfig.mat_cache_id];\n\t\tif (!mat) { // MaterialLoader? we currently only support basic stuff though. maybe later\n\t\t\tmat.map = Loader.loadTexture(c.matConfig.imgURL);\n\t\t\tdelete c.matConfig.imgURL;\n\t\t\tmat = new THREE[c.matConfig.type](c.matConfig);\n\t\t\tthis._matCache[c.matConfig.mat_cache_id] = mat;\n\t\t}*/\n\n    const tile = new Tile({\n      //size: this.cellSize,\n      scale: scale,\n      cell: cell,\n      geometry: geo,\n      material: material\n    } as TileSettings);\n\n    const nx = cell.q / this._cellWidth - 0.5, ny = cell.s / (this as HexGrid)._cellLength - 0.5;\n    let e = (1.00 * Engine.Tools.noise1(1 * nx, 1 * ny)\n      + 0.50 * Engine.Tools.noise1(2 * nx, 2 * ny)\n      + 0.25 * Engine.Tools.noise1(4 * nx, 4 * ny)\n      + 0.13 * Engine.Tools.noise1(8 * nx, 8 * ny)\n      + 0.06 * Engine.Tools.noise1(16 * nx, 16 * ny)\n      + 0.03 * Engine.Tools.noise1(32 * nx, 32 * ny));\n    e /= (1.00 + 0.50 + 0.25 + 0.13 + 0.06 + 0.03);\n    e = Math.pow(e, 5.00);\n    let m = (1.00 * Engine.Tools.noise2(1 * nx, 1 * ny)\n      + 0.75 * Engine.Tools.noise2(2 * nx, 2 * ny)\n      + 0.33 * Engine.Tools.noise2(4 * nx, 4 * ny)\n      + 0.33 * Engine.Tools.noise2(8 * nx, 8 * ny)\n      + 0.33 * Engine.Tools.noise2(16 * nx, 16 * ny)\n      + 0.50 * Engine.Tools.noise2(32 * nx, 32 * ny));\n    m /= (1.00 + 0.75 + 0.33 + 0.33 + 0.33 + 0.50);\n    tile.setTerrain(e, m);\n\n    cell.tile = tile;\n\n    return tile;\n  }\n\n  generateTiles(config?: MapSettings): Tile[] {\n    config = config || {} as MapSettings;\n    const tiles = [];\n    let settings = {\n      tileScale: 0.95,\n      extrudeSettings: {\n        amount: 10,\n        bevelEnabled: true,\n        bevelSegments: 1,\n        steps: 1,\n        bevelSize: 0.5,\n        bevelThickness: 0.5\n      } as ExtrudeSettings\n    } as MapSettings;\n    if(config)\n      settings = Engine.Tools.merge(settings, config) as MapSettings;\n\n    this.autogenerated = true;\n    this.extrudeSettings = settings.extrudeSettings;\n\n    let i, t, c;\n    for (i in this.cells) {\n      c = this.cells[i];\n      t = this.generateTile(c, settings.tileScale, settings.material);\n      t.position.copy(this.cellToPixel(c));\n      t.position.y = 0;\n      tiles.push(t);\n    }\n    return tiles;\n  }\n\n  // create a flat grid IN VIRTUAL SPACE (NO TILES JUST COORDINATES)\n  generateGrid(config?: GridSettings): void {\n    this.gridSize = typeof config.gridSize === 'undefined' ? this.gridSize : config.gridSize;\n    this.gridShape = typeof config.gridShape === 'undefined' ? this.gridShape : config.gridShape;\n    let c;\n    if (this.gridShape === Engine.RCT) {\n      for (let q = -this.gridSize; q < this.gridSize; q++) {\n        const rOffset = q >> 1; // or r>>1\n        for (let r = -rOffset; r < this.gridSize - rOffset; r++) {\n          c = new Cell(q, r, -q - r);\n          this.add(c);\n        }\n      }\n    } else if (this.gridShape === Engine.HEX) {\n      /* HEX SHAPED GRID */\n      let x, y, z;\n      for (x = -this.gridSize; x < this.gridSize + 1; x++) {\n        for (y = -this.gridSize; y < this.gridSize + 1; y++) {\n          z = -x - y;\n          if (Math.abs(x) <= this.gridSize && Math.abs(y) <= this.gridSize && Math.abs(z) <= this.gridSize) {\n            c = new Cell(x, y, z);\n            this.add(c);\n          }\n        }\n      }\n    }\n  }\n\n  generateOverlay(size: number, overlayObj: Object3D, overlayMat: Material): void {\n    let x, y, z;\n    const geo = this.cellShape.createPointsGeometry(6);\n    for (x = -size; x < size + 1; x++) {\n      for (y = -size; y < size + 1; y++) {\n        z = -x - y;\n        if (Math.abs(x) <= size && Math.abs(y) <= size && Math.abs(z) <= size) {\n          this._cel.set(x, y, z); // define the cell\n          const line = new Line(geo, overlayMat);\n          line.position.copy(this.cellToPixel(this._cel));\n          line.rotation.x = 90 * Engine.DEG_TO_RAD;\n          overlayObj.add(line);\n        }\n      }\n    }\n    overlayObj.position.y = .5;\n  }\n\n  add(cell: Cell): Cell {\n    const h = this.cellToHash(cell);\n    if (this.cells[h]) {\n      // console.warn('A cell already exists there');\n      return;\n    }\n    this.cells[h] = cell;\n    this.numCells++;\n\n    return cell;\n  }\n\n  remove(cell: Cell): Cell {\n    const h = this.cellToHash(cell);\n    if (this.cells[h]) {\n      delete this.cells[h];\n      this.numCells--;\n    }\n    return cell;\n  }\n\n  dispose(): void {\n    this.cells = null;\n    this.numCells = 0;\n    this.cellShape = null;\n    this.cellGeo.dispose();\n    this.cellGeo = null;\n    this.cellShapeGeo.dispose();\n    this.cellShapeGeo = null;\n    this._list = null;\n    this._vec3 = null;\n    this._geoCache = null;\n    this._matCache = null;\n  }\n\n\t/*\n\t\tLoad a grid from a parsed json object.\n\t\tjson = {\n\t\t\textrudeSettings,\n\t\t\tsize,\n\t\t\tcellSize,\n\t\t\tautogenerated,\n\t\t\tcells: [],\n\t\t\tmaterials: [\n\t\t\t\t{\n\t\t\t\t\tcache_id: 0,\n\t\t\t\t\ttype: 'MeshLambertMaterial',\n\t\t\t\t\tcolor, ambient, emissive, reflectivity, refractionRatio, wrapAround,\n\t\t\t\t\timgURL: url\n\t\t\t\t}\n\t\t\t\t{\n\t\t\t\t\tcacheId: 1, ...\n\t\t\t\t}\n\t\t\t\t...\n\t\t\t]\n\t\t}\n\t*/\n  load(url: string, cb: Function, scope: any): void {\n    const self = this;\n    Engine.Tools.getJSON({\n      url: url,\n      callback: function (json: GridJSONData) {\n        self.fromJSON(json);\n        cb.call(scope || null, json);\n      },\n      cache: false,\n      scope: self\n    });\n  }\n\n  fromJSON(json: GridJSONData): void {\n    let i, c;\n    const cells =  json.cells;\n\n    this.cells = {};\n    this.numCells = 0;\n\n    this.gridSize = json.size;\n    this.cellSize = json.cellSize;\n    this._cellWidth = this.cellSize * 2;\n    this._cellLength = (Engine.SQRT3 * 0.5) * this._cellWidth;\n\n    this.extrudeSettings = json.extrudeSettings;\n    this.autogenerated = json.autogenerated;\n    \n    const size = Object.keys(json).length;\n\n    for (i = 0; i < size; i++) {\n      c = new Cell();\n      c.copy(cells[i]);\n      this.add(c);\n    }\n  }\n\n  toJSON(): GridJSONData {\n    const json = {\n      size: this.gridSize,\n      cellSize: this.cellSize,\n      extrudeSettings: this.extrudeSettings,\n      autogenerated: this.autogenerated,\n      cells: null,\n    } as GridJSONData;\n    const cells = [] as Cell[];\n    let c, k;\n\n    for (k in this.cells) {\n      c = this.cells[k];\n      cells.push({\n        q: c.q,\n        r: c.r,\n        s: c.s,\n        h: c.h,\n        walkable: c.walkable,\n        userData: c.userData\n      } as Cell);\n    }\n    json.cells = cells;\n\n    return json;\n  }\n\n\t/*  ________________________________________________________________________\n\t\tHexagon-specific conversion math\n\t\tMostly commented out because they're inlined whenever possible to increase performance.\n\t\tThey're still here for reference.\n\t */\n\n  _createVertex(i: number): Vector3 {\n    const angle = (Engine.TAU / 6) * i;\n    return new Vector3((this.cellSize * Math.cos(angle)), (this.cellSize * Math.sin(angle)), 0);\n  }\n\n\t/*_pixelToAxial: function(pos) {\n\t\tvar q, r; // = x, y\n\t\tq = pos.x * ((2/3) / this.cellSize);\n\t\tr = ((-pos.x / 3) + (Engine.SQRT3/3) * pos.y) / this.cellSize;\n\t\tthis._cel.set(q, r, -q-r);\n\t\treturn this._cubeRound(this._cel);\n\t}*/\n\n\t/*_axialToCube: function(h) {\n\t\treturn {\n\t\t\tq: h.q,\n\t\t\tr: h.r,\n\t\t\ts: -h.q - h.r\n\t\t};\n\t}*/\n\n\t/*_cubeToAxial: function(cell) {\n\t\treturn cell; // yep\n\t}*/\n\n\t/*_axialToPixel: function(cell) {\n\t\tvar x, y; // = q, r\n\t\tx = cell.q * this._cellWidth * 0.75;\n\t\ty = (cell.s - cell.r) * this._cellLength * 0.5;\n\t\treturn {x: x, y: -y};\n\t}*/\n\n\t/*_hexToPixel: function(h) {\n\t\tvar x, y; // = q, r\n\t\tx = this.cellSize * 1.5 * h.x;\n\t\ty = this.cellSize * Engine.SQRT3 * (h.y + (h.x * 0.5));\n\t\treturn {x: x, y: y};\n\t}*/\n\n\t/*_axialRound: function(h) {\n\t\treturn this._cubeRound(this.axialToCube(h));\n\t}*/\n\n  _cubeRound(h: Cell): Cell {\n    let rx = Math.round(h.q);\n    let ry = Math.round(h.r);\n    let rz = Math.round(h.s);\n\n    const xDiff = Math.abs(rx - h.q);\n    const yDiff = Math.abs(ry - h.r);\n    const zDiff = Math.abs(rz - h.s);\n\n    if (xDiff > yDiff && xDiff > zDiff) {\n      rx = -ry - rz;\n    }\n    else if (yDiff > zDiff) {\n      ry = -rx - rz;\n    }\n    else {\n      rz = -rx - ry;\n    }\n\n    return this._cel.set(rx, ry, rz);\n  }\n\n\t/*_cubeDistance: function(a, b) {\n\t\treturn Math.max(Math.abs(a.q - b.q), Math.abs(a.r - b.r), Math.abs(a.s - b.s));\n\t}*/\n}","import Engine from '../Engine';\nimport { Vector3, Shape, BufferGeometry, ShapeGeometry, Geometry, MeshPhongMaterial, ExtrudeGeometry, Object3D, Line } from 'three';\nimport { GridInterface } from './Grid';\nimport { GridSettings, ExtrudeSettings, GridJSONData, MapSettings, heuristic } from '../utils/Interfaces';\nimport Cell from './Cell';\nimport Tile from './Tile';\n/*\n\tGraph of squares. Handles grid cell management (placement math for eg pathfinding, range, etc) and grid conversion math.\n\tInterface:\n\ttype\n\tsize - number of cells (in radius); only used if the map is generated\n\tcellSize\n\tcells - a hash so we can have sparse maps\n\tnumCells\n\textrudeSettings\n\tautogenerated\n\tcellShape\n\tcellGeo\n\tcellShapeGeo\n\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\nexport default class SqrGrid implements GridInterface {\n\n  gridShape: string;\n  gridSize: number;\n  cellSize: number;\n  cells: { [key: string]: Cell };\n  numCells: number;\n  extrudeSettings: ExtrudeSettings;\n  cellShape: Shape;\n  cellGeo: BufferGeometry;\n  cellShapeGeo: ShapeGeometry;\n  autogenerated: boolean;\n\n  private _fullCellSize: number;\n  private _hashDelimeter: string;\n  private _directions: Cell[];\n  private _diagonals: Cell[];\n  private _list: Cell[];\n  private _vec3: Vector3;\n  private _cel: Cell;\n  private _geoCache: Geometry[];\n  private _matCache: MeshPhongMaterial[];\n\n  constructor(config: GridSettings) {\n    config = config || {};\n    /*  ______________________________________________\n      GRID INTERFACE:\n    */\n    this.gridShape = Engine.SQR;\n    this.gridSize = 5; // only used for generated maps\n    this.cellSize = typeof config.cellSize === 'undefined' ? 10 : config.cellSize;\n    this.cells = {};\n    this.numCells = 0;\n\n    this.extrudeSettings = null;\n    this.autogenerated = false;\n\n    // create base shape used for building geometry\n    const verts = [];\n    verts.push(new Vector3());\n    verts.push(new Vector3(-this.cellSize, this.cellSize));\n    verts.push(new Vector3(this.cellSize, this.cellSize));\n    verts.push(new Vector3(this.cellSize, -this.cellSize));\n    // copy the verts into a shape for the geometry to use\n    this.cellShape = new Shape();\n    this.cellShape.moveTo(-this.cellSize, -this.cellSize);\n    this.cellShape.lineTo(-this.cellSize, this.cellSize);\n    this.cellShape.lineTo(this.cellSize, this.cellSize);\n    this.cellShape.lineTo(this.cellSize, -this.cellSize);\n    this.cellShape.lineTo(-this.cellSize, -this.cellSize);\n\n    this.cellGeo = new BufferGeometry();\n    (this.cellGeo as any).vertices = verts;\n    (this.cellGeo as any).verticesNeedUpdate = true;\n\n    this.cellShapeGeo = new ShapeGeometry(this.cellShape);\n\n    /*  ______________________________________________\n      PRIVATE\n    */\n\n    this._fullCellSize = this.cellSize * 2;\n    this._hashDelimeter = '.';\n    // pre-computed permutations\n    this._directions = [new Engine.Cell(+1, 0, 0), new Engine.Cell(0, -1, 0),\n    new Engine.Cell(-1, 0, 0), new Engine.Cell(0, +1, 0)];\n    this._diagonals = [new Engine.Cell(-1, -1, 0), new Engine.Cell(-1, +1, 0),\n    new Engine.Cell(+1, +1, 0), new Engine.Cell(+1, -1, 0)];\n    // cached objects\n    this._list = [];\n    this._vec3 = new Vector3();\n    this._cel = new Engine.Cell();\n    this._geoCache = [];\n    this._matCache = [];\n    this.generateGrid(config);\n  }\n  /*\n\t\t________________________________________________________________________\n\t\tHigh-leves that the map interfaces with (all grids implement)\n\t */\n\n  cellToPixel(cell: Cell): Vector3 {\n    this._vec3.x = cell.q * this._fullCellSize;\n    this._vec3.y = cell.h;\n    this._vec3.z = cell.r * this._fullCellSize;\n    return this._vec3;\n  }\n\n  pixelToCell(pos: Vector3): Cell {\n    const q = Math.round(pos.x / this._fullCellSize);\n    const r = Math.round(pos.z / this._fullCellSize);\n    return this._cel.set(q, r, 0);\n  }\n\n  getCellAt(pos: Vector3): Cell {\n    const q = Math.round(pos.x / this._fullCellSize);\n    const r = Math.round(pos.z / this._fullCellSize);\n    this._cel.set(q,0,r);\n    return this.cells[this.cellToHash(this._cel)];\n  }\n\n  getNeighbors(cell: Cell, diagonal: boolean, filter: heuristic): Cell[] {\n    // always returns an array\n    let i, n;\n    const l = this._directions.length;\n    this._list.length = 0;\n    for (i = 0; i < l; i++) {\n      this._cel.copy(cell);\n      this._cel.add(this._directions[i]);\n      n = this.cells[this.cellToHash(this._cel)];\n      if (!n || (filter && !filter(cell, n))) {\n        continue;\n      }\n      this._list.push(n);\n    }\n    if (diagonal) {\n      for (i = 0; i < l; i++) {\n        this._cel.copy(cell);\n        this._cel.add(this._diagonals[i]);\n        n = this.cells[this.cellToHash(this._cel)];\n        if (!n || (filter && !filter(cell, n))) {\n          continue;\n        }\n        this._list.push(n);\n      }\n    }\n    return this._list;\n  }\n\n  getRandomCell(): Cell {\n    let c, i = 0;\n    const x = Engine.Tools.randomInt(0, this.numCells);\n    for (c in this.cells) {\n      if (i === x) {\n        return this.cells[c];\n      }\n      i++;\n    }\n    return this.cells[c];\n  }\n\n  cellToHash(cell: Cell): string {\n    return cell.q + this._hashDelimeter + cell.r; // s is not used in a square grid\n  }\n\n  distance(cellA: Cell, cellB: Cell): number {\n    let d = Math.max(Math.abs(cellA.q - cellB.q), Math.abs(cellA.r - cellB.r));\n    d += cellB.h - cellA.h; // include vertical size\n    return d;\n  }\n\n  clearPath(): void {\n    let i, c;\n    for (i in this.cells) {\n      c = this.cells[i];\n      c._calcCost = 0;\n      c._priority = 0;\n      c._parent = null;\n      c._visited = false;\n    }\n  }\n\n  traverse(cb: (cell: Cell) => void): void {\n    let i;\n    for (i in this.cells) {\n      cb(this.cells[i]);\n    }\n  }\n\n  generateTile(cell: Cell, scale: number, material: MeshPhongMaterial): Tile {\n    let height = Math.abs(cell.h);\n    if (height < 1) height = 1;\n\n    let geo = this._geoCache[height];\n    if (!geo) {\n      this.extrudeSettings.amount = height;\n      geo = new ExtrudeGeometry(this.cellShape, this.extrudeSettings);\n      this._geoCache[height] = geo;\n    }\n\n    /*mat = this._matCache[c.matConfig.mat_cache_id];\n    if (!mat) { // MaterialLoader? we currently only support basic stuff though. maybe later\n      mat.map = Loader.loadTexture(c.matConfig.imgURL);\n      delete c.matConfig.imgURL;\n      mat = new c.matConfig.type](c.matConfig);\n      this._matCache[c.matConfig.mat_cache_id] = mat;\n    }*/\n\n    const t = new Tile({\n      scale: scale,\n      cell: cell,\n      geometry: geo,\n      material: material\n    });\n\n    cell.tile = t;\n\n    return t;\n  }\n\n  generateTiles(config?: MapSettings): Tile[] {\n    config = config || {};\n    const tiles = [];\n    let settings = {\n      tileScale: 0.95,\n      extrudeSettings: {\n        amount: 1,\n        bevelEnabled: true,\n        bevelSegments: 1,\n        steps: 1,\n        bevelSize: 0.5,\n        bevelThickness: 0.5\n      } as ExtrudeSettings\n    } as MapSettings;\n    if(config)\n      settings = Engine.Tools.merge(settings, config) as MapSettings;\n\n    /*if (!settings.material) {\n      settings.material = new MeshPhongMaterial({\n        color: Engine.Tools.randomizeRGB('30, 30, 30', 10)\n      });\n    }*/\n\n    this.autogenerated = true;\n    this.extrudeSettings = settings.extrudeSettings;\n\n    let i, t, c;\n    for (i in this.cells) {\n      c = this.cells[i];\n      t = this.generateTile(c, settings.tileScale, null);\n      t.position.copy(this.cellToPixel(c));\n      t.position.y = 0;\n      tiles.push(t);\n    }\n    return tiles;\n  }\n\n  // create a flat, square-shaped grid\n  generateGrid(config: GridSettings): void {\n    config = config || {};\n    this.gridSize = typeof config.gridSize === 'undefined' ? this.gridSize : config.gridSize;\n    let x, y, c;\n    const half = Math.ceil(this.gridSize / 2);\n    for (x = -half; x < half; x++) {\n      for (y = -half; y < half; y++) {\n        c = new Engine.Cell(x, y + 1);\n        this.add(c);\n      }\n    }\n  }\n\n  generateOverlay(size: number, overlayObj: Object3D, overlayMat: MeshPhongMaterial): void {\n    let x, y;\n    const half = Math.ceil(size / 2);\n    for (x = -half; x < half; x++) {\n      for (y = -half; y < half; y++) {\n        this._cel.set(x, y, undefined); // define the cell\n        const line = new Line(this.cellGeo, overlayMat);\n        line.position.copy(this.cellToPixel(this._cel));\n        line.rotation.x = 90 * Engine.DEG_TO_RAD;\n        overlayObj.add(line);\n      }\n    }\n  }\n\n  add(cell: Cell): Cell {\n    const h = this.cellToHash(cell);\n    if (this.cells[h]) {\n      // console.warn('A cell already exists there');\n      return;\n    }\n    this.cells[h] = cell;\n    this.numCells++;\n\n    return cell;\n  }\n\n  remove(cell: Cell): Cell {\n    const h = this.cellToHash(cell);\n    if (this.cells[h]) {\n      delete this.cells[h];\n      this.numCells--;\n    }\n    return cell;\n  }\n\n  dispose(): void {\n    this.cells = null;\n    this.numCells = 0;\n    this.cellShape = null;\n    this.cellGeo.dispose();\n    this.cellGeo = null;\n    this.cellShapeGeo.dispose();\n    this.cellShapeGeo = null;\n    this._list = null;\n    this._vec3 = null;\n    this._geoCache = null;\n    this._matCache = null;\n  }\n\n  /*\n    Load a grid from a parsed json object.\n    json = {\n      extrudeSettings,\n      size,\n      cellSize,\n      autogenerated,\n      cells: [],\n      materials: [\n        {\n          cache_id: 0,\n          type: 'MeshLambertMaterial',\n          color, ambient, emissive, reflectivity, refractionRatio, wrapAround,\n          imgURL: url\n        }\n        {\n          cacheId: 1, ...\n        }\n        ...\n      ]\n    }\n  */\n  load(url: string, callback: Function, scope: any): void {\n    Engine.Tools.getJSON({\n      url: url,\n      callback(json: GridJSONData) {\n        this.fromJSON(json);\n        callback.call(scope || null, json);\n      },\n      cache: false,\n      scope: this\n    });\n  }\n\n  fromJSON(json: GridJSONData): void {\n    let i, c;\n    const cells = json.cells;\n\n    this.cells = {};\n    this.numCells = 0;\n\n    this.gridSize = json.size;\n    this.cellSize = json.cellSize;\n    this._fullCellSize = this.cellSize * 2;\n    this.extrudeSettings = json.extrudeSettings;\n    this.autogenerated = json.autogenerated;\n\n    for (i = 0; i < cells.length; i++) {\n      c = new Engine.Cell();\n      c.copy(cells[i]);\n      this.add(c);\n    }\n  }\n\n  toJSON(): GridJSONData {\n    const json = {\n      size: this.gridSize,\n      cellSize: this.cellSize,\n      extrudeSettings: this.extrudeSettings,\n      autogenerated: this.autogenerated\n    } as GridJSONData\n    const cells = [];\n    let c, k;\n\n    for (k in this.cells) {\n      c = this.cells[k];\n      cells.push({\n        q: c.q,\n        r: c.r,\n        s: c.s,\n        h: c.h,\n        walkable: c.walkable,\n        userData: c.userData\n      } as Cell);\n    }\n    json.cells = cells;\n\n    return json;\n  }\n}","/* eslint-disable */\n/*\n\tA high-speed doubly-linked list of objects. Note that for speed reasons (using a dictionary lookup of\n\tcached nodes) there can only be a single instance of an object in the list at the same time. Adding the same\n\tobject a second time will result in a silent return from the add method.\n\n\tIn order to keep a track of node links, an object must be able to identify itself with a uniqueID function.\n\n\tTo add an item use:\n\t<pre><code>\n\t\tlist.add(newItem);\n\t</code></pre>\n\t<p>\n\tYou can iterate using the first and next members, such as:\n\t<pre><code>\n\t\tvar node = list.first;\n\t\twhile (node)\n\t\t{\n\t\t\tnode.object().DOSOMETHING();\n\t\t\tnode = node.next();\n\t\t}\n\t</code></pre>\n */\n\nclass Node {\n\tconstructor() {\n\t\tthis.obj = null;\n\t\tthis.next = null;\n\t\tthis.prev = null;\n\t\tthis.free = true;\n\t}\n}\n\nexport default class LinkedList {\n\tconstructor() {\n\t\tthis.first = null;\n\t\tthis.last = null;\n\t\tthis.length = 0;\n\t\tthis.objToNodeMap = {}; // a quick lookup list to map linked list nodes to objects\n\t\tthis.uniqueID = Date.now() + '' + Math.floor(Math.random() * 1000);\n\n\t\tthis.sortArray = [];\n\t}\n\n\t// static function for utility\n\tstatic generateID(obj) {\n\t\treturn Math.random().toString(36).slice(2) + Date.now();\n\t}\n\n\t/*\n\t\t\t  Get the LinkedListNode for this object.\n\t\t\t  @param obj The object to get the node for\n\t\t   */\n\tgetNode(obj) {\n\t\t// objects added to a list must implement a uniqueID which returns a unique object identifier string\n\t\treturn this.objToNodeMap[obj.uniqueID];\n\t}\n\n\t/*\n\t  Adds a new node to the list -- typically only used internally unless you're doing something funky\n\t  Use add() to add an object to the list, not this.\n\t */\n\taddNode(obj) {\n\t\tconst node = new Node();\n\t\tif (!obj.uniqueID) {\n\t\t\ttry {\n\t\t\t\tobj.uniqueID = LinkedList.generateID();\n\t\t\t\t// console.log('New ID: '+obj.uniqueID);\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\tconsole.error('[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tnode.obj = obj;\n\t\tnode.free = false;\n\t\tthis.objToNodeMap[obj.uniqueID] = node;\n\t\treturn node;\n\t}\n\n\tswapObjects(node, newObj) {\n\t\tthis.objToNodeMap[node.obj.uniqueID] = null;\n\t\tthis.objToNodeMap[newObj.uniqueID] = node;\n\t\tnode.obj = newObj;\n\t}\n\n\t/*\n\t  Add an item to the list\n\t  @param obj The object to add\n\t */\n\tadd(obj) {\n\t\tlet node = this.objToNodeMap[obj.uniqueID];\n\n\t\tif (!node) {\n\t\t\tnode = this.addNode(obj);\n\t\t}\n\t\telse {\n\t\t\tif (node.free === false) return;\n\n\t\t\t// reusing a node, so we clean it up\n\t\t\t// this caching of node/object pairs is the reason an object can only exist\n\t\t\t// once in a list -- which also makes things faster (not always creating new node\n\t\t\t// object every time objects are moving on and off the list\n\t\t\tnode.obj = obj;\n\t\t\tnode.free = false;\n\t\t\tnode.next = null;\n\t\t\tnode.prev = null;\n\t\t}\n\n\t\t// append this obj to the end of the list\n\t\tif (!this.first) { // is this the first?\n\t\t\tthis.first = node;\n\t\t\tthis.last = node;\n\t\t\tnode.next = null; // clear just in case\n\t\t\tnode.prev = null;\n\t\t}\n\t\telse {\n\t\t\tif (!this.last) {\n\t\t\t\tthrow new Error(\"[LinkedList.add] No last in the list -- that shouldn't happen here\");\n\t\t\t}\n\n\t\t\t// add this entry to the end of the list\n\t\t\tthis.last.next = node; // current end of list points to the new end\n\t\t\tnode.prev = this.last;\n\t\t\tthis.last = node;            // new object to add becomes last in the list\n\t\t\tnode.next = null;      // just in case this was previously set\n\t\t}\n\t\tthis.length++;\n\n\t\tif (this.showDebug) this.dump('after add');\n\t}\n\n\thas(obj) {\n\t\treturn !!this.objToNodeMap[obj.uniqueID];\n\t}\n\n\t/*\n\t  Moves this item upwards in the list\n\t  @param obj\n\t */\n\tmoveUp(obj) {\n\t\tthis.dump('before move up');\n\t\tconst c = this.getNode(obj);\n\t\tif (!c) throw Error(\"Oops, trying to move an object that isn't in the list\");\n\t\tif (!c.prev) return; // already first, ignore\n\n\t\t// This operation makes C swap places with B:\n\t\t// A <-> B <-> C <-> D\n\t\t// A <-> C <-> B <-> D\n\n\t\tconst b = c.prev;\n\t\tconst a = b.prev;\n\n\t\t// fix last\n\t\tif (c == this.last) this.last = b;\n\n\t\tconst oldCNext = c.next;\n\n\t\tif (a) a.next = c;\n\t\tc.next = b;\n\t\tc.prev = b.prev;\n\n\t\tb.next = oldCNext;\n\t\tb.prev = c;\n\n\t\t// check to see if we are now first\n\t\tif (this.first == b) this.first = c;\n\t}\n\n\t/*\n\t  Moves this item downwards in the list\n\t  @param obj\n\t */\n\tmoveDown(obj) {\n\t\tconst b = this.getNode(obj);\n\t\tif (!b) throw \"Oops, trying to move an object that isn't in the list\";\n\t\tif (!b.next) return; // already last, ignore\n\n\t\t// This operation makes B swap places with C:\n\t\t// A <-> B <-> C <-> D\n\t\t// A <-> C <-> B <-> D\n\n\t\tconst c = b.next;\n\t\tthis.moveUp(c.obj);\n\n\t\t// check to see if we are now last\n\t\tif (this.last == c) this.last = b;\n\t}\n\n\t/*\n\t  Take everything off the list and put it in an array, sort it, then put it back.\n\t */\n\tsort(compare) {\n\t\tconst sortArray = this.sortArray;\n\t\tlet i, l, node = this.first;\n\t\tsortArray.length = 0;\n\n\t\twhile (node) {\n\t\t\tsortArray.push(node.obj);\n\t\t\tnode = node.next;\n\t\t}\n\n\t\tthis.clear();\n\n\t\tsortArray.sort(compare);\n\t\t// console.log(sortArray);\n\t\tl = sortArray.length;\n\t\tfor (i = 0; i < l; i++) {\n\t\t\tthis.add(sortArray[i]);\n\t\t}\n\t}\n\n\t/*\n\t  Removes an item from the list\n\t  @param obj The object to remove\n\t  @returns boolean true if the item was removed, false if the item was not on the list\n\t */\n\tremove(obj) {\n\t\tconst node = this.getNode(obj);\n\t\tif (!node || node.free) {\n\t\t\treturn false; // ignore this error (trying to remove something not there)\n\t\t}\n\n\t\t// pull this object out and tie up the ends\n\t\tif (node.prev) node.prev.next = node.next;\n\t\tif (node.next) node.next.prev = node.prev;\n\n\t\t// fix first and last\n\t\tif (!node.prev) // if this was first on the list\n\t\t\tthis.first = node.next; // make the next on the list first (can be null)\n\t\tif (!node.next) // if this was the last\n\t\t\tthis.last = node.prev; // then this node's previous becomes last\n\n\t\tnode.free = true;\n\t\tnode.prev = null;\n\t\tnode.next = null;\n\n\t\tthis.length--;\n\n\t\treturn true;\n\t}\n\n\t// remove the head and return it's object\n\tshift() {\n\t\tconst node = this.first;\n\t\tif (this.length === 0) return null;\n\t\t// if (node == null || node.free == true) return null;\n\n\t\t// pull this object out and tie up the ends\n\t\tif (node.prev) {\n\t\t\tnode.prev.next = node.next;\n\t\t}\n\t\tif (node.next) {\n\t\t\tnode.next.prev = node.prev;\n\t\t}\n\n\t\t// make the next on the list first (can be null)\n\t\tthis.first = node.next;\n\t\tif (!node.next) this.last = null; // make sure we clear this\n\n\t\tnode.free = true;\n\t\tnode.prev = null;\n\t\tnode.next = null;\n\n\t\tthis.length--;\n\t\treturn node.obj;\n\t}\n\n\t// remove the tail and return it's object\n\tpop() {\n\t\tconst node = this.last;\n\t\tif (this.length === 0) return null;\n\n\t\t// pull this object out and tie up the ends\n\t\tif (node.prev) {\n\t\t\tnode.prev.next = node.next;\n\t\t}\n\t\tif (node.next) {\n\t\t\tnode.next.prev = node.prev;\n\t\t}\n\n\t\t// this node's previous becomes last\n\t\tthis.last = node.prev;\n\t\tif (!node.prev) this.first = null; // make sure we clear this\n\n\t\tnode.free = true;\n\t\tnode.prev = null;\n\t\tnode.next = null;\n\n\t\tthis.length--;\n\t\treturn node.obj;\n\t}\n\n\t/**\n\t * Add the passed list to this list, leaving it untouched.\n\t */\n\tconcat(list) {\n\t\tlet node = list.first;\n\t\twhile (node) {\n\t\t\tthis.add(node.obj);\n\t\t\tnode = node.next;\n\t\t}\n\t}\n\n\t/**\n\t * Clears the list out\n\t */\n\tclear() {\n\t\tlet next = this.first;\n\n\t\twhile (next) {\n\t\t\tnext.free = true;\n\t\t\tnext = next.next;\n\t\t}\n\n\t\tthis.first = null;\n\t\tthis.length = 0;\n\t}\n\n\tdispose() {\n\t\tlet next = this.first;\n\n\t\twhile (next) {\n\t\t\tnext.obj = null;\n\t\t\tnext = next.next;\n\t\t}\n\t\tthis.first = null;\n\n\t\tthis.objToNodeMap = null;\n\t}\n\n\t/*\n\t  Outputs the contents of the current list for debugging.\n\t */\n\tdump(msg) {\n\t\tconsole.log('====================' + msg + '=====================');\n\t\tlet a = this.first;\n\t\twhile (a) {\n\t\t\tconsole.log(\"{\" + a.obj.toString() + \"} previous=\" + (a.prev ? a.prev.obj : \"NULL\"));\n\t\t\ta = a.next();\n\t\t}\n\t\tconsole.log(\"===================================\");\n\t\tconsole.log(\"Last: {\" + (this.last ? this.last.obj : 'NULL') + \"} \" +\n\t\t\t\"First: {\" + (this.first ? this.first.obj : 'NULL') + \"}\");\n\t}\n}","/* eslint-disable */\n\nclass SignalBinding {\n\tconstructor(signal, listener, isOnce, listenerContext, priority) {\n\t\t/**\n\t\t* @property _listener - Handle bound to the signal.\n\t\t* @private\n\t\t*/\n\t\tthis._listener = listener;\n\n\t\t/**\n\t\t* @property {boolean} isOnce - If binding should be executed just once.\n\t\t* @private\n\t\t*/\n\t\tthis.isOnce = isOnce;\n\n\t\t/**\n\t\t* @property {object|undefined|null} context - Context on which listener will be executed (object that should represent the `this` variable inside listene).\n\t\t*/\n\t\tthis.context = listenerContext;\n\n\t\t/**\n\t\t* @property {Signal} signal - Reference to Signal object that listener is currently bound to.\n\t\t* @private\n\t\t*/\n\t\tthis.signal = signal;\n\n\t\t/**\n\t\t* @property {number} _priority - Listener priority.\n\t\t* @private\n\t\t*/\n\t\tthis._priority = priority || 0;\n\t}\n\t/**\n\t* Call listener passing arbitrary parameters.\n\t* If binding was added using `Signal.addOnce()` it will be automatically removed from signal dispatch queue, this method is used internally for the signal dispatch.\n\t* @method SignalBinding#execute\n\t* @param {array} [paramsArr] - Array of parameters that should be passed to the listener.\n\t* @return {any} Value returned by the listener.\n\t*/\n\texecute(paramsArr) {\n\n\t\tvar handlerReturn, params;\n\n\t\tif (SignalBinding.active && !!this._listener) {\n\t\t\tparams = this.params ? this.params.concat(paramsArr) : paramsArr;\n\t\t\thandlerReturn = this._listener.apply(this.context, params);\n\n\t\t\tif (this.isOnce) {\n\t\t\t\tthis.detach();\n\t\t\t}\n\t\t}\n\n\t\treturn handlerReturn;\n\n\t}\n\n\t/**\n\t* Detach binding from signal.\n\t* alias to: @see mySignal.remove(myBinding.listener);\n\t* @method SignalBinding#detach\n\t* @return|null} Handle bound to the signal or `null` if binding was previously detached.\n\t*/\n\tdetach() {\n\t\treturn this.isBound() ? this.signal.remove(this._listener, this.context) : null;\n\t}\n\n\t/**\n\t* @method SignalBinding#isBound\n\t* @return {boolean} True if binding is still bound to the signal and has a listener.\n\t*/\n\tisBound() {\n\t\treturn (!!this.signal && !!this._listener);\n\t}\n\n\t/**\n\t* Delete instance properties\n\t* @method SignalBinding#_destroy\n\t* @private\n\t*/\n\t_destroy() {\n\t\tdelete this.signal;\n\t\tdelete this._listener;\n\t\tdelete this.context;\n\t}\n\n\t/**\n\t* @method SignalBinding#toString\n\t* @return {string} String representation of the object.\n\t*/\n\ttoString() {\n\t\treturn '[SignalBinding isOnce:' + this.isOnce + ', isBound:' + this.isBound() + ', active:' + SignalBinding.active + ']';\n\t}\n}\n\n/**\n      * If binding is active and should be executed.\n      * @property {boolean} active\n      * @default\n      */\nSignalBinding.active = true;\n\n/**\n* Default parameters passed to listener during `Signal.dispatch` and `SignalBinding.execute` (curried parameters).\n* @property {array|null} params\n* @default\n*/\nSignalBinding.params = null;\n\n/**\n    * @author       Miller Medeiros http://millermedeiros.github.com/js-signals/\n    * @author       Richard Davey <rich@photonstorm.com>\n    * @copyright    2014 Photon Storm Ltd.\n    * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}\n    */\n\n/**\n* A Signal is used for object communication via a custom broadcaster instead of Events.\n*\n* @class Signal\n* @constructor\n*/\nexport default class Signal {\n\tconstructor() {\n\t\t/**\n\t\t\t* @property {Array.<SignalBinding>} _bindings - Internal variable.\n\t\t\t* @private\n\t\t\t*/\n\t\tthis._bindings = [];\n\n\t\t/**\n\t\t* @property {any} _prevParams - Internal variable.\n\t\t* @private\n\t\t*/\n\t\tthis._prevParams = null;\n\n\t\t/*\n\t\t// enforce dispatch to aways work on same context (#47)\n\t\tvar self = this;\n\t\n\t\t/**\n\t\t* @property } dispatch - The dispatch is what sends the Signal out.\n\t\t//*\n\t\tthis.dispatch = () => {\n\t\t  this.prototype.dispatch.apply(self, arguments);\n\t\t};*/\n\t}\n\t/**\n\t* @method Signal#validateListener\n\t* @param } listener - Signal handler.\n\t* @param {string} fnName - name.\n\t* @private\n\t*/\n\tvalidateListener(listener, fnName) {\n\t\tif (typeof listener !== 'function') {\n\t\t\tthrow new Error('Signal: listener is a required param of {fn}() and should be a.'.replace('{fn}', fnName));\n\t\t}\n\t}\n\n\t/**\n\t* @method Signal#_registerListener\n\t* @private\n\t* @param } listener - Signal handler.\n\t* @param {boolean} isOnce - Should the listener only be called once?\n\t* @param {object} [listenerContext] - The context under which the listener is invoked.\n\t* @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added. (default = 0).\n\t* @return {SignalBinding} An Object representing the binding between the Signal and listener.\n\t*/\n\t_registerListener(listener, isOnce, listenerContext, priority) {\n\t\tvar prevIndex = this._indexOfListener(listener, listenerContext);\n\t\tvar binding;\n\n\t\tif (prevIndex !== -1) {\n\t\t\tbinding = this._bindings[prevIndex];\n\n\t\t\tif (binding.isOnce !== isOnce) {\n\t\t\t\tthrow new Error('You cannot add' + (isOnce ? '' : 'Once') + '() then add' + (!isOnce ? '' : 'Once') + '() the same listener without removing the relationship first.');\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tbinding = new SignalBinding(this, listener, isOnce, listenerContext, priority);\n\t\t\tthis._addBinding(binding);\n\t\t}\n\n\t\tif (Signal.memorize && this._prevParams) {\n\t\t\tbinding.execute(this._prevParams);\n\t\t}\n\n\t\treturn binding;\n\t}\n\n\t/**\n\t* @method Signal#_addBinding\n\t* @private\n\t* @param {SignalBinding} binding - An Object representing the binding between the Signal and listener.\n\t*/\n\t_addBinding(binding) {\n\t\t//  Simplified insertion sort\n\t\tvar n = this._bindings.length;\n\n\t\tdo {\n\t\t\tn--;\n\t\t}\n\t\twhile (this._bindings[n] && binding._priority <= this._bindings[n]._priority);\n\n\t\tthis._bindings.splice(n + 1, 0, binding);\n\t}\n\n\t/**\n\t* @method Signal#_indexOfListener\n\t* @private\n\t* @param } listener - Signal handler.\n\t* @return {number} The index of the listener within the private bindings array.\n\t*/\n\t_indexOfListener(listener, context) {\n\t\tvar n = this._bindings.length;\n\t\tvar cur;\n\n\t\twhile (n--) {\n\t\t\tcur = this._bindings[n];\n\n\t\t\tif (cur._listener === listener && cur.context === context) {\n\t\t\t\treturn n;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\t/**\n\t* Check if listener was attached to Signal.\n\t*\n\t* @method Signal#has\n\t* @param } listener - Signal handler.\n\t* @param {object} [context] - Context on which listener will be executed (object that should represent the `this` variable inside listener).\n\t* @return {boolean} If Signal has the specified listener.\n\t*/\n\thas(listener, context) {\n\t\treturn this._indexOfListener(listener, context) !== -1;\n\t}\n\n\t/**\n\t* Add a listener to the signal.\n\t*\n\t* @method Signal#add\n\t* @param } listener - The to call when this Signal is dispatched.\n\t* @param {object} [listenerContext] - The context under which the listener will be executed (i.e. the object that should represent the `this` variable).\n\t* @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added (default = 0)\n\t* @return {SignalBinding} An Object representing the binding between the Signal and listener.\n\t*/\n\tadd(listener, listenerContext, priority) {\n\t\tthis.validateListener(listener, 'add');\n\n\t\treturn this._registerListener(listener, false, listenerContext, priority);\n\t}\n\n\t/**\n\t* Add listener to the signal that should be removed after first execution (will be executed only once).\n\t*\n\t* @method Signal#addOnce\n\t* @param } listener - The to call when this Signal is dispatched.\n\t* @param {object} [listenerContext] - The context under which the listener will be executed (i.e. the object that should represent the `this` variable).\n\t* @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added (default = 0)\n\t* @return {SignalBinding} An Object representing the binding between the Signal and listener.\n\t*/\n\taddOnce(listener, listenerContext, priority) {\n\t\tthis.validateListener(listener, 'addOnce');\n\n\t\treturn this._registerListener(listener, true, listenerContext, priority);\n\t}\n\n\t/**\n\t* Remove a single listener from the dispatch queue.\n\t*\n\t* @method Signal#remove\n\t* @param } listener - Handler that should be removed.\n\t* @param {object} [context] - Execution context (since you can add the same handler multiple times if executing in a different context).\n\t* @return } Listener handler.\n\t*/\n\tremove(listener, context) {\n\t\tthis.validateListener(listener, 'remove');\n\n\t\tvar i = this._indexOfListener(listener, context);\n\n\t\tif (i !== -1) {\n\t\t\tthis._bindings[i]._destroy(); //no reason to a SignalBinding exist if it isn't attached to a signal\n\t\t\tthis._bindings.splice(i, 1);\n\t\t}\n\n\t\treturn listener;\n\t}\n\n\t/**\n\t* Remove all listeners from the Signal.\n\t*\n\t* @method Signal#removeAll\n\t* @param {object} [context=null] - If specified only listeners for the given context will be removed.\n\t*/\n\tremoveAll(context) {\n\t\tif (typeof context === 'undefined') { context = null; }\n\n\t\tvar n = this._bindings.length;\n\n\t\twhile (n--) {\n\t\t\tif (context) {\n\t\t\t\tif (this._bindings[n].context === context) {\n\t\t\t\t\tthis._bindings[n]._destroy();\n\t\t\t\t\tthis._bindings.splice(n, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._bindings[n]._destroy();\n\t\t\t}\n\t\t}\n\n\t\tif (!context) {\n\t\t\tthis._bindings.length = 0;\n\t\t}\n\t}\n\n\t/**\n\t* Gets the total number of listeneres attached to ths Signal.\n\t*\n\t* @method Signal#getNumListeners\n\t* @return {number} Number of listeners attached to the Signal.\n\t*/\n\tgetNumListeners() {\n\t\treturn this._bindings.length;\n\t}\n\n\t/**\n\t* Stop propagation of the event, blocking the dispatch to next listeners on the queue.\n\t* IMPORTANT: should be called only during signal dispatch, calling it before/after dispatch won't affect signal broadcast.\n\t* @see Signal.prototype.disable\n\t*\n\t* @method Signal#halt\n\t*/\n\thalt() {\n\t\tSignal._shouldPropagate = false;\n\t}\n\n\t/**\n\t* Dispatch/Broadcast Signal to all listeners added to the queue.\n\t*\n\t* @method Signal#dispatch\n\t* @param {any} [params] - Parameters that should be passed to each handler.\n\t*/\n\tdispatch() {\n\t\tif (!Signal.active) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar paramsArr = Array.prototype.slice.call(arguments);\n\t\tvar n = this._bindings.length;\n\t\tvar bindings;\n\n\t\tif (Signal.memorize) {\n\t\t\tthis._prevParams = paramsArr;\n\t\t}\n\n\t\tif (!n) {\n\t\t\t//  Should come after memorize\n\t\t\treturn;\n\t\t}\n\n\t\tbindings = this._bindings.slice(); //clone array in case add/remove items during dispatch\n\t\tSignal._shouldPropagate = true; //in case `halt` was called before dispatch or during the previous dispatch.\n\n\t\t//execute all callbacks until end of the list or until a callback returns `false` or stops propagation\n\t\t//reverse loop since listeners with higher priority will be added at the end of the list\n\t\tdo {\n\t\t\tn--;\n\t\t}\n\t\twhile (bindings[n] && Signal._shouldPropagate && bindings[n].execute(paramsArr) !== false);\n\t}\n\n\t/**\n\t* Forget memorized arguments.\n\t* @see Signal.memorize\n\t*\n\t* @method Signal#forget\n\t*/\n\tforget() {\n\t\tthis._prevParams = null;\n\t}\n\n\t/**\n\t* Remove all bindings from signal and destroy any reference to external objects (destroy Signal object).\n\t* IMPORTANT: calling any method on the signal instance after calling dispose will throw errors.\n\t*\n\t* @method Signal#dispose\n\t*/\n\tdispose() {\n\t\tthis.removeAll();\n\n\t\tdelete this._bindings;\n\t\tdelete this._prevParams;\n\t}\n\n\t/**\n\t*\n\t* @method Signal#toString\n\t* @return {string} String representation of the object.\n\t*/\n\ttoString() {\n\t\treturn '[Signal active:' + this.active + ' numListeners:' + this.getNumListeners() + ']';\n\t}\n}\n/**\n        * If Signal should keep record of previously dispatched parameters and\n        * automatically execute listener during `add()`/`addOnce()` if Signal was\n        * already dispatched before.\n        * @property {boolean} memorize\n        */\nSignal.memorize = false;\n\n/**\n* @property {boolean} _shouldPropagate\n* @private\n*/\nSignal._shouldPropagate = true;\n\n/**\n* If Signal is active and should broadcast events.\n* IMPORTANT: Setting this property during a dispatch will only affect the next dispatch, if you want to stop the propagation of a signal use `halt()` instead.\n* @property {boolean} active\n* @default\n*/\nSignal.active = true;","/* eslint-disable */\n\n/*\n\t@source https://github.com/qiao/PathFinding.js/\n*/\nimport Cell from '../grids/Cell';\n\nclass PathUtil {\n\t/**\n\t   * Backtrace according to the parent records and return the path.\n\t   * (including both start and end nodes)\n\t   * @param {Cell} node End node\n\t   * @return {Array.<Array.<Cell>>} the path\n\t   */\n\tbacktrace(node) {\n\t\tvar path = [node];\n\t\twhile (node._parent) {\n\t\t\tnode = node._parent;\n\t\t\tpath.push(node);\n\t\t}\n\t\treturn path.reverse();\n\t}\n\n\t/**\n\t * Backtrace from start and end node, and return the path.\n\t * (including both start and end nodes)\n\t * @param {Cell}\n\t * @param {Cell}\n\t */\n\tbiBacktrace(nodeA, nodeB) {\n\t\tvar pathA = this.backtrace(nodeA),\n\t\t\tpathB = this.backtrace(nodeB);\n\t\treturn pathA.concat(pathB.reverse());\n\t}\n\n\t/**\n\t * Compute the length of the path.\n\t * @param {Array.<Array.<number>>} path The path\n\t * @return {number} The length of the path\n\t */\n\tpathLength(path) {\n\t\tvar i, sum = 0, a, b, dx, dy;\n\t\tfor (i = 1; i < path.length; ++i) {\n\t\t\ta = path[i - 1];\n\t\t\tb = path[i];\n\t\t\tdx = a[0] - b[0];\n\t\t\tdy = a[1] - b[1];\n\t\t\tsum += Math.sqrt(dx * dx + dy * dy);\n\t\t}\n\t\treturn sum;\n\t}\n\n\n\t/**\n\t * Given the start and end coordinates, return all the coordinates lying\n\t * on the line formed by these coordinates, based on Bresenham's algorithm.\n\t * http://en.wikipedia.org/wiki/Bresenham's_line_algorithm#Simplification\n\t * @param {number} x0 Start x coordinate\n\t * @param {number} y0 Start y coordinate\n\t * @param {number} x1 End x coordinate\n\t * @param {number} y1 End y coordinate\n\t * @return {Array.<Array.<number>>} The coordinates on the line\n\t */\n\tinterpolate(x0, y0, x1, y1) {\n\t\tvar abs = Math.abs,\n\t\t\tline = [],\n\t\t\tsx, sy, dx, dy, err, e2;\n\n\t\tdx = abs(x1 - x0);\n\t\tdy = abs(y1 - y0);\n\n\t\tsx = (x0 < x1) ? 1 : -1;\n\t\tsy = (y0 < y1) ? 1 : -1;\n\n\t\terr = dx - dy;\n\n\t\twhile (x0 !== x1 || y0 !== y1) {\n\t\t\tline.push([x0, y0]);\n\n\t\t\te2 = 2 * err;\n\t\t\tif (e2 > -dy) {\n\t\t\t\terr = err - dy;\n\t\t\t\tx0 = x0 + sx;\n\t\t\t}\n\t\t\tif (e2 < dx) {\n\t\t\t\terr = err + dx;\n\t\t\t\ty0 = y0 + sy;\n\t\t\t}\n\t\t}\n\n\t\treturn line;\n\t}\n\n\n\t/**\n\t * Given a compressed path, return a new path that has all the segments\n\t * in it interpolated.\n\t * @param {Array.<Array.<number>>} path The path\n\t * @return {Array.<Array.<number>>} expanded path\n\t */\n\texpandPath(path) {\n\t\tvar expanded = [],\n\t\t\tlen = path.length,\n\t\t\tcoord0, coord1,\n\t\t\tinterpolated,\n\t\t\tinterpolatedLen,\n\t\t\ti, j;\n\n\t\tif (len < 2) {\n\t\t\treturn expanded;\n\t\t}\n\n\t\tfor (i = 0; i < len - 1; ++i) {\n\t\t\tcoord0 = path[i];\n\t\t\tcoord1 = path[i + 1];\n\n\t\t\tinterpolated = this.interpolate(coord0[0], coord0[1], coord1[0], coord1[1]);\n\t\t\tinterpolatedLen = interpolated.length;\n\t\t\tfor (j = 0; j < interpolatedLen - 1; ++j) {\n\t\t\t\texpanded.push(interpolated[j]);\n\t\t\t}\n\t\t}\n\t\texpanded.push(path[len - 1]);\n\n\t\treturn expanded;\n\t}\n\n\n\t/**\n\t * Smoothen the give path.\n\t * The original path will not be modified; a new path will be returned.\n\t * @param {PF.Grid} grid\n\t * @param {Array.<Array.<number>>} path The path\n\t */\n\tsmoothenPath(grid, path) {\n\t\tvar len = path.length,\n\t\t\tx0 = path[0][0],        // path start x\n\t\t\ty0 = path[0][1],        // path start y\n\t\t\tx1 = path[len - 1][0],  // path end x\n\t\t\ty1 = path[len - 1][1],  // path end y\n\t\t\tsx, sy,                 // current start coordinate\n\t\t\tex, ey,                 // current end coordinate\n\t\t\tnewPath,\n\t\t\tlastValidCoord,\n\t\t\ti, j, coord, line, testCoord, blocked;\n\n\t\tsx = x0;\n\t\tsy = y0;\n\t\tnewPath = [[sx, sy]];\n\n\t\tfor (i = 2; i < len; ++i) {\n\t\t\tcoord = path[i];\n\t\t\tex = coord[0];\n\t\t\tey = coord[1];\n\t\t\tline = this.interpolate(sx, sy, ex, ey);\n\n\t\t\tblocked = false;\n\t\t\tfor (j = 1; j < line.length; ++j) {\n\t\t\t\ttestCoord = line[j];\n\n\t\t\t\tif (!grid.isWalkableAt(testCoord[0], testCoord[1])) {\n\t\t\t\t\tblocked = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (blocked) {\n\t\t\t\tlastValidCoord = path[i - 1];\n\t\t\t\tnewPath.push(lastValidCoord);\n\t\t\t\tsx = lastValidCoord[0];\n\t\t\t\tsy = lastValidCoord[1];\n\t\t\t}\n\t\t}\n\t\tnewPath.push([x1, y1]);\n\n\t\treturn newPath;\n\t}\n\n\n\t/**\n\t * Compress a path, remove redundant nodes without altering the shape\n\t * The original path is not modified\n\t * @param {Array.<Array.<number>>} path The path\n\t * @return {Array.<Array.<number>>} The compressed path\n\t */\n\tcompressPath(path) {\n\n\t\t// nothing to compress\n\t\tif (path.length < 3) {\n\t\t\treturn path;\n\t\t}\n\n\t\tvar compressed = [],\n\t\t\tsx = path[0][0], // start x\n\t\t\tsy = path[0][1], // start y\n\t\t\tpx = path[1][0], // second point x\n\t\t\tpy = path[1][1], // second point y\n\t\t\tdx = px - sx, // direction between the two points\n\t\t\tdy = py - sy, // direction between the two points\n\t\t\tlx, ly,\n\t\t\tldx, ldy,\n\t\t\tsq, i;\n\n\t\t// normalize the direction\n\t\tsq = Math.sqrt(dx * dx + dy * dy);\n\t\tdx /= sq;\n\t\tdy /= sq;\n\n\t\t// start the new path\n\t\tcompressed.push([sx, sy]);\n\n\t\tfor (i = 2; i < path.length; i++) {\n\n\t\t\t// store the last point\n\t\t\tlx = px;\n\t\t\tly = py;\n\n\t\t\t// store the last direction\n\t\t\tldx = dx;\n\t\t\tldy = dy;\n\n\t\t\t// next point\n\t\t\tpx = path[i][0];\n\t\t\tpy = path[i][1];\n\n\t\t\t// next direction\n\t\t\tdx = px - lx;\n\t\t\tdy = py - ly;\n\n\t\t\t// normalize\n\t\t\tsq = Math.sqrt(dx * dx + dy * dy);\n\t\t\tdx /= sq;\n\t\t\tdy /= sq;\n\n\t\t\t// if the direction has changed, store the point\n\t\t\tif (dx !== ldx || dy !== ldy) {\n\t\t\t\tcompressed.push([lx, ly]);\n\t\t\t}\n\t\t}\n\n\t\t// store the last point\n\t\tcompressed.push([px, py]);\n\n\t\treturn compressed;\n\t}\n}\nexport default new PathUtil();","/* eslint-disable */\n\nimport PM_PRNG from 'prng-parkmiller-js';\nimport SimplexNoise from 'simplex-noise';\n\nconst rng1 = PM_PRNG.create(Date.now() * Math.random() * 100);\nconst rng2 = PM_PRNG.create(Date.now() * Math.random() * 100);\nconst gen1 = new SimplexNoise(rng1.nextDouble.bind(rng1));\nconst gen2 = new SimplexNoise(rng2.nextDouble.bind(rng2));\n\nfunction componentToHex(c) {\n\tconst hex = c.toString(16);\n\treturn hex.length == 1 ? \"0\" + hex : hex;\n}\n\nfunction rgbToHex(r, g, b) {\n\treturn \"0x\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\n}\n\nexport const Tools = {\n\n\tclamp: function (val, min, max) {\n\t\treturn Math.max(min, Math.min(max, val));\n\t},\n\n\tsign: function (val) {\n\t\treturn val && val / Math.abs(val);\n\t},\n\n\t/**\n\t * If one value is passed, it will return something from -val to val.\n\t * Else it returns a value between the range specified by min, max.\n\t */\n\trandom: function (min, max) {\n\t\tif (arguments.length === 1) {\n\t\t\treturn (Math.random() * min) - (min * 0.5);\n\t\t}\n\t\treturn Math.random() * (max - min) + min;\n\t},\n\n\tnoise1: function (nx, ny) { return gen1.noise2D(nx, ny) / 2 + 0.5; },\n\tnoise2: function (nx, ny) { return gen2.noise2D(nx, ny) / 2 + 0.5; },\n\n\n\t// from min to (and including) max\n\trandomInt: function (min, max) {\n\t\tif (arguments.length === 1) {\n\t\t\treturn (Math.random() * min) - (min * 0.5) | 0;\n\t\t}\n\t\treturn (Math.random() * (max - min + 1) + min) | 0;\n\t},\n\n\tnormalize: function (v, min, max) {\n\t\treturn (v - min) / (max - min);\n\t},\n\n\tgetShortRotation: function (angle) {\n\t\tangle %= this.TAU;\n\t\tif (angle > this.PI) {\n\t\t\tangle -= this.TAU;\n\t\t}\n\t\telse if (angle < -this.PI) {\n\t\t\tangle += this.TAU;\n\t\t}\n\t\treturn angle;\n\t},\n\n\tgenerateID: function () {\n\t\treturn Math.random().toString(36).slice(2) + Date.now();\n\t},\n\n\tisPlainObject: function (obj) {\n\t\tif (typeof (obj) !== 'object' || obj.nodeType || obj === obj.window) {\n\t\t\treturn false;\n\t\t}\n\t\t// The try/catch suppresses exceptions thrown when attempting to access the 'constructor' property of certain host objects, ie. |window.location|\n\t\t// https://bugzilla.mozilla.org/show_bug.cgi?id=814622\n\t\ttry {\n\t\t\tif (obj.constructor && !Object.prototype.hasOwnProperty.call(obj.constructor.prototype, 'isPrototypeOf')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tcatch (err) {\n\t\t\treturn false;\n\t\t}\n\t\t// If the function hasn't returned already, we're confident that\n\t\t// |obj| is a plain object, created by {} or constructed with new Object\n\t\treturn true;\n\t},\n\n\t// https://github.com/KyleAMathews/deepmerge/blob/master/index.js\n\tmerge: function (target, src) {\n\t\tconst self = this, array = Array.isArray(src);\n\t\tlet dst = array && [] || {};\n\t\tif (array) {\n\t\t\ttarget = target || [];\n\t\t\tdst = dst.concat(target);\n\t\t\tsrc.forEach(function (e, i) {\n\t\t\t\tif (typeof dst[i] === 'undefined') {\n\t\t\t\t\tdst[i] = e;\n\t\t\t\t}\n\t\t\t\telse if (self.isPlainObject(e)) {\n\t\t\t\t\tdst[i] = self.merge(target[i], e);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (target.indexOf(e) === -1) {\n\t\t\t\t\t\tdst.push(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn dst;\n\t\t}\n\t\tif (target && self.isPlainObject(target)) {\n\t\t\tObject.keys(target).forEach(function (key) {\n\t\t\t\tdst[key] = target[key];\n\t\t\t});\n\t\t}\n\t\tObject.keys(src).forEach(function (key) {\n\t\t\tif (!src[key] || !self.isPlainObject(src[key])) {\n\t\t\t\tdst[key] = src[key];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!target[key]) {\n\t\t\t\t\tdst[key] = src[key];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdst[key] = self.merge(target[key], src[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn dst;\n\t},\n\n\tnow: function () {\n\t\treturn window.nwf ? window.nwf.system.Performance.elapsedTime : window.performance.now();\n\t},\n\n\tempty: function (node) {\n\t\twhile (node.lastChild) {\n\t\t\tnode.removeChild(node.lastChild);\n\t\t}\n\t},\n\n\t/*\n\t\t@source: http://jsperf.com/radix-sort\n\t */\n\tradixSort: function (arr, idxBegin, idxEnd, bit) {\n\t\tidxBegin = idxBegin || 0;\n\t\tidxEnd = idxEnd || arr.length;\n\t\tbit = bit || 31;\n\t\tif (idxBegin >= (idxEnd - 1) || bit < 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet idx = idxBegin;\n\t\tlet idxOnes = idxEnd;\n\t\tconst mask = 0x1 << bit;\n\t\twhile (idx < idxOnes) {\n\t\t\tif (arr[idx] & mask) {\n\t\t\t\t--idxOnes;\n\t\t\t\tconst tmp = arr[idx];\n\t\t\t\tarr[idx] = arr[idxOnes];\n\t\t\t\tarr[idxOnes] = tmp;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t++idx;\n\t\t\t}\n\t\t}\n\t\tthis.radixSort(arr, idxBegin, idxOnes, bit - 1);\n\t\tthis.radixSort(arr, idxOnes, idxEnd, bit - 1);\n\t},\n\n\trandomizeRGB: function (base, range) {\n\t\tconst rgb = base.split(',');\n\t\tlet color = 'rgb(';\n\t\tlet i, c;\n\t\tconst rgb_ = [];\n\t\trange = this.randomInt(range);\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\tc = parseInt(rgb[i]) + range;\n\t\t\tif (c < 0) c = 0;\n\t\t\telse if (c > 255) c = 255;\n\t\t\tcolor += c + ',';\n\t\t\trgb_.push(c);\n\t\t}\n\t\tcolor = color.substring(0, color.length - 1);\n\t\tcolor += ')';\n\t\treturn color;\n\t},\n\n\tgetJSON: function (config) {\n\t\tconst xhr = new XMLHttpRequest();\n\t\tconst cache = typeof config.cache === 'undefined' ? false : config.cache;\n\t\tconst uri = cache ? config.url : config.url + '?t=' + Math.floor(Math.random() * 10000) + Date.now();\n\t\txhr.onreadystatechange = function () {\n\t\t\tif (this.status === 200) {\n\t\t\t\tlet json = null;\n\t\t\t\ttry {\n\t\t\t\t\tjson = JSON.parse(this.responseText);\n\t\t\t\t}\n\t\t\t\tcatch (err) {\n\t\t\t\t\t// console.warn('[Tools.getJSON] Error: '+config.url+' is not a json resource');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconfig.callback.call(config.scope || null, json);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if (this.status !== 0) {\n\t\t\t\tconsole.warn('[Tools.getJSON] Error: ' + this.status + ' (' + this.statusText + ') :: ' + config.url);\n\t\t\t}\n\t\t}\n\t\txhr.open('GET', uri, true);\n\t\txhr.setRequestHeader('Accept', 'application/json');\n\t\txhr.setRequestHeader('Content-Type', 'application/json');\n\t\txhr.send('');\n\t}\n}\n\nexport default Tools;","import PathUtil from './PathUtil';\nimport { PathfinderSettings, heuristic } from '../utils/Interfaces';\nimport LinkedList from '../lib/LinkedList';\nimport Tools from '../utils/Tools';\nimport Cell from '../grids/Cell';\nimport { GridInterface } from '../grids/Grid';\n/*\n\tA* path-finder based upon http://www.redblobgames.com/pathfinding/a-star/introduction.html\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\n// 'utils/Tools', 'lib/LinkedList'\n\nexport default class AStarFinder {\n\tpublic allowDiagonal: boolean;\n\tpublic heuristicFilter: heuristic;\n\tpublic list: LinkedList;\n\n\tconstructor(finderConfig?: PathfinderSettings) {\n\t\tlet settings = {\n\t\t\tallowDiagonal: false,\n\t\t\theuristicFilter: null as heuristic,\n\t\t} as PathfinderSettings;\n\t\tif (finderConfig)\n\t\t\tsettings = Tools.merge(settings, finderConfig) as PathfinderSettings;\n\n\t\tthis.allowDiagonal = settings.allowDiagonal;\n\t\tthis.heuristicFilter = settings.heuristicFilter;\n\n\t\tthis.list = new LinkedList();\n\t}\n\t/*\n\t\t  Find and return the path.\n\t\t  @return Array<Cell> The path, including both start and end positions. Null if it failed.\n\t   */\n\tfindPath(startNode: Cell, endNode: Cell, heuristic: heuristic, grid: GridInterface): Cell[][] {\n\t\tlet current, costSoFar, neighbors, n, i, l;\n\t\theuristic = heuristic || this.heuristicFilter;\n\t\t// clear old values from previous finding\n\t\tgrid.clearPath();\n\t\tthis.list.clear();\n\n\t\t// push the start current into the open list\n\t\tthis.list.add(startNode);\n\n\t\t// while the open list is not empty\n\t\twhile (this.list.length > 0) {\n\t\t\t// sort so lowest cost is first\n\t\t\tthis.list.sort(this.compare);\n\n\t\t\t// pop the position of current which has the minimum `_calcCost` value.\n\t\t\tcurrent = this.list.shift().obj;\n\t\t\tcurrent._visited = true;\n\n\t\t\t// if reached the end position, construct the path and return it\n\t\t\tif (current === endNode) {\n\t\t\t\treturn PathUtil.backtrace(endNode);\n\t\t\t}\n\n\t\t\t// cycle through each neighbor of the current current\n\t\t\tneighbors = grid.getNeighbors(current, this.allowDiagonal, heuristic);\n\t\t\tfor (i = 0, l = neighbors.length; i < l; i++) {\n\t\t\t\tn = neighbors[i];\n\n\t\t\t\tif (!n.walkable) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tcostSoFar = current._calcCost + grid.distance(current, n);\n\n\t\t\t\t// check if the neighbor has not been inspected yet, or can be reached with smaller cost from the current node\n\t\t\t\tif (!n._visited || costSoFar < n._calcCost) {\n\t\t\t\t\tn._visited = true;\n\t\t\t\t\tn._parent = current;\n\t\t\t\t\tn._calcCost = costSoFar;\n\t\t\t\t\t// console.log(n);\n\t\t\t\t\t// _priority is the most important property, since it makes the algorithm \"greedy\" and seek the goal.\n\t\t\t\t\t// otherwise it behaves like a brushfire/breadth-first\n\t\t\t\t\tn._priority = costSoFar + grid.distance(endNode, n);\n\n\t\t\t\t\t// check neighbor if it's the end current as well--often cuts steps by a significant amount\n\t\t\t\t\tif (n === endNode) {\n\t\t\t\t\t\treturn PathUtil.backtrace(endNode);\n\t\t\t\t\t}\n\t\t\t\t\t// console.log(n);\n\t\t\t\t\tthis.list.add(n);\n\t\t\t\t}\n\t\t\t\t// console.log(this.list);\n\t\t\t} // end for each neighbor\n\t\t} // end while not open list empty\n\t\t// failed to find the path\n\t\treturn null;\n\t}\n\n\tcompare(nodeA: Cell, nodeB: Cell): number {\n\t\treturn nodeA._priority - nodeB._priority;\n\t}\n}","import * as THREE from 'three';\n\nconst Loader = {\n\tmanager: null,\n\timageLoader: null,\n\tcrossOrigin: false,\n\n\tinit: function (crossOrigin) {\n\t\tthis.crossOrigin = crossOrigin || false;\n\n\t\tthis.manager = new THREE.LoadingManager(function () {\n\t\t\t// called when all images are loaded, so call your state manager or something\n\t\t}, function () {\n\t\t\t// noop\n\t\t}, function () {\n\t\t\tconsole.warn('Error loading images');\n\t\t});\n\n\t\tthis.imageLoader = new THREE.ImageLoader(this.manager);\n\t\tthis.imageLoader.crossOrigin = crossOrigin;\n\t},\n\n\tloadTexture: function (url, mapping, onLoad, onError) {\n\t\tconst texture = new THREE.Texture(null, mapping);\n\t\tthis.imageLoader.load(url, function (image) { // on load\n\t\t\ttexture.image = image;\n\t\t\ttexture.needsUpdate = true;\n\t\t\tif (onLoad) onLoad(texture);\n\t\t},\n\t\t\tnull, // on progress\n\t\t\tfunction (evt) { // on error\n\t\t\t\tif (onError) onError(evt);\n\t\t\t});\n\t\ttexture.sourceFile = url;\n\n\t\treturn texture;\n\t}\n}\n\nexport default Loader;","/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport Engine from '../Engine';\nimport * as THREE from 'three';\nimport Tile from '../grids/Tile';\nimport { Intersection, Vector3, Vector2, Camera, Raycaster, Object3D } from 'three';\nimport Signal from '../lib/Signal';\n/*\n\tTranslates mouse interactivity into 3D positions, so we can easily pick objects in the scene.\n\n\tLike everything else in ThreeJS, ray casting creates a ton of new objects each time it's used. This contributes to frequent garbage collections (causing frame hitches), so if you're limited to low-end hardware like mobile, it would be better to only update it when the user clicks, instead of every frame (so no hover effects, but on mobile those don't work anyway). You'll want to create a version that handles touch anyway.\n\n\tgroup - any Object3D (Scene, Group, Mesh, Sprite, etc) that the mouse will cast against\n\tcamera - the camera to cast from\n\t[element] - optional element to attach mouse event to\n\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\nclass MouseCaster {\n\n\tstatic OVER: string;\n\tstatic OUT: string;\n\tstatic DOWN: string;\n\tstatic UP: string;\n\tstatic CLICK: string; // only fires if the user clicked down and up while on the same object\n\tstatic WHEEL: string;\n\tstatic MOVE: string;\n\n\tpublic down: boolean;\n\tpublic rightDown: boolean;\n\tpublic pickedObject: Tile;\n\tpublic selectedObject: Tile;\n\tpublic allHits: Intersection[];\n\tpublic active: boolean;\n\tpublic shift: boolean;\n\tpublic ctrl: boolean;\n\tpublic wheel: number;\n\n\tpublic position: Vector3;\n\tpublic screenPosition: Vector2;\n\tpublic signal: Signal;\n\tpublic group: Object3D;\n\n\tprivate _camera: Camera;\n\tprivate _raycaster: Raycaster;\n\tprivate _preventDefault: boolean;\n\tpublic element: HTMLElement | Document;\n\n\tconstructor(group: Object3D, camera: Camera, element?: HTMLElement) {\n\t\tthis.down = false; // left click\n\t\tthis.rightDown = false;\n\t\t// the object that was just clicked on\n\t\tthis.pickedObject = null;\n\t\t// the object currently being 'held'\n\t\tthis.selectedObject = null;\n\t\t// store the results of the last cast\n\t\tthis.allHits = null;\n\t\t// disable the caster easily to temporarily prevent user input\n\t\tthis.active = true;\n\n\t\tthis.shift = false;\n\t\tthis.ctrl = false;\n\t\tthis.wheel = 0;\n\n\t\t// you can track exactly where the mouse is in the 3D scene by using the z component\n\t\tthis.position = new THREE.Vector3();\n\t\tthis.screenPosition = new THREE.Vector2();\n\t\tthis.signal = new Engine.Signal();\n\t\tthis.group = group;\n\n\t\t// behind-the-scenes stuff you shouldn't worry about\n\t\tthis._camera = camera;\n\t\tthis._raycaster = new THREE.Raycaster();\n\t\tthis._preventDefault = false;\n\n\t\tthis.element = element || document;\n\n\t\tthis.element.addEventListener('mousemove', this._onDocumentMouseMove.bind(this), false);\n\t\tthis.element.addEventListener('mousedown', this._onDocumentMouseDown.bind(this), false);\n\t\tthis.element.addEventListener('mouseup', this._onDocumentMouseUp.bind(this), false);\n\t\tthis.element.addEventListener('mousewheel', this._onMouseWheel.bind(this), false);\n\t\tthis.element.addEventListener('DOMMouseScroll', this._onMouseWheel.bind(this), false); // firefox\n\t\tthis.element.addEventListener(\"touchstart\", (e: Event | TouchEvent) => {\n\t\t\tthis._onDocumentMouseDown((e as TouchEvent).touches[0])\n\t\t\t//e.preventDefault()\n\t\t}, false)\n\t\tthis.element.addEventListener(\"touchmove\", (e: Event | TouchEvent) => {\n\t\t\tthis._onDocumentMouseDown((e as TouchEvent).touches[0])\n\t\t\t//e.preventDefault()\n\t\t}, false)\n\t\tthis.element.addEventListener(\"touchend\", (e) => this._onDocumentMouseUp((e as TouchEvent).touches[0] || (e as TouchEvent).changedTouches[0]), false)\n\t}\n\tdispose(ctx: any) {\n\t\tthis.signal.removeAll(ctx);\n\t\tthis.element.removeEventListener('mousemove', this._onDocumentMouseDown, false);\n\t\tthis.element.removeEventListener('touchmove', this._onDocumentMouseMove, false);\n\t\tthis.element.removeEventListener('mousedown', this._onDocumentMouseDown, false);\n\t\tthis.element.removeEventListener('touchstart', this._onDocumentMouseDown, false);\n\t\tthis.element.removeEventListener('mouseup', this._onDocumentMouseUp, false);\n\t\tthis.element.removeEventListener('touchend', this._onDocumentMouseUp, false);\n\t\tthis.element.removeEventListener('mousewheel', this._onMouseWheel, false);\n\t\tthis.element.removeEventListener('DOMMouseScroll', this._onMouseWheel, false); // firefox\n\t}\n\tupdate() {\n\t\tif (!this.active) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst intersects = this.rayCast();\n\t\tlet hit, obj;\n\n\t\tif (intersects.length > 0) {\n\t\t\t// get the first object under the mouse\n\t\t\thit = intersects[0];\n\t\t\tobj = hit.object.userData.structure;\n\t\t\tif (this.pickedObject !== obj) {\n\t\t\t\t// the first object changed, meaning there's a different one, or none at all\n\t\t\t\tif (this.pickedObject) {\n\t\t\t\t\t// it's a new object, notify the old object is going away\n\t\t\t\t\tthis.signal.dispatch('out', this.pickedObject);\n\t\t\t\t}\n\t\t\t\t/*else {\n\t\t\t\t  // hit a new object when nothing was there previously\n\t\t\t\t}*/\n\t\t\t\tthis.pickedObject = obj;\n\t\t\t\tthis.selectedObject = null; // cancel click, otherwise it'll confuse the user\n\n\t\t\t\tthis.signal.dispatch('over', this.pickedObject);\n\t\t\t}\n\t\t\tthis.position.copy(hit.point);\n\t\t\t(this.screenPosition as any).z = hit.distance;\n\t\t}\n\t\telse {\n\t\t\t// there isn't anything under the mouse\n\t\t\tif (this.pickedObject) {\n\t\t\t\t// there was though, we just moved out\n\t\t\t\tthis.signal.dispatch('out', this.pickedObject);\n\t\t\t}\n\t\t\tthis.pickedObject = null;\n\t\t\tthis.selectedObject = null;\n\t\t}\n\n\t\tthis.allHits = intersects;\n\t}\n\n\tpreventDefault() {\n\t\tthis._preventDefault = true;\n\t}\n\n\t_onDocumentMouseDown(evt: any) {\n\t\tevt = evt || window.event;\n\t\tevt.preventDefault();\n\t\tif (this._preventDefault) {\n\t\t\tthis._preventDefault = false;\n\t\t\treturn false;\n\t\t}\n\t\tif (this.pickedObject) {\n\t\t\tthis.selectedObject = this.pickedObject;\n\t\t}\n\t\tthis.shift = evt.shiftKey;\n\t\tthis.ctrl = evt.ctrlKey;\n\n\t\tthis.down = evt.which === 1;\n\t\tthis.rightDown = evt.which === 3;\n\n\t\tthis.signal.dispatch('down', this.pickedObject);\n\t}\n\n\t_onDocumentMouseUp(evt: any) {\n\t\tevt.preventDefault();\n\t\tif (this._preventDefault) {\n\t\t\tthis._preventDefault = false;\n\t\t\treturn false;\n\t\t}\n\t\tthis.shift = evt.shiftKey;\n\t\tthis.ctrl = evt.ctrlKey;\n\n\t\tthis.signal.dispatch('up', this.pickedObject);\n\t\tif (this.selectedObject && this.pickedObject && this.selectedObject.uniqueID === this.pickedObject.uniqueID) {\n\t\t\tthis.signal.dispatch('click', this.pickedObject);\n\t\t}\n\n\t\tthis.down = evt.which === 1 ? false : this.down;\n\t\tthis.rightDown = evt.which === 3 ? false : this.rightDown;\n\t}\n\n\t_onDocumentMouseMove(evt: any) {\n\t\tevt.preventDefault();\n\t\tthis.screenPosition.x = (evt.clientX / window.innerWidth) * 2 - 1;\n\t\tthis.screenPosition.y = -(evt.clientY / window.innerHeight) * 2 + 1;\n\t\tthis.signal.dispatch('move', evt);\n\t}\n\n\t_onMouseWheel(evt: any) {\n\t\tif (!this.active) {\n\t\t\treturn;\n\t\t}\n\t\t//evt.preventDefault();\n\t\tevt.stopPropagation();\n\n\t\tlet delta = 0;\n\t\tif (evt.wheelDelta !== undefined) { // WebKit / Opera / Explorer 9\n\t\t\tdelta = evt.wheelDelta;\n\t\t}\n\t\telse if (evt.detail !== undefined) { // Firefox\n\t\t\tdelta = -evt.detail;\n\t\t}\n\t\tif (delta > 0) {\n\t\t\tthis.wheel++;\n\t\t}\n\t\telse {\n\t\t\tthis.wheel--;\n\t\t}\n\t\tthis.signal.dispatch('wheel', this.wheel);\n\t}\n\trayCast() {\n\t\tthis._raycaster.setFromCamera(this.screenPosition, this._camera);\n\t\tconst intersects = this._raycaster.intersectObject(this.group, true);\n\t\treturn intersects;\n\t}\n}\n\nMouseCaster.OVER = 'over';\nMouseCaster.OUT = 'out';\nMouseCaster.DOWN = 'down';\nMouseCaster.UP = 'up';\nMouseCaster.CLICK = 'click'; // only fires if the user clicked down and up while on the same object\nMouseCaster.WHEEL = 'wheel';\nMouseCaster.MOVE = 'move';\n\nexport default MouseCaster;","/* eslint-disable */\n/**\n * @author qiao / https://github.com/qiao\n * @author mrdoob / http://mrdoob.com\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author erich666 / http://erichaines.com\n * @author ScieCode / http://github.com/sciecode\n */\n\nimport {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tSpherical,\n\tTOUCH,\n\tVector2,\n\tVector3\n} from 'three';\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst OrbitControls = function (object, domElement, view) {\n\n\tthis.object = object;\n\tthis.view = view;\n\tthis.domElement = (domElement !== undefined) ? domElement : document;\n\n\t// Set to false to disable this control\n\tthis.enabled = true;\n\n\t// \"target\" sets the location of focus, where the object orbits around\n\tthis.target = new Vector3();\n\n\t// How far you can dolly in and out ( PerspectiveCamera only )\n\tthis.minDistance = 0;\n\tthis.maxDistance = Infinity;\n\n\t// How far you can zoom in and out ( OrthographicCamera only )\n\tthis.minZoom = 0;\n\tthis.maxZoom = Infinity;\n\n\t// How far you can orbit vertically, upper and lower limits.\n\t// Range is 0 to Math.PI radians.\n\tthis.minPolarAngle = 0; // radians\n\tthis.maxPolarAngle = Math.PI; // radians\n\n\t// How far you can orbit horizontally, upper and lower limits.\n\t// If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\n\tthis.minAzimuthAngle = - Infinity; // radians\n\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t// Set to true to enable damping (inertia)\n\t// If damping is enabled, you must call controls.update() in your animation loop\n\tthis.enableDamping = false;\n\tthis.dampingFactor = 0.05;\n\n\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t// Set to false to disable zooming\n\tthis.enableZoom = true;\n\tthis.zoomSpeed = 1.0;\n\n\t// Set to false to disable rotating\n\tthis.enableRotate = true;\n\tthis.rotateSpeed = 1.0;\n\n\t// Set to false to disable panning\n\tthis.enablePan = true;\n\tthis.panSpeed = 1.0;\n\tthis.screenSpacePanning = false; // if true, pan in screen-space\n\tthis.keyPanSpeed = 10.0;\t// pixels moved per arrow key push\n\n\t// Set to true to automatically rotate around the target\n\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\tthis.autoRotate = false;\n\tthis.autoRotateSpeed = 1.0; // 30 seconds per round when fps is 60\n\n\t// Set to false to disable use of the keys\n\tthis.enableKeys = true;\n\n\t// The four arrow keys\n\tthis.keys = { LEFT: 65, UP: 87, RIGHT: 68, BOTTOM: 83 };\n\n\t// Mouse buttons\n\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t// Touch fingers\n\tthis.touches = { ONE: TOUCH.DOLLY_PAN, TWO: TOUCH.ROTATE };\n\n\t// for reset\n\tthis.target0 = this.target.clone();\n\tthis.position0 = this.object.position.clone();\n\tthis.zoom0 = this.object.zoom;\n\n\t//\n\t// public methods\n\t//\n\n\tthis.getPolarAngle = function () {\n\n\t\treturn spherical.phi;\n\n\t};\n\n\tthis.getAzimuthalAngle = function () {\n\n\t\treturn spherical.theta;\n\n\t};\n\n\tthis.saveState = function () {\n\n\t\tscope.target0.copy(scope.target);\n\t\tscope.position0.copy(scope.object.position);\n\t\tscope.zoom0 = scope.object.zoom;\n\n\t};\n\n\tthis.reset = function () {\n\n\t\tscope.target.copy(scope.target0);\n\t\tscope.object.position.copy(scope.position0);\n\t\tscope.object.zoom = scope.zoom0;\n\n\t\tscope.object.updateProjectionMatrix();\n\t\tscope.dispatchEvent(changeEvent);\n\n\t\tscope.update();\n\n\t\tstate = STATE.NONE;\n\n\t};\n\n\tthis.setZoom = (bool) => {\n\t\tconsole.log('set zoom');\n\t\tscope.enableZoom = bool\n\t\tif (scope.enableZoom) {\n\t\t\tscope.domElement.addEventListener('wheel', onMouseWheel, false);\n\t\t} else {\n\t\t\tconsole.log(scope.domElement);\n\t\t\tscope.domElement.removeEventListener('wheel', onMouseWheel, false);\n\t\t}\n\t}\n\n\t// this method is exposed, but perhaps it would be better if we can make it private...\n\tthis.update = function () {\n\n\t\tvar offset = new Vector3();\n\n\t\t// so camera.up is the orbit axis\n\t\tvar quat = new Quaternion().setFromUnitVectors(object.up, new Vector3(0, 1, 0));\n\t\tvar quatInverse = quat.clone().inverse();\n\n\t\tvar lastPosition = new Vector3();\n\t\tvar lastQuaternion = new Quaternion();\n\n\t\treturn function update() {\n\n\t\t\tvar position = scope.object.position;\n\n\t\t\toffset.copy(position).sub(scope.target);\n\n\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\toffset.applyQuaternion(quat);\n\n\t\t\t// angle from z-axis around y-axis\n\t\t\tspherical.setFromVector3(offset);\n\n\t\t\tif (scope.autoRotate && state === STATE.NONE) {\n\n\t\t\t\trotateLeft(getAutoRotationAngle());\n\n\t\t\t}\n\n\t\t\tif (scope.enableDamping) {\n\n\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\n\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\n\n\t\t\t} else {\n\n\t\t\t\tspherical.theta += sphericalDelta.theta;\n\t\t\t\tspherical.phi += sphericalDelta.phi;\n\n\t\t\t}\n\n\t\t\t// restrict theta to be between desired limits\n\t\t\tspherical.theta = Math.max(scope.minAzimuthAngle, Math.min(scope.maxAzimuthAngle, spherical.theta));\n\n\t\t\t// restrict phi to be between desired limits\n\t\t\tspherical.phi = Math.max(scope.minPolarAngle, Math.min(scope.maxPolarAngle, spherical.phi));\n\n\t\t\tspherical.makeSafe();\n\n\n\t\t\tspherical.radius *= scale;\n\n\t\t\t// restrict radius to be between desired limits\n\t\t\tspherical.radius = Math.max(scope.minDistance, Math.min(scope.maxDistance, spherical.radius));\n\n\t\t\t// move target to panned location\n\n\t\t\tif (scope.enableDamping === true) {\n\n\t\t\t\tscope.target.addScaledVector(panOffset, scope.dampingFactor);\n\n\t\t\t} else {\n\n\t\t\t\tscope.target.add(panOffset);\n\n\t\t\t}\n\n\t\t\toffset.setFromSpherical(spherical);\n\n\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\toffset.applyQuaternion(quatInverse);\n\n\t\t\tposition.copy(scope.target).add(offset);\n\n\t\t\tscope.object.lookAt(scope.target);\n\n\t\t\tif (scope.enableDamping === true) {\n\n\t\t\t\tsphericalDelta.theta *= (1 - scope.dampingFactor);\n\t\t\t\tsphericalDelta.phi *= (1 - scope.dampingFactor);\n\n\t\t\t\tpanOffset.multiplyScalar(1 - scope.dampingFactor);\n\n\t\t\t} else {\n\n\t\t\t\tsphericalDelta.set(0, 0, 0);\n\n\t\t\t\tpanOffset.set(0, 0, 0);\n\n\t\t\t}\n\n\t\t\tscale = 1;\n\n\t\t\t// update condition is:\n\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\tif (zoomChanged ||\n\t\t\t\tlastPosition.distanceToSquared(scope.object.position) > EPS ||\n\t\t\t\t8 * (1 - lastQuaternion.dot(scope.object.quaternion)) > EPS) {\n\n\t\t\t\tscope.dispatchEvent(changeEvent);\n\n\t\t\t\tlastPosition.copy(scope.object.position);\n\t\t\t\tlastQuaternion.copy(scope.object.quaternion);\n\t\t\t\tzoomChanged = false;\n\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t\treturn false;\n\n\t\t};\n\n\t}();\n\n\tthis.dispose = function () {\n\n\t\tscope.domElement.removeEventListener('contextmenu', onContextMenu, false);\n\t\tscope.domElement.removeEventListener('mousedown', onMouseDown, false);\n\t\tscope.domElement.removeEventListener('wheel', onMouseWheel, false);\n\n\t\tscope.domElement.removeEventListener('touchstart', onTouchStart, false);\n\t\tscope.domElement.removeEventListener('touchend', onTouchEnd, false);\n\t\tscope.domElement.removeEventListener('touchmove', onTouchMove, false);\n\n\t\tdocument.removeEventListener('mousemove', onMouseMove, false);\n\t\tdocument.removeEventListener('mouseup', onMouseUp, false);\n\n\t\twindow.removeEventListener('keydown', onKeyDown, false);\n\n\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n\t};\n\tthis.rotateUp = rotateUp;\n\n\t//\n\t// internals\n\t//\n\n\tvar scope = this;\n\n\tvar changeEvent = { type: 'change' };\n\tvar startEvent = { type: 'start' };\n\tvar endEvent = { type: 'end' };\n\n\tvar STATE = {\n\t\tNONE: - 1,\n\t\tROTATE: 0,\n\t\tDOLLY: 1,\n\t\tPAN: 2,\n\t\tTOUCH_ROTATE: 3,\n\t\tTOUCH_PAN: 4,\n\t\tTOUCH_DOLLY_PAN: 5,\n\t\tTOUCH_DOLLY_ROTATE: 6\n\t};\n\n\tvar state = STATE.NONE;\n\n\tvar EPS = 0.000001;\n\n\t// current position in spherical coordinates\n\tvar spherical = new Spherical();\n\tvar sphericalDelta = new Spherical();\n\n\tvar scale = 1;\n\tvar panOffset = new Vector3();\n\tvar zoomChanged = false;\n\n\tvar rotateStart = new Vector2();\n\tvar rotateEnd = new Vector2();\n\tvar rotateDelta = new Vector2();\n\n\tvar panStart = new Vector2();\n\tvar panEnd = new Vector2();\n\tvar panDelta = new Vector2();\n\n\tvar dollyStart = new Vector2();\n\tvar dollyEnd = new Vector2();\n\tvar dollyDelta = new Vector2();\n\n\tfunction getAutoRotationAngle() {\n\n\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t}\n\n\tfunction getZoomScale() {\n\n\t\treturn Math.pow(0.95, scope.zoomSpeed);\n\n\t}\n\n\tfunction rotateLeft(angle) {\n\n\t\tsphericalDelta.theta -= angle;\n\n\t}\n\n\tfunction rotateUp(angle) {\n\n\t\tsphericalDelta.phi -= angle;\n\n\t}\n\n\tvar panLeft = function () {\n\n\t\tvar v = new Vector3();\n\n\t\treturn function panLeft(distance, objectMatrix) {\n\n\t\t\tv.setFromMatrixColumn(objectMatrix, 0); // get X column of objectMatrix\n\t\t\tv.multiplyScalar(- distance);\n\n\t\t\tpanOffset.add(v);\n\n\t\t};\n\n\t}();\n\n\tvar panUp = function () {\n\n\t\tvar v = new Vector3();\n\n\t\treturn function panUp(distance, objectMatrix) {\n\n\t\t\tif (scope.screenSpacePanning === true) {\n\n\t\t\t\tv.setFromMatrixColumn(objectMatrix, 1);\n\n\t\t\t} else {\n\n\t\t\t\tv.setFromMatrixColumn(objectMatrix, 0);\n\t\t\t\tv.crossVectors(scope.object.up, v);\n\n\t\t\t}\n\n\t\t\tv.multiplyScalar(distance);\n\n\t\t\tpanOffset.add(v);\n\n\t\t};\n\n\t}();\n\n\t// deltaX and deltaY are in pixels; right and down are positive\n\tthis.pan = function () {\n\n\t\tvar offset = new Vector3();\n\n\t\treturn function pan(deltaX, deltaY) {\n\n\t\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\t\tif (scope.object.isPerspectiveCamera) {\n\n\t\t\t\t// perspective\n\t\t\t\tvar position = scope.object.position;\n\t\t\t\toffset.copy(position).sub(scope.target);\n\t\t\t\tvar targetDistance = offset.length();\n\n\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\ttargetDistance *= Math.tan((scope.object.fov / 2) * Math.PI / 180.0);\n\n\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\tpanLeft(2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix);\n\t\t\t\tpanUp(2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix);\n\n\t\t\t} else if (scope.object.isOrthographicCamera) {\n\n\t\t\t\t// orthographic\n\t\t\t\tpanLeft(deltaX * (scope.object.right - scope.object.left) / scope.object.zoom / element.clientWidth, scope.object.matrix);\n\t\t\t\tpanUp(deltaY * (scope.object.top - scope.object.bottom) / scope.object.zoom / element.clientHeight, scope.object.matrix);\n\n\t\t\t} else {\n\n\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\tconsole.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.');\n\t\t\t\tscope.enablePan = false;\n\n\t\t\t}\n\n\t\t};\n\n\t}();\n\n\tfunction dollyIn(dollyScale) {\n\n\t\tif (scope.object.isPerspectiveCamera) {\n\n\t\t\tscale /= dollyScale;\n\n\t\t} else if (scope.object.isOrthographicCamera) {\n\n\t\t\tscope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom * dollyScale));\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tzoomChanged = true;\n\n\t\t} else {\n\n\t\t\tconsole.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n\t\t\tscope.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\tfunction dollyOut(dollyScale) {\n\n\t\tif (scope.object.isPerspectiveCamera) {\n\n\t\t\tscale *= dollyScale;\n\n\t\t} else if (scope.object.isOrthographicCamera) {\n\n\t\t\tscope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom / dollyScale));\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tzoomChanged = true;\n\n\t\t} else {\n\n\t\t\tconsole.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n\t\t\tscope.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\t//\n\t// event callbacks - update the object state\n\t//\n\n\tfunction handleMouseDownRotate(event) {\n\n\t\trotateStart.set(event.clientX, event.clientY);\n\n\t}\n\n\tfunction handleMouseDownDolly(event) {\n\n\t\tdollyStart.set(event.clientX, event.clientY);\n\n\t}\n\n\tfunction handleMouseDownPan(event) {\n\n\t\tpanStart.set(event.clientX, event.clientY);\n\n\t}\n\n\tfunction handleMouseMoveRotate(event) {\n\n\t\trotateEnd.set(event.clientX, event.clientY);\n\n\t\trotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\n\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\trotateLeft(2 * Math.PI * rotateDelta.x / element.clientHeight); // yes, height\n\n\t\trotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight);\n\n\t\trotateStart.copy(rotateEnd);\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseMoveDolly(event) {\n\n\t\tdollyEnd.set(event.clientX, event.clientY);\n\n\t\tdollyDelta.subVectors(dollyEnd, dollyStart);\n\n\t\tif (dollyDelta.y > 0) {\n\n\t\t\tdollyIn(getZoomScale());\n\n\t\t} else if (dollyDelta.y < 0) {\n\n\t\t\tdollyOut(getZoomScale());\n\n\t\t}\n\n\t\tdollyStart.copy(dollyEnd);\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseMovePan(event) {\n\t\twhile (scope.view.animationManager.animations.length >= 1) {\n\t\t\tscope.view.animationManager.cancelAnimation();\n\t\t}\n\n\t\tpanEnd.set(event.clientX, event.clientY);\n\n\t\tpanDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\n\n\t\tscope.pan(panDelta.x, panDelta.y);\n\n\t\tconst cell = scope.view.map.grid.pixelToCell(scope.object.position);\n\t\tconst t = scope.view.map.getTileAtCell(cell);\n\t\tif (!t) scope.pan(-panDelta.x, -panDelta.y);\n\n\t\tpanStart.copy(panEnd);\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleMouseUp( /*event*/) {\n\n\t\t// no-op\n\n\t}\n\n\tfunction handleMouseWheel(event) {\n\n\t\tif (event.deltaY < 0) {\n\n\t\t\tdollyOut(getZoomScale());\n\n\t\t} else if (event.deltaY > 0) {\n\n\t\t\tdollyIn(getZoomScale());\n\n\t\t}\n\n\t\tscope.update();\n\n\t}\n\n\tfunction handleKeyDown(event) {\n\n\t\tvar needsUpdate = false;\n\n\t\tswitch (event.keyCode) {\n\n\t\t\tcase scope.keys.UP:\n\t\t\t\tscope.pan(0, scope.keyPanSpeed);\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.BOTTOM:\n\t\t\t\tscope.pan(0, - scope.keyPanSpeed);\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.LEFT:\n\t\t\t\tscope.pan(scope.keyPanSpeed, 0);\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.RIGHT:\n\t\t\t\tscope.pan(- scope.keyPanSpeed, 0);\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif (needsUpdate) {\n\n\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\tevent.preventDefault();\n\n\t\t\tscope.update();\n\n\t\t}\n\n\n\t}\n\n\tfunction handleTouchStartRotate(event) {\n\n\t\tif (event.touches.length == 1) {\n\n\t\t\trotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\n\t\t\tvar y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\n\n\t\t\trotateStart.set(x, y);\n\n\t\t}\n\n\t}\n\n\tfunction handleTouchStartPan(event) {\n\n\t\tif (event.touches.length == 1) {\n\n\t\t\tpanStart.set(event.touches[0].pageX, event.touches[0].pageY);\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\n\t\t\tvar y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\n\n\t\t\tpanStart.set(x, y);\n\n\t\t}\n\n\t}\n\n\tfunction handleTouchStartDolly(event) {\n\n\t\tvar dx = event.touches[0].pageX - event.touches[1].pageX;\n\t\tvar dy = event.touches[0].pageY - event.touches[1].pageY;\n\n\t\tvar distance = Math.sqrt(dx * dx + dy * dy);\n\n\t\tdollyStart.set(0, distance);\n\n\t}\n\n\tfunction handleTouchStartDollyPan(event) {\n\n\t\tif (scope.enableZoom) handleTouchStartDolly(event);\n\n\t\tif (scope.enablePan) handleTouchStartPan(event);\n\n\t}\n\n\tfunction handleTouchStartDollyRotate(event) {\n\n\t\tif (scope.enableZoom) handleTouchStartDolly(event);\n\n\t\tif (scope.enableRotate) handleTouchStartRotate(event);\n\n\t}\n\n\tfunction handleTouchMoveRotate(event) {\n\n\t\tif (event.touches.length == 1) {\n\n\t\t\trotateEnd.set(event.touches[0].pageX, event.touches[0].pageY);\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\n\t\t\tvar y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\n\n\t\t\trotateEnd.set(x, y);\n\n\t\t}\n\n\t\trotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\n\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\trotateLeft(2 * Math.PI * rotateDelta.x / element.clientHeight); // yes, height\n\n\t\trotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight);\n\n\t\trotateStart.copy(rotateEnd);\n\n\t}\n\n\tfunction handleTouchMovePan(event) {\n\n\t\tif (event.touches.length == 1) {\n\n\t\t\tpanEnd.set(event.touches[0].pageX, event.touches[0].pageY);\n\n\t\t} else {\n\n\t\t\tvar x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\n\t\t\tvar y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\n\n\t\t\tpanEnd.set(x, y);\n\n\t\t}\n\n\t\tpanDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\n\n\t\tscope.pan(panDelta.x, panDelta.y);\n\n\t\tpanStart.copy(panEnd);\n\n\t}\n\n\tfunction handleTouchMoveDolly(event) {\n\n\t\tvar dx = event.touches[0].pageX - event.touches[1].pageX;\n\t\tvar dy = event.touches[0].pageY - event.touches[1].pageY;\n\n\t\tvar distance = Math.sqrt(dx * dx + dy * dy);\n\n\t\tdollyEnd.set(0, distance);\n\n\t\tdollyDelta.set(0, Math.pow(dollyEnd.y / dollyStart.y, scope.zoomSpeed));\n\n\t\tdollyIn(dollyDelta.y);\n\n\t\tdollyStart.copy(dollyEnd);\n\n\t}\n\n\tfunction handleTouchMoveDollyPan(event) {\n\n\t\tif (scope.enableZoom) handleTouchMoveDolly(event);\n\n\t\tif (scope.enablePan) handleTouchMovePan(event);\n\n\t}\n\n\tfunction handleTouchMoveDollyRotate(event) {\n\n\t\tif (scope.enableZoom) handleTouchMoveDolly(event);\n\n\t\tif (scope.enableRotate) handleTouchMoveRotate(event);\n\n\t}\n\n\tfunction handleTouchEnd( /*event*/) {\n\n\t\t// no-op\n\n\t}\n\n\t//\n\t// event handlers - FSM: listen for events and reset state\n\t//\n\n\tfunction onMouseDown(event) {\n\n\t\tif (scope.enabled === false) return;\n\n\t\t// Prevent the browser from scrolling.\n\n\t\tevent.preventDefault();\n\n\t\t// Manually set the focus since calling preventDefault above\n\t\t// prevents the browser from setting it automatically.\n\n\t\tscope.domElement.focus ? scope.domElement.focus() : window.focus();\n\n\t\tswitch (event.button) {\n\n\t\t\tcase 0:\n\n\t\t\t\tswitch (scope.mouseButtons.LEFT) {\n\n\t\t\t\t\tcase MOUSE.ROTATE:\n\n\t\t\t\t\t\tif (event.ctrlKey || event.metaKey || event.shiftKey) {\n\n\t\t\t\t\t\t\tif (scope.enablePan === false) return;\n\t\t\t\t\t\t\tif (scope.view._mouseCaster.pickedObject === null) return;\n\n\t\t\t\t\t\t\twhile (scope.view.animationManager.animations.length >= 1) {\n\t\t\t\t\t\t\t\tscope.view.animationManager.cancelAnimation();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\thandleMouseDownPan(event);\n\n\t\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tif (scope.enableRotate === false) return;\n\n\t\t\t\t\t\t\thandleMouseDownRotate(event);\n\n\t\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MOUSE.PAN:\n\n\t\t\t\t\t\tif (event.ctrlKey || event.metaKey || event.shiftKey) {\n\n\t\t\t\t\t\t\tif (scope.enableRotate === false) return;\n\n\t\t\t\t\t\t\thandleMouseDownRotate(event);\n\n\t\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tif (scope.enablePan === false) return;\n\t\t\t\t\t\t\tif (scope.view._mouseCaster.pickedObject === null) return;\n\n\t\t\t\t\t\t\thandleMouseDownPan(event);\n\n\t\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\n\t\t\tcase 1:\n\n\t\t\t\tswitch (scope.mouseButtons.MIDDLE) {\n\n\t\t\t\t\tcase MOUSE.DOLLY:\n\n\t\t\t\t\t\tif (scope.enableZoom === false) return;\n\n\t\t\t\t\t\thandleMouseDownDolly(event);\n\n\t\t\t\t\t\tstate = STATE.DOLLY;\n\n\t\t\t\t\t\tbreak;\n\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\n\t\t\t\tswitch (scope.mouseButtons.RIGHT) {\n\n\t\t\t\t\tcase MOUSE.ROTATE:\n\n\t\t\t\t\t\tif (scope.enableRotate === false) return;\n\n\t\t\t\t\t\thandleMouseDownRotate(event);\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase MOUSE.PAN:\n\n\t\t\t\t\t\tif (scope.enablePan === false) return;\n\t\t\t\t\t\tif (scope.view._mouseCaster.pickedObject === null) return;\n\n\t\t\t\t\t\thandleMouseDownPan(event);\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif (state !== STATE.NONE) {\n\n\t\t\tdocument.addEventListener('mousemove', onMouseMove, false);\n\t\t\tdocument.addEventListener('mouseup', onMouseUp, false);\n\n\t\t\tscope.dispatchEvent(startEvent);\n\n\t\t}\n\n\t}\n\n\tfunction onMouseMove(event) {\n\n\t\tif (scope.enabled === false) return;\n\n\t\tevent.preventDefault();\n\n\t\tswitch (state) {\n\n\t\t\tcase STATE.ROTATE:\n\n\t\t\t\tif (scope.enableRotate === false) return;\n\n\t\t\t\thandleMouseMoveRotate(event);\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.DOLLY:\n\n\t\t\t\tif (scope.enableZoom === false) return;\n\n\t\t\t\thandleMouseMoveDolly(event);\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.PAN:\n\n\t\t\t\tif (scope.enablePan === false) return;\n\n\t\t\t\thandleMouseMovePan(event);\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction onMouseUp(event) {\n\n\t\tif (scope.enabled === false) return;\n\n\t\thandleMouseUp(event);\n\n\t\tdocument.removeEventListener('mousemove', onMouseMove, false);\n\t\tdocument.removeEventListener('mouseup', onMouseUp, false);\n\n\t\tscope.dispatchEvent(endEvent);\n\n\t\tstate = STATE.NONE;\n\n\t}\n\n\tfunction onMouseWheel(event) {\n\n\t\tif (scope.enabled === false || scope.enableZoom === false || (state !== STATE.NONE && state !== STATE.ROTATE)) return;\n\n\t\tevent.preventDefault();\n\t\t//event.stopPropagation();\n\n\t\tscope.dispatchEvent(startEvent);\n\n\t\thandleMouseWheel(event);\n\n\t\tscope.dispatchEvent(endEvent);\n\n\t}\n\n\tfunction onKeyDown(event) {\n\n\t\tif (scope.enabled === false || scope.enableKeys === false || scope.enablePan === false) return;\n\n\t\thandleKeyDown(event);\n\n\t}\n\n\tfunction onTouchStart(event) {\n\n\t\tif (scope.enabled === false) return;\n\n\t\t//event.preventDefault();\n\n\t\tswitch (event.touches.length) {\n\n\t\t\tcase 1:\n\n\t\t\t\tswitch (scope.touches.ONE) {\n\n\t\t\t\t\tcase TOUCH.ROTATE:\n\n\t\t\t\t\t\tif (scope.enableRotate === false) return;\n\n\t\t\t\t\t\thandleTouchStartRotate(event);\n\n\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase TOUCH.PAN:\n\n\t\t\t\t\t\tif (scope.enablePan === false) return;\n\n\t\t\t\t\t\thandleTouchStartPan(event);\n\n\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\n\t\t\t\tswitch (scope.touches.TWO) {\n\n\t\t\t\t\tcase TOUCH.DOLLY_PAN:\n\n\t\t\t\t\t\tif (scope.enableZoom === false && scope.enablePan === false) return;\n\n\t\t\t\t\t\thandleTouchStartDollyPan(event);\n\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\t\tif (scope.enableZoom === false && scope.enableRotate === false) return;\n\n\t\t\t\t\t\thandleTouchStartDollyRotate(event);\n\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tif (state !== STATE.NONE) {\n\n\t\t\tscope.dispatchEvent(startEvent);\n\n\t\t}\n\n\t}\n\n\tfunction onTouchMove(event) {\n\n\t\tif (scope.enabled === false) return;\n\n\t\tevent.preventDefault();\n\t\t// event.stopPropagation();\n\n\t\tswitch (state) {\n\n\t\t\tcase STATE.TOUCH_ROTATE:\n\n\t\t\t\tif (scope.enableRotate === false) return;\n\n\t\t\t\thandleTouchMoveRotate(event);\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.TOUCH_PAN:\n\n\t\t\t\tif (scope.enablePan === false) return;\n\n\t\t\t\thandleTouchMovePan(event);\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.TOUCH_DOLLY_PAN:\n\n\t\t\t\tif (scope.enableZoom === false && scope.enablePan === false) return;\n\n\t\t\t\thandleTouchMoveDollyPan(event);\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\t\tif (scope.enableZoom === false && scope.enableRotate === false) return;\n\n\t\t\t\thandleTouchMoveDollyRotate(event);\n\n\t\t\t\tscope.update();\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t}\n\n\tfunction onTouchEnd(event) {\n\n\t\tif (scope.enabled === false) return;\n\n\t\thandleTouchEnd(event);\n\n\t\tscope.dispatchEvent(endEvent);\n\n\t\tstate = STATE.NONE;\n\n\t}\n\n\tfunction onContextMenu(event) {\n\n\t\tif (scope.enabled === false) return;\n\n\t\tevent.preventDefault();\n\n\t}\n\n\t//\n\n\tscope.domElement.addEventListener('contextmenu', onContextMenu, false);\n\n\tscope.domElement.addEventListener('mousedown', onMouseDown, false);\n\tscope.domElement.addEventListener('wheel', onMouseWheel, false);\n\n\tscope.domElement.addEventListener('touchstart', onTouchStart, false);\n\tscope.domElement.addEventListener('touchend', onTouchEnd, false);\n\tscope.domElement.addEventListener('touchmove', onTouchMove, false);\n\n\twindow.addEventListener('keydown', onKeyDown, false);\n\n\t// force an update at start\n\n\tthis.update();\n\n};\n\nOrbitControls.prototype = Object.create(EventDispatcher.prototype);\nOrbitControls.prototype.constructor = OrbitControls;\n\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n// This is very similar to OrbitControls, another set of touch behavior\n//\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - left mouse, or arrow keys / touch: one-finger move\n\nvar MapControls = function (object, domElement) {\n\n\tOrbitControls.call(this, object, domElement);\n\n\tthis.mouseButtons.LEFT = MOUSE.PAN;\n\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\n\n\tthis.touches.ONE = TOUCH.PAN;\n\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\n\n};\n\nMapControls.prototype = Object.create(EventDispatcher.prototype);\nMapControls.prototype.constructor = MapControls;\n\nexport { OrbitControls, MapControls };\n","export default class Animation {\n  /**\n   * Progress of the animation between 0.0 (start) and 1.0 (end).\n   */\n  public progress = 0.0;\n\n  public complete = false;\n\n  /**\n   * Simple animation helper\n   * @param durationMs duration of the animation in milliseconds\n   * @param update animation function which will receive values between 0.0 and 1.0 over the duration of the animation\n   * @param easingFunction function that determines the progression of the animation over time\n   */\n  constructor(private durationMs: number, private update: (progress: number) => void, private easingFunction = Animation.easeInOutQuad) {\n  }\n\n  /**\n   * Advances the animation by the given amount of time in seconds.\n   * Returns true if the animation is finished.\n   */\n  animate(dtS: number): boolean {\n    this.progress = this.progress + dtS * 1000 / this.durationMs\n\tthis.update(this.easingFunction(this.progress))\n\tif(this.progress >= 1.0)\n\t  this.complete = true;\n    return this.progress >= 1.0\n  }\n\n  static easeInOutQuad = (t: number): number => {\n    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t\n  }\n\n  static easeLinear = (t: number): number => t\n}","import { ViewController, CameraControlSettings } from \"../utils/Interfaces\"\nimport { OrbitControls } from \"../lib/OrbitControls\"\nimport { MOUSE, Vector2 } from \"three\"\nimport Engine from '../Engine';\nimport View from \"./View\";\nimport Tile from \"../grids/Tile\";\nimport Cell from \"../grids/Cell\";\nimport Animation from '../utils/Animation';\n\nexport default class Controller implements ViewController {\n\n\tpublic controls: OrbitControls;\n\n\tset active(active: boolean) {\n\t\tthis._view.controlled = active;\n\t}\n\n\tget active(): boolean {\n\t\treturn this._view.controlled;\n\t}\n\n\tpublic panning = false;\n\tprivate _panDirection: Vector2;\n\n\tpublic get panDirection(): Vector2 {\n\t\tif(this._panDirection) return this._panDirection;\n\t\telse {\n\t\t\tthis._panDirection = new Vector2();\n\t\t\treturn this._panDirection;\n\t\t}\n\t}\n\n\tpublic set panDirection(val: Vector2) {\n\t\tthis._panDirection = val;\n\t}\n\n\tconstructor(private _view: View, config?: CameraControlSettings) {\n\t\tif (!_view) {\n\t\t\tthrow new Error('Controller missing View reference');\n\t\t}\n\t\tif (config) {\n\t\t\tthis._initControls(config);\n\t\t} else {\n\t\t\tthis._view.controlled = false;\n\t\t\tthis.controls = new OrbitControls(this._view.camera, this._view.renderer.domElement, this._view);\n\t\t}\n\t}\n\n\tprivate _initControls(config: CameraControlSettings): void {\n\t\tthis._view.controlled = config.controlled;\n\t\tthis.controls = new OrbitControls(this._view.camera, this._view.renderer.domElement, this._view);\n\t\tthis.controls.minDistance = config.minDistance;\n\t\tthis.controls.maxDistance = config.maxDistance;\n\t\tthis.controls.zoomSpeed = config.zoomSpeed;\n\t\tthis._view.hotEdges = config.hotEdges;\n\t\tthis.controls.autoRotate = config.autoRotate;\n\t\tthis.controls.enableDamping = config.enableDamping;\n\t\tthis.controls.dampingFactor = config.dampingFactor;\n\t\tthis.controls.screenSpacePanning = config.screenSpacePanning;\n\t\tthis.controls.minPolarAngle = config.minPolarAngle;\n\t\tthis.controls.maxPolarAngle = config.maxPolarAngle;\n\t\tif (!config.horizontalRotation) {\n\t\t\tif (config.maxAzimuthAngle)\n\t\t\t\tthis.controls.maxAzimuthAngle = config.maxAzimuthAngle;\n\t\t\tif (config.minAzimuthAngle)\n\t\t\t\tthis.controls.minAzimuthAngle = config.minAzimuthAngle;\n\t\t}\n\n\t\tthis.controls.mouseButtons = { LEFT: MOUSE.RIGHT, MIDDLE: MOUSE.MIDDLE, RIGHT: MOUSE.LEFT };\n\n\t}\n\n\tupdate(): void {\n\t\tthis.controls.update();\n\t}\n\n\tdispose(): void {\n\t\tthis.controls.dispose();\n\t}\n\n\tpanInDirection(direction: Vector2): void {\n\t\twhile (this._view.animationManager.animations.length >= 1) this._view.animationManager.cancelAnimation();\n\t\tthis.controls.pan(direction.x, direction.y);\n\t\tthis.controls.update();\n\t}\n\n\tpanCameraTo(tile: Tile | Cell, durationMs: number): void {\n\t\tif (tile instanceof Cell) {\n\t\t\ttile = tile.tile;\n\t\t}\n\t\tconst from = this.controls.target.clone();\n\t\tconst to = tile.position.clone();\n\n\t\tthis._view.animationManager.addAnimation(new Animation(durationMs, (a): void => {\n\t\t\tthis._view.focusOn(tile as Tile);\n\t\t\tthis.controls.target = from.lerp(to, a);\n\t\t\tthis.controls.update();\n\t\t}));\n\t}\n\n\ttoggleControls(): void {\n\t\tif (this._view.controlled) {\n\t\t\tthis._view.controlled = false;\n\t\t} else {\n\t\t\tthis._view.controlled = true;\n\t\t}\n\t}\n\n\tupdateControlSettings(settings: CameraControlSettings): void {\n\t\tthis._view.settings.cameraControlSettings = Engine.Tools.merge(this._view.settings.cameraControlSettings, settings) as CameraControlSettings;\n\t\tthis.controls.minDistance = settings.minDistance || this.controls.minDistance;\n\t\tthis.controls.maxDistance = settings.maxDistance || this.controls.maxDistance;\n\t\tthis.controls.zoomSpeed = settings.zoomSpeed || this.controls.zoomSpeed;\n\t\tsettings.hotEdges !== undefined ? this._view.hotEdges = settings.hotEdges : this._view.hotEdges = this._view.settings.cameraControlSettings.hotEdges;\n\t\tif (settings.autoRotate !== undefined) {\n\t\t\tthis.toggleHorizontalRotation(settings.autoRotate);\n\t\t\tthis.controls.autoRotate = settings.autoRotate;\n\t\t} else {\n\t\t\tthis.controls.autoRotate = this._view.settings.cameraControlSettings.autoRotate;\n\t\t}\n\t\tsettings.enableDamping !== undefined ? this.controls.enableDamping = settings.enableDamping : this.controls.enableDamping = this._view.settings.cameraControlSettings.enableDamping;\n\t\tthis.controls.dampingFactor = settings.dampingFactor || this._view.settings.cameraControlSettings.dampingFactor;\n\t\tsettings.screenSpacePanning !== undefined ? this.controls.screenSpacePanning = settings.screenSpacePanning : this.controls.screenSpacePanning = this._view.settings.cameraControlSettings.screenSpacePanning;\n\t\tif (settings.minPolarAngle)\n\t\t\tthis.controls.minPolarAngle = settings.minPolarAngle;\n\t\tif (settings.maxPolarAngle)\n\t\t\tthis.controls.maxPolarAngle = settings.maxPolarAngle\n\t\tif (settings.maxAzimuthAngle)\n\t\t\tthis.controls.maxAzimuthAngle = settings.maxAzimuthAngle;\n\t\tif (settings.minAzimuthAngle)\n\t\t\tthis.controls.minAzimuthAngle = settings.minAzimuthAngle;\n\n\t}\n\n\ttoggleHorizontalRotation(val: boolean): void {\n\t\tif (val) {\n\t\t\tthis.controls.dispose();\n\t\t\tthis.controls = new OrbitControls(this._view.camera, this._view.renderer.domElement, this._view);\n\t\t\tthis.controls.minDistance = this._view.settings.cameraControlSettings.minDistance;\n\t\t\tthis.controls.maxDistance = this._view.settings.cameraControlSettings.maxDistance;\n\t\t\tthis.controls.zoomSpeed = this._view.settings.cameraControlSettings.zoomSpeed;\n\t\t\tthis._view.hotEdges = this._view.settings.cameraControlSettings.hotEdges;\n\t\t\tthis.controls.autoRotate = this._view.settings.cameraControlSettings.autoRotate;\n\t\t\tthis.controls.enableDamping = this._view.settings.cameraControlSettings.enableDamping;\n\t\t\tthis.controls.screenSpacePanning = this._view.settings.cameraControlSettings.screenSpacePanning;\n\t\t\tthis.controls.minPolarAngle = this._view.settings.cameraControlSettings.minPolarAngle;\n\t\t\tthis.controls.maxPolarAngle = this._view.settings.cameraControlSettings.maxPolarAngle;\n\t\t\tthis.controls.mouseButtons = { LEFT: MOUSE.RIGHT, MIDDLE: MOUSE.MIDDLE, RIGHT: MOUSE.LEFT };\n\t\t} else {\n\t\t\tthis.controls.dispose();\n\t\t\tthis.controls = new OrbitControls(this._view.camera, this._view.renderer.domElement, this._view);\n\t\t\tthis.controls.minDistance = this._view.settings.cameraControlSettings.minDistance;\n\t\t\tthis.controls.maxDistance = this._view.settings.cameraControlSettings.maxDistance;\n\t\t\tthis.controls.zoomSpeed = this._view.settings.cameraControlSettings.zoomSpeed;\n\t\t\tthis._view.hotEdges = this._view.settings.cameraControlSettings.hotEdges;\n\t\t\tthis.controls.autoRotate = this._view.settings.cameraControlSettings.autoRotate;\n\t\t\tthis.controls.enableDamping = this._view.settings.cameraControlSettings.enableDamping;\n\t\t\tthis.controls.screenSpacePanning = this._view.settings.cameraControlSettings.screenSpacePanning;\n\t\t\tthis.controls.minPolarAngle = this._view.settings.cameraControlSettings.minPolarAngle;\n\t\t\tthis.controls.maxPolarAngle = this._view.settings.cameraControlSettings.maxPolarAngle;\n\t\t\tif (this._view.settings.cameraControlSettings.maxAzimuthAngle)\n\t\t\t\tthis.controls.maxAzimuthAngle = this._view.settings.cameraControlSettings.maxAzimuthAngle;\n\t\t\tif (this._view.settings.cameraControlSettings.minAzimuthAngle)\n\t\t\t\tthis.controls.minAzimuthAngle = this._view.settings.cameraControlSettings.minAzimuthAngle;\n\t\t\tthis.controls.mouseButtons = { LEFT: MOUSE.RIGHT, MIDDLE: MOUSE.MIDDLE, RIGHT: MOUSE.LEFT };\n\t\t}\n\t}\n\n\trotateUp(angle: number): void {\n\t\tthis.controls.rotateUp(angle);\n\t}\n}","import Animation from './Animation';\nimport { Renderer, Camera, Scene } from 'three';\n\nexport default class AnimationManager {\n  public animations: Animation[] = [];\n\n  private _lastTimestamp = performance.now();\n  private _animationID: number;\n  private _onAnimate: { [id: string]: (dts: number) => void } = {};\n  private _paused = false;\n\n  constructor(private renderer: Renderer, private container: Scene, private camera: Camera, onAnimate?: (dtS: number) => void) {\n    const _onAnimate = (dtS: number): void => {\n      for(let i = 0; i < this.animations.length; i++) {\n        // advance the animation\n        const animation = this.animations[i]\n        if (animation) {\n          const finished = animation.animate(dtS)\n          // if the animation is finished (returned true) remove it\n          if (finished) {\n            // remove the animation\n\t\t\tthis.animations.shift();\n          }\n        }\n      }\n\t}\n\tthis._onAnimate[this.genID()] = _onAnimate;\n    if (onAnimate) {\n      this._onAnimate[this.genID()] = onAnimate;\n    }\n  }\n\n  set paused(paused: boolean) {\n    this._paused = paused;\n  }\n\n  addOnAnimate(callback: (dtS: number) => void): string {\n    const id = this.genID();\n    this._onAnimate[id] = callback;\n    return id;\n  }\n\n  addAnimation(animation: Animation): void {\n    if (this.animations.length > 0) {\n      this.cancelAnimation();\n    }\n    this.animations.push(animation);\n  }\n\n  cancelOnAnimate(id: string): void {\n    delete this._onAnimate[id];\n  }\n\n  cancelAnimation(): void {\n    this.animations.shift();\n  }\n\n  dispose(): void {\n    window.cancelAnimationFrame(this._animationID);\n    this.animations = null;\n  }\n\n  animate(timestamp: number): void {\n    if (!this._paused) {\n      const dtS = (timestamp - this._lastTimestamp) / 1000.0;\n      this._lastTimestamp = timestamp;\n      for (const i in this._onAnimate) {\n        this._onAnimate[i](dtS);\n      }\n    }\n    this.renderer.render(this.container, this.camera);\n    this._animationID = requestAnimationFrame(this.animate.bind(this));\n  }\n  \n  toggleAnimationLoop(): void {\n    this._paused = !this._paused;\n  }\n\n  private genID(): string {\n    // Math.random should be unique because of its seeding algorithm.\n    // Convert it to base 36 (numbers + letters), and grab the first 9 characters\n    // after the decimal.\n    return '_' + Math.random().toString(36).substr(2, 9);\n  };\n}","import { ViewSettings, CameraControlSettings, ViewController } from '../utils/Interfaces';\nimport { WebGLRenderer, DirectionalLight, Scene, AmbientLight, PerspectiveCamera, Mesh, Vector3, Vector2 } from 'three';\nimport Tile from '../grids/Tile';\nimport Cell from '../grids/Cell';\nimport Controller from './Controller';\nimport MouseCaster from '../utils/MouseCaster';\nimport Tools from '../utils/Tools';\nimport Map from './Map';\nimport AnimationManager from '../utils/AnimationManager';\n\n/*\n\tSets up and manages a THREEjs container, camera, and light, making it easy to get going.\n\tAlso provides camera control, mouse control, animation control.\n\n\tAssumes full screen.\n */\n// 'utils/Tools'\nexport default class View implements ViewController {\n\n\tpublic map: Map;\n\n\tpublic width: number;\n\tpublic height: number;\n\tpublic renderer: WebGLRenderer;\n\tpublic container: Scene;\n\tpublic camera: PerspectiveCamera;\n\tpublic controlled: boolean;\n\tpublic settings: ViewSettings;\n\tpublic controls: Controller;\n\tpublic animationManager: AnimationManager;\n\n\tprivate _selectedTile: Tile;\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tprivate _onTileSelected: (tile: Tile) => void\n\tprivate _onLoaded: () => void;\n\n\tprivate _mouseCaster: MouseCaster;\n\n\tprivate _hoverTile: Tile;\n\n\t// This code should be with the Controller code \n\tpublic hotEdges: boolean;\n\n\tconstructor(map: Map, viewConfig?: ViewSettings) {\n\t\tviewConfig = viewConfig || {} as ViewSettings;\n\t\tlet sceneSettings = {\n\t\t\telement: document.body,\n\t\t\talpha: true,\n\t\t\tantialias: true,\n\t\t\tclearColor: 0x6495ED,\n\t\t\tsortObjects: false,\n\t\t\tfog: null,\n\t\t\tlight: new DirectionalLight(0xffffff),\n\t\t\tlightPosition: null,\n\t\t\t//cameraType: 'PerspectiveCamera',\n\t\t\tcameraPosition: null, // {x, y, z}\n\t\t\t//orthoZoom: 10,\n\t\t\tsceneMarginSize: 20,\n\t\t\tcameraControlSettings: {\n\t\t\t\tcontrolled: true,\n\t\t\t\tenableDamping: false,\n\t\t\t\tdampingFactor: .05,\n\t\t\t\tminDistance: 25,\n\t\t\t\tmaxDistance: 1250,\n\t\t\t\tzoomSpeed: 3,\n\t\t\t\thotEdges: true,\n\t\t\t\tautoRotate: false,\n\t\t\t\tscreenSpacePanning: false,\n\t\t\t\tminPolarAngle: Math.PI / 6,\n\t\t\t\tmaxPolarAngle: Math.PI / 3,\n\t\t\t\tminAzimuthAngle: 0,\n\t\t\t\tmaxAzimuthAngle: -Math.PI,\n\t\t\t\thorizontalRotation: false,\n\t\t\t} as CameraControlSettings,\n\t\t} as ViewSettings;\n\n\t\tif (viewConfig.cameraControlSettings) {\n\t\t\tsceneSettings.cameraControlSettings = Tools.merge(sceneSettings.cameraControlSettings, viewConfig.cameraControlSettings) as CameraControlSettings;\n\t\t}\n\n\t\tif (viewConfig)\n\t\t\tsceneSettings = Tools.merge(sceneSettings, viewConfig) as ViewSettings;\n\t\tthis.settings = sceneSettings;\n\n\t\tthis._initSceneSettings();\n\n\t\tthis.attachTo(sceneSettings.element);\n\t\tthis.addMap(map);\n\t\tthis.animationManager.animate(0);\n\t}\n\n\tset mouseCaster(mouse: MouseCaster) {\n\t\tthis._mouseCaster = mouse;\n\t}\n\n\tset onLoaded(callback: () => void) {\n\t\tthis._onLoaded = callback\n\t}\n\n\tset onTileSelected(callback: (tile: Tile) => void) {\n\t\tthis._onTileSelected = callback\n\t}\n\n\tget selectedTile(): Tile {\n\t\treturn this._selectedTile\n\t}\n\n\tadd(mesh: Mesh): void {\n\t\tthis.container.add(mesh);\n\t}\n\n\taddMap(map: Map): void {\n\t\tthis.map = map;\n\t\tthis.container.add(map.group);\n\t}\n\n\tattachTo(element: HTMLElement): void {\n\t\telement.style.width = this.width + 'px';\n\t\telement.style.height = this.height + 'px';\n\t\tthis.renderer.setPixelRatio(window.devicePixelRatio);\n\t\tthis.renderer.setSize(this.width, this.height);\n\t\telement.appendChild(this.renderer.domElement);\n\t}\n\n\tdispose(): void {\n\t\twindow.removeEventListener('resize', this.onWindowResize, false);\n\t\tthis.controls.dispose();\n\t\tthis._mouseCaster.dispose(this);\n\t\tthis.animationManager.dispose();\n\t\tthis.animationManager = null;\n\t\tthis.container = null;\n\t\tthis.camera = null;\n\t\tthis.controls = null;\n\t\tthis._mouseCaster = null;\n\t}\n\n\tfocusOn(pos: Tile | Vector3): void {\n\t\tif (pos instanceof Tile) {\n\t\t\tpos = pos.position;\n\t\t}\n\t\tthis.camera.lookAt(pos);\n\t}\n\n\tpanCameraTo(tile: Tile | Cell, durationMs: number): void {\n\t\tthis.controls.panCameraTo(tile, durationMs);\n\t}\n\n\tpanInDirection(direction: Vector2): void {\n\t\tthis.controls.panInDirection(direction);\n\t}\n\n\tremove(mesh: Mesh): void {\n\t\tthis.container.remove(mesh);\n\t}\n\n\ttoggleAnimationLoop(): void {\n\t\tthis.animationManager.toggleAnimationLoop();\n\t}\n\n\ttoggleControls(): void {\n\t\tthis.controls.toggleControls();\n\t}\n\n\ttoggleHorizontalRotation(bool: boolean): void {\n\t\tthis.controls.toggleHorizontalRotation(bool);\n\t}\n\n\tupdateControlSettings(settings: CameraControlSettings): void {\n\t\tthis.controls.updateControlSettings(settings);\n\t}\n\n\t// Need to finish\n\tupdateSettings(settings: ViewSettings): void {\n\t\t// update settings here\n\n\t\t// then update controls\n\t\tthis.updateControlSettings(settings.cameraControlSettings);\n\t}\n\n\tprivate _initSceneSettings(): void {\n\n\t\tthis.renderer = new WebGLRenderer({\n\t\t\talpha: this.settings.alpha,\n\t\t\tantialias: this.settings.antialias\n\t\t});\n\t\tthis.renderer.setClearColor(this.settings.clearColor);\n\t\tthis.renderer.sortObjects = this.settings.sortObjects;\n\n\t\tthis.width = window.innerWidth;\n\t\tthis.height = window.innerHeight;\n\n\t\tconst left = document.createElement('div');\n\t\tleft.style.cssText = 'position:absolute;left:0;height:100%;width:' + this.settings.sceneMarginSize + 'px;';\n\t\tleft.addEventListener('mouseover', () => {\n\t\t\tthis.controls.panning = true;\n\t\t\tthis.controls.panDirection = new Vector2(15, 0);\n\t\t}, false);\n\t\tleft.addEventListener('mouseleave', () => {\n\t\t\tthis.controls.panning = false;\n\t\t}, false);\n\n\t\tconst top = document.createElement('div');\n\t\ttop.style.cssText = 'position:absolute;top:0;width:100%;height:' + this.settings.sceneMarginSize + 'px;';\n\t\ttop.addEventListener('mouseover', () => {\n\t\t\tthis.controls.panning = true;\n\t\t\tthis.controls.panDirection = new Vector2(0, 15);\n\t\t}, false);\n\t\ttop.addEventListener('mouseleave', () => {\n\t\t\tthis.controls.panning = false;\n\t\t}, false);\n\n\t\tconst topLeft = document.createElement('div');\n\t\ttopLeft.style.cssText = 'position:absolute;left:0;top:0;height:' + this.settings.sceneMarginSize + 'px;width:' + this.settings.sceneMarginSize + 'px';\n\t\ttopLeft.addEventListener('mouseenter', () => {\n\t\t\tthis.controls.panning = true;\n\t\t\tthis.controls.panDirection = new Vector2(15,15);\n\t\t}, false);\n\t\ttopLeft.addEventListener('mouseleave', () => {\n\t\t\tthis.controls.panning = false;\n\t\t}, false);\n\n\t\tconst right = document.createElement('div');\n\t\tright.style.cssText = 'position:absolute;right:0;height:100%;width:' + this.settings.sceneMarginSize + 'px;';\n\t\tright.addEventListener('mouseover', () => {\n\t\t\tthis.controls.panning = true;\n\t\t\tthis.controls.panDirection = new Vector2(-15,0);\n\t\t}, false);\n\t\tright.addEventListener('mouseleave', () => {\n\t\t\tthis.controls.panning = false;\n\t\t}, false);\n\n\t\tconst topRight = document.createElement('div');\n\t\ttopRight.style.cssText = 'position:absolute;right:0;top:0;height:' + this.settings.sceneMarginSize + 'px;width:' + this.settings.sceneMarginSize + 'px';\n\t\ttopRight.addEventListener('mouseenter', () => {\n\t\t\tthis.controls.panning = true;\n\t\t\tthis.controls.panDirection = new Vector2(-15,15);\n\t\t}, false);\n\t\ttopRight.addEventListener('mouseleave', () => {\n\t\t\tthis.controls.panning = false;\n\t\t}, false);\n\n\t\tconst bottom = document.createElement('div');\n\t\tbottom.style.cssText = 'position:absolute;bottom:0;width:100%;height:' + this.settings.sceneMarginSize + 'px;';\n\t\tbottom.addEventListener('mouseover', () => {\n\t\t\tthis.controls.panning = true;\n\t\t\tthis.controls.panDirection = new Vector2(0,-15);\n\t\t}, false);\n\t\tbottom.addEventListener('mouseleave', () => {\n\t\t\tthis.controls.panning = false;\n\t\t}, false);\n\n\t\tconst bottomLeft = document.createElement('div');\n\t\tbottomLeft.style.cssText = 'position:absolute;left:0;bottom:0;height:' + this.settings.sceneMarginSize + 'px;width:' + this.settings.sceneMarginSize + 'px';\n\t\tbottomLeft.addEventListener('mouseenter', () => {\n\t\t\tthis.controls.panning = true;\n\t\t\tthis.controls.panDirection = new Vector2(15,-15);\n\t\t}, false);\n\t\tbottomLeft.addEventListener('mouseleave', () => {\n\t\t\tthis.controls.panning = false;\n\t\t}, false);\n\n\t\tconst bottomRight = document.createElement('div');\n\t\tbottomRight.style.cssText = 'position:absolute;right:0;bottom:0;height:' + this.settings.sceneMarginSize + 'px;width:' + this.settings.sceneMarginSize + 'px';\n\t\tbottomRight.addEventListener('mouseenter', () => {\n\t\t\tthis.controls.panning = true;\n\t\t\tthis.controls.panDirection = new Vector2(15,-15);\n\t\t}, false);\n\t\tbottomRight.addEventListener('mouseleave', () => {\n\t\t\tthis.controls.panning = false;\n\t\t}, false);\n\t\tthis.settings.element.appendChild(left);\n\t\tthis.settings.element.appendChild(top);\n\t\tthis.settings.element.appendChild(topLeft);\n\t\tthis.settings.element.appendChild(right);\n\t\tthis.settings.element.appendChild(topRight);\n\t\tthis.settings.element.appendChild(bottom);\n\t\tthis.settings.element.appendChild(bottomLeft);\n\t\tthis.settings.element.appendChild(bottomRight);\n\n\t\tthis.container = new Scene();\n\t\tthis.container.fog = this.settings.fog;\n\n\t\tthis.container.add(new AmbientLight(0xdddddd));\n\n\t\tif (!this.settings.lightPosition) {\n\t\t\tthis.settings.light.position.set(1, 1, 3).normalize();\n\t\t\tthis.settings.light.intensity = 1.2;\n\t\t} else {\n\t\t\tconst p = this.settings.lightPosition;\n\t\t\tthis.settings.light.position.set(p.x, p.y, p.z).normalize();\n\t\t\tthis.settings.light.intensity = 1.2;\n\t\t}\n\t\tthis.container.add(this.settings.light);\n\n\t\tthis.camera = new PerspectiveCamera(50, this.width / this.height, 1, 5000);\n\t\tif (this.settings.cameraPosition) {\n\t\t\tthis.camera.position.copy(this.settings.cameraPosition);\n\t\t}\n\n\t\tthis._initControls(this.settings.cameraControlSettings);\n\n\t\tthis._initMouseCaster();\n\n\t\tthis._initAnimationManager();\n\n\t\tthis.settings.element.addEventListener('resize', this.onWindowResize.bind(this), false);\n\t}\n\n\tprivate _initControls(config: CameraControlSettings): void {\n\t\tthis.controls = new Controller(this, config);\n\t}\n\n\tprivate _initAnimationManager(): void {\n\t\tconst onAnimate = (): void => {\n\t\t\tif (this.controlled) {\n\t\t\t\tif (this.hotEdges && this.controls.panning && this._hoverTile) {\n\t\t\t\t\tthis.panInDirection(this.controls.panDirection);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.controls.update();\n\t\t\tthis._mouseCaster.update();\n\t\t}\n\t\tthis.animationManager = new AnimationManager(this.renderer, this.container, this.camera, onAnimate);\n\t}\n\n\tprivate _initMouseCaster(): void {\n\t\tthis._mouseCaster = new MouseCaster(this.container, this.camera);\n\t\tthis._mouseCaster.signal.add((evt: string, tile: Tile | MouseEvent) => {\n\t\t\tif (this.controlled) {\n\t\t\t\tif (evt === MouseCaster.CLICK) {\n\t\t\t\t\t//(tile as Tile).toggle();\n\t\t\t\t\tthis.controls.panCameraTo(tile as Tile, 2500);\n\t\t\t\t\t// or we can use the mouse's raw coordinates to access the cell directly, just for fun:\n\t\t\t\t\tconst cell = this.map.grid.pixelToCell(this._mouseCaster.position);\n\t\t\t\t\tconst t = this.map.getTileAtCell(cell);\n\t\t\t\t\tif (t) t.toggle();\n\t\t\t\t}\n\t\t\t\tif (evt === MouseCaster.OVER) {\n\t\t\t\t\tif (tile !== null) {\n\t\t\t\t\t\t(tile as Tile).select();\n\t\t\t\t\t\tthis._hoverTile = tile as Tile;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (evt === MouseCaster.OUT) {\n\t\t\t\t\tif (tile !== null) {\n\t\t\t\t\t\t(tile as Tile).deselect();\n\t\t\t\t\t\tthis._hoverTile = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate onWindowResize(): void {\n\t\tthis.width = window.innerWidth;\n\t\tthis.height = window.innerHeight;\n\t\t(this.camera as PerspectiveCamera).aspect = this.width / this.height;\n\t\t(this.camera as PerspectiveCamera).updateProjectionMatrix();\n\t\tthis.renderer.setSize(this.width, this.height, true);\n\t}\n}\n","/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport Engine from '../Engine';\n// 'utils/Tools', 'lib/LinkedList', 'utils/MouseCaster', 'lib/Signal'\nexport default class SelectionManager {\n\tconstructor(mouse) {\n\t\tthis.mouse = mouse;\n\n\t\tthis.onSelect = new Engine.Signal();\n\t\tthis.onDeselect = new Engine.Signal();\n\n\t\tthis.selected = null;\n\t\t// deselect if player clicked on the same thing twice\n\t\tthis.toggleSelection = false;\n\n\t\t// allow multiple entities to be selected at once\n\t\t// this.multiselect = false; // todo\n\t\t// this.allSelected = new LinkedList();\n\n\t\tthis.mouse.signal.add(this.onMouse, this);\n\t}\n\tselect(obj, fireSignal) {\n\t\tif (!obj) return;\n\t\tfireSignal = fireSignal || true;\n\n\t\tif (this.selected !== obj) {\n\t\t\t// deselect previous object\n\t\t\tthis.clearSelection(fireSignal);\n\t\t}\n\t\tif (obj.selected) {\n\t\t\tif (this.toggleSelection) {\n\t\t\t\tif (fireSignal) {\n\t\t\t\t\tthis.onDeselect.dispatch(obj);\n\t\t\t\t}\n\t\t\t\tobj.deselect();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tobj.select();\n\t\t}\n\n\t\tthis.selected = obj;\n\t\tif (fireSignal) {\n\t\t\tthis.onSelect.dispatch(obj);\n\t\t}\n\t}\n\n\tclearSelection(fireSignal) {\n\t\tfireSignal = fireSignal || true;\n\t\tif (this.selected) {\n\t\t\tif (fireSignal) {\n\t\t\t\tthis.onDeselect.dispatch(this.selected);\n\t\t\t}\n\t\t\tthis.selected.deselect();\n\t\t}\n\t\tthis.selected = null;\n\t}\n\n\tonMouse(type, obj) {\n\t\tswitch (type) {\n\t\t\tcase Engine.MouseCaster.DOWN:\n\t\t\t\tif (!obj) {\n\t\t\t\t\tthis.clearSelection();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase Engine.MouseCaster.CLICK:\n\t\t\t\tthis.select(obj);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n}","import Engine from '../Engine';\nimport Tile from '../grids/Tile';\nimport { GridInterface } from '../grids/Grid';\nimport { Object3D, Vector3, LineBasicMaterial } from 'three';\nimport AStarFinder from '../pathing/AStarFinder';\nimport Cell from '../grids/Cell';\nimport { MapSettings, PathfinderSettings, ExtrudeSettings, heuristic } from '../utils/Interfaces';\n\nexport default class Map {\n\n\tpublic grid: GridInterface;\n\tpublic pathFinder: AStarFinder;\n\tpublic tiles: Tile[];\n\tpublic group: Object3D;\n\tpublic tileGroup: Object3D;\n\tpublic tileOverlay: Object3D;\n\n\tdispose(): void {\n\t\tdelete this.tiles;\n\t\tdelete this.tileGroup;\n\t\tdelete this.group;\n\t\tdelete this.tileOverlay;\n\t\tdelete this.pathFinder;\n\t}\n\n\tconstructor(grid: GridInterface, mapConfig?: MapSettings, finderConfig?: PathfinderSettings) {\n\t\tif (!grid) throw new Error('You must pass in a grid system for the map to use.');\n\n\t\tthis.tiles = [] as Tile[];\n\t\tthis.tileGroup = null; // only for tiles\n\n\t\tthis.group = new Object3D(); // can hold all entities, also holds tileGroup, never trashed\n\n\t\tthis.grid = null;\n\t\tthis.tileOverlay = null;\n\t\tthis.pathFinder = new Engine.AStarFinder(finderConfig);\n\t\t// need to keep a resource cache around, so this Loader does that, use it instead of THREE.ImageUtils\n\t\tEngine.Loader.init();\n\n\t\tthis.setGrid(grid);\n\t\tthis.generateTiles(mapConfig)\n\t}\n\tsetEntityOnTile(entity: any, tile: Tile): void {\n\t\t// snap an entity's position to a tile; merely copies position\n\t\tconst pos = this.grid.cellToPixel(tile.cell);\n\t\tentity.position.copy(pos);\n\t\t// adjust for any offset after the entity was set directly onto the tile\n\t\tentity.position.y += entity.heightOffset || 0;\n\t\t// remove entity from old tile\n\t\tif (entity.tile) {\n\t\t\tentity.tile.entity = null;\n\t\t}\n\t\t// set new situation\n\t\tentity.tile = tile;\n\t\ttile.entity = entity;\n\t}\n\n\taddTile(tile: Tile): void {\n\t\tconst i = this.tiles.indexOf(tile);\n\t\tif (i === -1) this.tiles.push(tile);\n\t\telse return;\n\n\t\tthis.snapTileToGrid(tile);\n\t\ttile.position.y = 0;\n\n\t\tthis.tileGroup.add(tile.mesh);\n\t\tthis.grid.add(tile.cell);\n\n\t\ttile.cell.tile = tile;\n\t}\n\n\tremoveTile(tile: Tile): void {\n\t\tif (!tile) return; // was already removed somewhere\n\t\tconst i = this.tiles.indexOf(tile);\n\t\tthis.grid.remove(tile.cell);\n\n\t\tif (i !== -1) this.tiles.splice(i, 1);\n\t\t// this.tileGroup.remove(tile.mesh);\n\n\t\ttile.dispose();\n\t}\n\n\tremoveAllTiles(): void {\n\t\tif (!this.tileGroup) return;\n\t\tconst tiles = this.tileGroup.children;\n\t\tfor (let i = 0; i < tiles.length; i++) {\n\t\t\tthis.tileGroup.remove(tiles[i]);\n\t\t}\n\t}\n\n\tgetTileAtCell(cell: Cell): Tile {\n\t\tconst h = this.grid.cellToHash(cell);\n\t\treturn cell.tile || (typeof this.grid.cells[h] !== 'undefined' ? this.grid.cells[h].tile : null);\n\t}\n\n\tsnapToGrid(pos: Vector3): void {\n\t\tconst cell = this.grid.pixelToCell(pos);\n\t\tpos.copy(this.grid.cellToPixel(cell));\n\t}\n\n\tsnapTileToGrid(tile: Tile): Tile {\n\t\tif (tile.cell) {\n\t\t\ttile.position.copy(this.grid.cellToPixel(tile.cell));\n\t\t}\n\t\telse {\n\t\t\tconst cell = this.grid.pixelToCell(tile.position);\n\t\t\ttile.position.copy(this.grid.cellToPixel(cell));\n\t\t}\n\t\treturn tile;\n\t}\n\n\tgetRandomTile(): Tile {\n\t\tconst i = Engine.Tools.randomInt(0, this.tiles.length - 1);\n\t\treturn this.tiles[i];\n\t}\n\n\tfindPath(startTile: Tile, endTile: Tile, filter?: heuristic): Cell[][] {\n\t\treturn this.pathFinder.findPath(startTile.cell, endTile.cell, filter, this.grid);\n\t}\n\n\tsetGrid(newGrid: GridInterface): void {\n\t\tthis.group.remove(this.tileGroup);\n\t\tif (this.grid && newGrid !== this.grid) {\n\t\t\tthis.removeAllTiles();\n\t\t\tconst self = this;\n\t\t\tthis.tiles.forEach(function (t) {\n\t\t\t\tself.grid.remove(t.cell);\n\t\t\t\tt.dispose();\n\t\t\t});\n\t\t\tthis.grid.dispose();\n\t\t}\n\t\tthis.grid = newGrid;\n\t\tthis.tiles = [];\n\t\tthis.tileGroup = new Object3D();\n\t\tthis.group.add(this.tileGroup);\n\t\t//this.group.rotateY(90 * Engine.DEG_TO_RAD);\n\t}\n\n\tgenerateOverlay(size: number): void {\n\t\tconst mat = new LineBasicMaterial({\n\t\t\tcolor: 0x000000,\n\t\t\topacity: 0.9\n\t\t});\n\n\t\tif (this.tileOverlay) {\n\t\t\tthis.group.remove(this.tileOverlay);\n\t\t}\n\n\t\tthis.tileOverlay = new Object3D();\n\n\t\tthis.grid.generateOverlay(size, this.tileOverlay, mat);\n\n\t\tthis.group.add(this.tileOverlay);\n\t}\n\n\tgenerateTiles(config?: MapSettings): void {\n\t\tlet settings = {\n\t\t\ttileScale: .965,\n\t\t\textrudeSettings: {\n\t\t\t\tamount: 10,\n\t\t\t\tbevelEnabled: true,\n\t\t\t\tbevelSegments: 1,\n\t\t\t\tsteps: 1,\n\t\t\t\tbevelSize: 0.5,\n\t\t\t\tbevelThickness: 0.5\n\t\t\t} as ExtrudeSettings\n\t\t} as MapSettings;\n\t\tif (config)\n\t\t\tsettings = Engine.Tools.merge(settings, config) as MapSettings;\n\n\t\tthis.reset();\n\n\t\tconst tiles = this.tiles = this.grid.generateTiles(settings);\n\n\t\tthis.tileGroup = new Object3D();\n\t\tfor (let i = 0; i < tiles.length; i++) {\n\t\t\tthis.tileGroup.add(tiles[i].mesh);\n\t\t}\n\n\t\tthis.group.add(this.tileGroup);\n\t}\n\n\treset(): void {\n\t\t// removes all tiles from the scene, but leaves the grid intact\n\t\tthis.removeAllTiles();\n\t\tif (this.tileGroup) this.group.remove(this.tileGroup);\n\t}\n}","import Cell from './grids/Cell';\n//export { default as Cell } from './grids/Cell';\nimport Grid from './grids/Grid';\n// export { default as Grid } from './grids/Grid';\nimport HexGrid from './grids/HexGrid';\n//export { default as HexGrid } from './grids/HexGrid';\nimport SqrGrid from './grids/SqrGrid';\n//export { default as SqrGrid } from './grids/SqrGrid';\nimport Tile from './grids/Tile';\n//export { default as Tile } from './grids/Tile';\nimport LinkedList from './lib/LinkedList';\n//export { default as LinkedList } from './lib/LinkedList';\nimport Signal from './lib/Signal';\n//export { default as Signal } from './lib/Signal';\nimport AStarFinder from './pathing/AStarFinder';\n//export { default as AStarFinder } from './pathing/AStarFinder';\nimport PathUtil from './pathing/PathUtil';\n//export { default as PathUtil } from './pathing/PathUtil';\nimport Loader from './utils/Loader';\n//export { default as Loader } from './utils/Loader';\nimport MouseCaster from './utils/MouseCaster';\n//export { default as MouseCaster } from './utils/MouseCaster';\nimport View from './map/View';\n//export { default as Scene } from './utils/Scene';\nimport SelectionManager from './utils/SelectionManager';\n//export { default as SelectionManager } from './utils/SelectionManager';\nimport Tools from './utils/Tools';\n//export { default as Tools } from './utils/Tools';\nimport Map from './map/Map';\n// export { default as map } from './map';\n\n\nexport const Engine = {\n\tVERSION: '1.0.0',\n\n\tPI: Math.PI,\n\tTAU: Math.PI * 2,\n\tDEG_TO_RAD: 0.0174532925,\n\tRAD_TO_DEG: 57.2957795,\n\tSQRT3: Math.sqrt(3), // used often in hex conversions\n\n\tCell,\n\tGrid,\n\tHexGrid,\n\tSqrGrid,\n\tTile,\n\tLinkedList,\n\tSignal,\n\tAStarFinder,\n\tPathUtil,\n\tLoader,\n\tMouseCaster,\n\tView,\n\tSelectionManager,\n\tTools,\n\tMap,\n\n\t// useful enums for type checking. change to whatever fits your game. these are just examples\n\tTILE: 'tile', // visual representation of a grid cell\n\tENT: 'entity', // dynamic things\n\tSTR: 'structure', // static things\n\n\tHEX: 'hex',\n\tSQR: 'square',\n\tRCT: 'rectangle',\n\tABS: 'abstract',\n}\n\nexport default Engine;","import Cell from \"./Cell\";\nimport { ExtrudeSettings, MapSettings, GridSettings } from \"../utils/Interfaces\";\nimport { Shape, BufferGeometry, ShapeGeometry, Vector3, Object3D, Material } from \"three\";\nimport Tile from \"./Tile\";\nimport HexGrid from './HexGrid';\nimport Engine from '../Engine';\nimport SqrGrid from \"./SqrGrid\";\nimport { heuristic } from '../utils/Interfaces';\n\nexport interface GridInterface {\n  gridShape: string;\n  gridSize: number;\n  cellSize: number;\n  cells: { [key: string]: Cell };\n  numCells: number;\n  extrudeSettings: ExtrudeSettings;\n  cellShape: Shape;\n  cellGeo: BufferGeometry;\n  cellShapeGeo: ShapeGeometry;\n  autogenerated: boolean;\n   \n\n  cellToPixel(cell: Cell): Vector3;\n  add(cell: Cell): Cell;\n  remove(cell: Cell): Cell;\n  cellToHash(cell: Cell): string;\n  pixelToCell(pos: Vector3): Cell;\n  dispose(): void;\n  generateOverlay(size: number, overlayObj: Object3D, overlayMat: Material): void;\n  generateTiles(tilemapSettings?: MapSettings): Tile[];\n  generateGrid(config: GridSettings): void;\n  clearPath(): void;\n  getNeighbors(cell: Cell, diagonals?: boolean, filter?: heuristic): Cell[];\n  getRandomCell(): Cell;\n  distance(cellA: Cell, cellB: Cell): number;\n  traverse(cb: (cell: Cell) => void): void;\n};\n\nexport default class Grid {\n  constructor(config?: GridSettings) {\n    if (!config || config.cellShape === undefined || config.cellShape === Engine.HEX) {\n      return new HexGrid(config);\n    } else if (config.cellShape === Engine.SQR) {\n      return new SqrGrid(config);\n    }\n  }\n}","/* eslint-disable */\nimport React from 'react';\nimport Engine from '../lib/Engine.ts';\nimport { Link } from \"react-router-dom\";\n\nexport default class Splash extends React.Component {\n  params = {\n    cameraControl: {\n      enableDamping: true,\n      controlled: false,\n      dampingFactor: 0.05,\n      minDistance: 150,\n      maxDistance: 200,\n      zoomSpeed: 3,\n      autoRotate: true,\n      screenSpacePanning: false,\n      minPolarAngle: 0, // Math.PI / 10\n      maxPolarAngle: 60,\n      minAzimuthAngle: 0,\n      maxAzimuthAngle: -Math.PI,\n      horizontalRotation: true\n    }\n  }\n  componentDidMount() {\n    const cc = this.params.cameraControl;\n    // this constructs the cells in grid coordinate space\n    this.gridSpace = new Engine.Grid({\n      gridShape: Engine.HEX,\n      cellSize: 15,\n      gridSize: 80\n    });\n    this.map = new Engine.Map(this.gridSpace);\n    this.scene = new Engine.View(this.map, {\n      element: document.getElementById('engine'),\n      cameraPosition: { x: 50, y: 52, z: 50 },\n      cameraControlSettings: {\n        controlled: cc.controlled,\n        enableDamping: cc.enableDamping,\n        dampingFactor: cc.dampingFactor,\n        maxDistance: cc.maxDistance,\n        minDistance: cc.minDistance,\n        enableZoom: cc.enableZoom,\n        zoomSpeed: cc.zoomSpeed,\n        hotEdges: cc.hotEdges,\n        autoRotate: cc.autoRotate,\n        screenSpacePanning: cc.screenSpacePanning,\n        minPolarAngle: cc.minPolarAngle,\n        maxPolarAngle: cc.maxPolarAngle,\n        maxAzimuthAngle: cc.maxAzimuthAngle,\n        minAzimuthAngle: cc.minAzimuthAngle,\n        horizontalRotation: cc.horizontalRotation\n      }\n    });\n    //this.map.generateOverlay(45);\n\n    this.scene.focusOn(this.map.getRandomTile());\n  }\n  componentWillUnmount() {\n    window.cancelAnimationFrame(this.animID);\n    this.scene.dispose();\n    this.gridSpace.dispose();\n    this.map.dispose();\n    delete this.map;\n    delete this.gridSpace;\n    delete this.scene;\n  }\n  render() {\n    return (\n      <div className=\"App\">\n        <div id='overlay'>\n          <h1>Tiles.js</h1>\n          <hr></hr>\n          <h3>A 3D Tile Engine</h3>\n          <Link to='/sandbox' style={{ backgroundColor: 'rgb(147,217,69)', color:'black'}}>Sandbox</Link>\n          <br/>\n          <Link to='/docs'>Docs</Link>\n          <br />\n          <a href='https://github.com/christophgomez/threejs-tilemap' target=\"_blank\" rel=\"noopener noreferrer\">Github</a>\n        </div>\n        <div id='engine'></div>\n      </div>\n    );\n  }\n}","import * as dat from 'dat.gui';\n\nexport default class GUI { \n  constructor(options, scene) {\n    this.gui = new dat.GUI({ autoPlace: false });\n    document.getElementById('gui').append(this.gui.domElement);\n    document.getElementById('gui').addEventListener('mousedown', (e) => {\n      e.stopPropagation();\n    }, false);\n    const camGUI = this.gui.addFolder('Camera');\n    camGUI\n      .add(scene.camera.position, 'x')\n      .step(10)\n      .listen();\n    camGUI\n      .add(scene.camera.position, 'y')\n      .step(10)\n      .listen();\n    camGUI\n      .add(scene.camera.position, 'z')\n      .step(10)\n      .listen();\n    const orbitControls = camGUI.addFolder('Control');\n    orbitControls\n      .add(options, 'controlled')\n      .name('Enabled')\n      .onChange(() => {\n        scene.toggleControls();\n      });\n    orbitControls\n      .add(options, 'enableDamping')\n      .name('Damping')\n      .onChange(val => {\n        scene.updateControlSettings({ enableDamping: val });\n      });\n    orbitControls\n      .add(options, 'dampingFactor', 0, 1)\n      .step(0.01)\n      .name('Damping Factor')\n      .onChange(val => {\n        scene.updateControlSettings({ dampingFactor: val });\n      });\n    orbitControls\n      .add(options, 'maxDistance', 0, 1000)\n      .step(10)\n      .name('Max Zoom Out')\n      .onChange(val => {\n        scene.updateControlSettings({ maxDistance: val });\n      });\n    orbitControls\n      .add(options, 'minDistance', 0, 1000)\n      .step(10)\n      .name('Max Zoom In')\n      .onChange(val => {\n        scene.updateControlSettings({ minDistance: val });\n      });\n    orbitControls\n      .add(options, 'zoomSpeed', 0, 20)\n      .step(1)\n      .name('Zoom Speed')\n      .onChange(val => {\n        scene.updateControlSettings({ zoomSpeed: val });\n      });\n    orbitControls\n      .add(options, 'hotEdges')\n      .name('Edge Scroll')\n      .onChange(val => {\n        scene.updateControlSettings({ hotEdges: val });\n      });\n    orbitControls\n      .add(options, 'autoRotate')\n      .name('Auto Rotate')\n      .onChange(val => {\n        scene.updateControlSettings({ autoRotate: val });\n\n        if (val === true) {\n          options.horizontalRotation = true;\n        } else {\n          options.horizontalRotation = false;\n        }\n      });\n    orbitControls\n      .add(options, 'screenSpacePanning')\n      .name('Screen Space Panning')\n      .onChange(val => {\n        scene.updateControlSettings({ screenSpacePanning: val });\n      });\n    orbitControls\n      .add(options, 'minPolarAngle', 0, 180)\n      .step(1)\n      .name('Min Polar Angle')\n      .onChange(val => {\n        val = (val * Math.PI) / 180;\n        scene.updateControlSettings({ minPolarAngle: val });\n      });\n    orbitControls\n      .add(options, 'maxPolarAngle', 0, 180)\n      .step(1)\n      .name('Max Polar Angle')\n      .onChange(val => {\n        val = (val * Math.PI) / 180;\n        scene.updateControlSettings({ minPolarAngle: val });\n      });\n    orbitControls\n      .add(options, 'minAzimuthAngle', -180, 180)\n      .step(1)\n      .name('Min Azimuth Angle')\n      .onChange(val => {\n        val = (val * Math.PI) / 180;\n        scene.updateControlSettings({ minAzimuthAngle: val });\n      });\n    orbitControls\n      .add(options, 'maxAzimuthAngle', -180, 180)\n      .step(1)\n      .name('Max Azimuth Angle')\n      .onChange(val => {\n        val = (val * Math.PI) / 180;\n        scene.updateControlSettings({ maxAzimuthAngle: val });\n      });\n    orbitControls\n      .add(options, 'horizontalRotation')\n      .name('Hor. Rotation')\n      .onChange(val => {\n        scene.toggleHorizontalRotation(val);\n      })\n      .listen();\n    const worldGUI = this.gui.addFolder('World');\n    worldGUI.addFolder('Grid/Map');\n    worldGUI.addFolder('Terrain');\n    camGUI.open();\n    orbitControls.open();\n  }\n}","/* eslint-disable */\nimport React from 'react';\nimport Engine from '../lib/Engine.ts';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faExpand, faCompress } from '@fortawesome/free-solid-svg-icons';\nimport GUI from './dat';\nimport './styles/sandbox.css';\n\nexport default class Sandbox extends React.Component {\n  params = {\n    cameraControl: {\n      controlled: true,\n      enableDamping: true,\n      dampingFactor: 0.05,\n      minDistance: 250,\n      maxDistance: 400,\n      zoomSpeed: 3,\n      hotEdges: true,\n      autoRotate: false,\n      screenSpacePanning: false,\n      minPolarAngle: Math.PI / 10, // Math.PI / 10\n      maxPolarAngle: Math.PI / 4,\n      minAzimuthAngle: 0,\n      maxAzimuthAngle: -Math.PI,\n      horizontalRotation: false\n    }\n  };\n  state = {\n    fullscreen: false\n  }\n\n  componentDidMount() {\n    const cc = this.params.cameraControl;\n\n    // this constructs the cells in grid coordinate space\n    this.gridSpace = new Engine.Grid({\n      gridShape: Engine.RCT,\n      gridSize: 80,\n      cellSize: 20,\n    });\n    this.map = new Engine.Map(this.gridSpace);\n\n    this.scene = new Engine.View(this.map, {\n      element: document.querySelector('.App'),\n      cameraPosition: { x: 0, y: 40, z: 50 },\n      cameraControlSettings: {\n        controlled: cc.controlled,\n        enableDamping: cc.enableDamping,\n        dampingFactor: cc.dampingFactor,\n        maxDistance: cc.maxDistance,\n        minDistance: cc.minDistance,\n        enableZoom: cc.enableZoom,\n        zoomSpeed: cc.zoomSpeed,\n        hotEdges: cc.hotEdges,\n        autoRotate: cc.autoRotate,\n        screenSpacePanning: cc.screenSpacePanning,\n        minPolarAngle: cc.minPolarAngle,\n        maxPolarAngle: cc.maxPolarAngle,\n        maxAzimuthAngle: cc.maxAzimuthAngle,\n        minAzimuthAngle: cc.minAzimuthAngle,\n        horizontalRotation: cc.horizontalRotation\n      }\n    });\n\n    //this.map.generateOverlay(45);\n    this.scene.focusOn(this.map.group);\n\n    const el = document.getElementById('fps');\n    const onAnimation = (dtS) => {\n      const fps = 1 / dtS;\n      el.innerHTML = 'FPS: ' + fps.toFixed(0);\n    }\n    this.animationID = this.scene.animationManager.addOnAnimate(onAnimation.bind(this));\n\n    this.gui = new GUI(cc, this.scene);\n  }\n\n  componentWillUnmount() {\n    this.scene.dispose();\n    this.gridSpace.dispose();\n    this.map.dispose();\n    this.map= null;\n    this.gridSpace = null;\n    this.scene = null;\n  }\n\n  toggleFullscreen() {\n    const elem = document.querySelector('.App');\n\n    if (!document.fullscreenElement) {\n      elem.requestFullscreen().then(() => {\n        this.setState({ fullscreen: true });\n      }).catch(err => {\n        alert(\n          `Error attempting to enable full-screen mode: ${err.message} (${err.name})`\n        );\n      });\n    } else {\n      document.exitFullscreen().then(() => {\n        this.setState({ fullscreen: false });\n      });\n    }\n  }\n\n  render() {\n    let toggle;\n    if (!document.fullscreenElement) {\n      toggle = <FontAwesomeIcon icon={faExpand} size=\"4x\" />;\n    } else {\n      toggle = <FontAwesomeIcon icon={faCompress} size=\"4x\" />;\n    }\n    return (\n      <div className=\"App\">\n        <div id=\"gui\">\n        </div>\n        <div id='fps'>\n        </div>\n        <button className='fullScreenToggle' onClick={() => this.toggleFullscreen()}>{toggle}</button>\n      </div>\n    );\n  }\n}\n","/* eslint-disable */\nimport React from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport HTMLParser from 'react-markdown/plugins/html-parser';\nimport { TOC } from './markdown/ref.js';\nimport * as docFiles from './markdown/ref';\nimport { Link } from 'react-router-dom';\nimport hljs from 'highlight.js';\nimport javascript from 'highlight.js/lib/languages/javascript';\nimport typescript from 'highlight.js/lib/languages/typescript';\nimport bash from 'highlight.js/lib/languages/bash';\nimport './Docs.css';\nimport 'highlight.js/styles/atelier-sulphurpool-light.css';\nhljs.registerLanguage('javascript', javascript);\nhljs.registerLanguage('typescript', typescript);\nhljs.registerLanguage('bash', bash);\n\nexport default class Docs extends React.Component {\n  state = {\n    toc: '',\n    combinedData: [],\n    currSlide: 0,\n    currKey: 'Installation'\n  };\n  componentDidMount() {\n    const self = this;\n    fetch(TOC)\n      .then(response => {\n        return response.text();\n      })\n      .then(text => {\n        self.setState({ toc: text });\n      });\n    let combinedData = [];\n    let fetchedDocData = Object.keys(docFiles)\n      .slice(1, Object.keys(docFiles).length)\n      .map((key, index) => {\n        return fetch(docFiles[key]).then(response => {\n          return response.text();\n        });\n      });\n    Promise.all(fetchedDocData).then(values => {\n      for (let i in values) {\n        combinedData.push(values[i]);\n      }\n      self.setState({ combinedData }, () => {\n        self.updateCodeSyntaxHighlighting();\n        //console.log(combinedData);\n        //console.log(Object.keys(combinedData));\n      });\n    });\n  }\n  componentDidUpdate() {\n    this.updateCodeSyntaxHighlighting();\n  }\n  updateCodeSyntaxHighlighting = () => {\n    document.querySelectorAll('pre code').forEach(block => {\n      hljs.highlightBlock(block);\n    });\n    document.querySelectorAll('p code').forEach(block => {\n      hljs.highlightBlock(block);\n      block.className = 'language-typescript hljs'\n    });\n  };\n  markdownLinkRenderer({ href, children }) {\n    if (href.startsWith('#')) {\n      const slide = href.slice(1);\n      const key = children[0].props.value;\n      return (\n        <p>\n          {this.state.currKey === key ? <span></span> : null}\n          <a\n            href={'#/docs'}\n            id={key}\n            style={\n              this.state.currKey === key\n                ? { color: '#006d9a', borderBottom: '1px solid #006d9a' }\n                : null\n            }\n            onClick={() => this.setCurrSlide(slide, key)}\n          >\n            {children}\n          </a>\n        </p>\n      );\n    } else if (href.startsWith('/')) {\n      return <Link to={href}>{children}</Link>;\n    } else {\n      return (\n        <a href={href} target=\"_blank\" rel=\"nofollow noopener noreferrer\">\n          {children}\n        </a>\n      );\n    }\n  }\n  markdownCodeRenderer({ language, value }) {\n    if (language === '') {\n      return value;\n    }\n    const className = language && `language-${language}`;\n    const code = React.createElement(\n      'code',\n      className ? { className: className } : null,\n      value\n    );\n    return React.createElement('pre', {}, code);\n  }\n  setCurrSlide(currSlide, currKey) {\n    this.setState({ currSlide, currKey });\n  }\n  render() {\n    return (\n      <div className=\"docs\">\n        <div className=\"toc\">\n          <ReactMarkdown\n            renderers={{\n              link: this.markdownLinkRenderer.bind(this),\n              code: this.markdownCodeRenderer\n            }}\n            plugins={[HTMLParser]}\n            source={this.state.toc}\n          />\n        </div>\n        <div className=\"main\">\n          <ReactMarkdown\n            renderers={{\n              link: this.markdownLinkRenderer.bind(this),\n              code: this.markdownCodeRenderer\n            }}\n            plugins={[HTMLParser]}\n            source={this.state.combinedData[this.state.currSlide]}\n          />\n        </div>\n        <div className=\"footer\">\n          {this.state.currSlide > 0 ? (\n            <button className=\"prev\" onClick={() => {\n              this.setCurrSlide(this.state.currSlide - 1, this.state.currKey - 1);\n            }}>Prev</button>\n          ) : null}\n          {this.state.currSlide < this.state.combinedData.length ? (\n            <button\n              className=\"next\"\n              onClick={() => {\n                this.setCurrSlide(this.state.currSlide + 1, this.state.currKey + 1);\n              }}\n            >\n              Next\n            </button>\n          ) : null}\n        </div>\n      </div>\n    );\n  }\n}\n","/* eslint-disable */\n\nimport React from 'react';\nimport './App.css';\nimport './Components/styles/dat.css';\nimport { HashRouter as Router, Route, } from \"react-router-dom\";\nimport Splash from './Components/Splash';\nimport Sandbox from './Components/Sandbox';\nimport Docs from './Components/Docs/Docs';\n\nclass App extends React.Component {\n\trender() {\n\t\treturn (\n\t\t\t<Router basename='/'>\n\t\t\t\t<Route path=\"/\" exact component={Splash} />\n\t\t\t\t<Route path=\"/sandbox\" component={Sandbox} />\n\t\t\t\t<Route path='/docs' component={Docs} />\n\t\t\t</Router>\n\t\t)\n\t}\n}\n\nexport default App;\n","/* eslint-disable @typescript-eslint/no-unused-vars */\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n","module.exports = __webpack_public_path__ + \"static/media/toc.b8e82dc8.md\";","module.exports = __webpack_public_path__ + \"static/media/intro.c6d06771.md\";","module.exports = __webpack_public_path__ + \"static/media/grid.480d7a3c.md\";","module.exports = __webpack_public_path__ + \"static/media/cell.bd29fb78.md\";","module.exports = __webpack_public_path__ + \"static/media/tile.fd1aa1d6.md\";","module.exports = __webpack_public_path__ + \"static/media/map.cf860fea.md\";","module.exports = __webpack_public_path__ + \"static/media/view.7288fbb3.md\";","module.exports = __webpack_public_path__ + \"static/media/controller.47f0ed90.md\";","module.exports = __webpack_public_path__ + \"static/media/animation.7c526e3a.md\";","module.exports = __webpack_public_path__ + \"static/media/animationmanager.a35a17ed.md\";","module.exports = __webpack_public_path__ + \"static/media/finder.2cb32513.md\";","module.exports = __webpack_public_path__ + \"static/media/mousecaster.a0dbffda.md\";","module.exports = __webpack_public_path__ + \"static/media/interfaces.468bd753.md\";"],"sourceRoot":""}